/*! For license information please see module.js.LICENSE.txt */
/* [create-plugin] version: 5.22.0 */
define(["module","@grafana/data","react","@emotion/css","@grafana/runtime","@grafana/ui","lodash","prismjs","rxjs"],((e,t,r,n,o,a,l,i,s)=>(()=>{"use strict";var c={513:e=>{e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,o,a;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(o=n;0!=o--;)if(!e(t[o],r[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(a=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(o=n;0!=o--;)if(!Object.prototype.hasOwnProperty.call(r,a[o]))return!1;for(o=n;0!=o--;){var l=a[o];if(!e(t[l],r[l]))return!1}return!0}return t!=t&&r!=r}},44:(e,t,r)=>{var n=r(959),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,a={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)l.call(t,n)&&!s.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:o,type:e,key:c,ref:u,props:a,_owner:i.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},728:(e,t,r)=>{e.exports=r(44)},89:e=>{e.exports=n},781:e=>{e.exports=t},531:e=>{e.exports=o},7:e=>{e.exports=a},241:e=>{e.exports=l},308:t=>{t.exports=e},146:e=>{e.exports=i},959:e=>{e.exports=r},269:e=>{e.exports=s}},u={};function d(e){var t=u[e];if(void 0!==t)return t.exports;var r=u[e]={exports:{}};return c[e](r,r.exports,d),r.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var r in t)d.o(t,r)&&!d.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="public/plugins/grafana-pyroscope-datasource/";var p={};d.r(p),d.d(p,{plugin:()=>Nt});var f=d(308),h=d.n(f);d.p=h()&&h().uri?h().uri.slice(0,h().uri.lastIndexOf("/")+1):"public/plugins/grafana-pyroscope-datasource/";var g=d(781),m=d(728),b=d(89),y=d(959),v=d(7);const O=({dataSourceName:e,docsLink:t,hasRequiredFields:r=!0,className:n})=>{const o=(0,v.useTheme2)(),a={container:(0,b.css)({p:{margin:0},"p + p":{marginTop:o.spacing(2)}}),text:(0,b.css)({...o.typography.body,color:o.colors.text.secondary,a:(0,b.css)({color:o.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})})};return y.createElement("div",{className:(0,b.cx)(a.container,n)},y.createElement("p",{className:a.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",y.createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),r&&y.createElement("p",{className:a.text},y.createElement("i",null,"Fields marked with * are required")))},j=({children:e,title:t,description:r,isCollapsible:n=!1,isInitiallyOpen:o=!0,kind:a="section",className:l})=>{const{colors:i,typography:s,spacing:c}=(0,v.useTheme2)(),[u,d]=(0,y.useState)(!n||o),p=u?"angle-up":"angle-down",f="sub-section"===a,h=`${u?"Collapse":"Expand"} section ${t}`,g={header:(0,b.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,b.css)({margin:0}),subtitle:(0,b.css)({margin:0,fontWeight:s.fontWeightRegular}),descriptionText:(0,b.css)({marginTop:c(f?.25:.5),marginBottom:0,...s.bodySmall,color:i.text.secondary}),content:(0,b.css)({marginTop:c(2)})};return y.createElement("div",{className:l},y.createElement("div",{className:g.header},"section"===a?y.createElement("h3",{className:g.title},t):y.createElement("h6",{className:g.subtitle},t),n&&y.createElement(v.IconButton,{name:p,onClick:()=>d(!u),type:"button",size:"xl","aria-label":h})),r&&y.createElement("p",{className:g.descriptionText},r),u&&y.createElement("div",{className:g.content},e))},w=({children:e,...t})=>y.createElement(j,{...t,kind:"section"},e),x=({config:e,onChange:t,description:r,urlPlaceholder:n,urlTooltip:o,urlLabel:a,className:l})=>{const i=void 0!==e.url&&/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(e.url),s={container:(0,b.css)({maxWidth:578})};return y.createElement(y.Fragment,null,y.createElement(w,{title:"Connection",description:r,className:(0,b.cx)(s.container,l)},y.createElement(v.InlineField,{htmlFor:"connection-url",label:a||"URL",labelWidth:24,tooltip:o||y.createElement(y.Fragment,null,"Specify a complete HTTP URL",y.createElement("br",null),"(for example https://example.com:8080)"),grow:!0,disabled:e.readOnly,required:!0,invalid:!i&&!e.readOnly,error:i?"":"Please enter a valid URL",interactive:!0},y.createElement(v.Input,{id:"connection-url","aria-label":"Data source connection URL",onChange:r=>t({...e,url:r.currentTarget.value}),value:e.url||"",placeholder:n||"URL"}))))},C=()=>({inlineFieldNoMarginRight:(0,b.css)({marginRight:0}),inlineFieldWithSecret:(0,b.css)({'[class$="layoutChildrenWrapper"]:first-child':{flexGrow:1}})}),S=({user:e,passwordConfigured:t,userLabel:r="User",userTooltip:n="The username of the data source account",userPlaceholder:o="User",passwordLabel:a="Password",passwordTooltip:l="The password of the data source account",passwordPlaceholder:i="Password",onUserChange:s,onPasswordChange:c,onPasswordReset:u,readOnly:d})=>{const p=C(),f={lastInlineField:(0,b.css)({marginBottom:0})};return y.createElement(y.Fragment,null,y.createElement(v.InlineField,{className:p.inlineFieldNoMarginRight,label:r,labelWidth:24,tooltip:n,required:!0,htmlFor:"basic-auth-user-input",interactive:!0,grow:!0,disabled:d},y.createElement(v.Input,{id:"basic-auth-user-input",placeholder:o,value:e,onChange:e=>s(e.currentTarget.value),required:!0})),y.createElement(v.InlineField,{className:(0,b.cx)(p.inlineFieldNoMarginRight,p.inlineFieldWithSecret,f.lastInlineField),label:a,labelWidth:24,tooltip:l,required:!0,htmlFor:"basic-auth-password-input",interactive:!0,grow:!0,disabled:d},y.createElement(v.SecretInput,{id:"basic-auth-password-input",isConfigured:t,onReset:d?()=>{}:u,placeholder:i,onChange:e=>c(e.currentTarget.value),required:!0})))},E=({children:e,...t})=>y.createElement(j,{...t,kind:"sub-section"},e);var P=(e=>(e.NoAuth="NoAuth",e.BasicAuth="BasicAuth",e.OAuthForward="OAuthForward",e.CrossSiteCredentials="CrossSiteCredentials",e))(P||{});const T={[P.BasicAuth]:{label:"Basic authentication",value:P.BasicAuth,description:"Authenticate with your data source username and password"},[P.CrossSiteCredentials]:{label:"Enable cross-site access control requests",value:P.CrossSiteCredentials,description:"Allow cross-site Access-Control requests with your existing credentials and cookies. This enables the server to authenticate the user and perform authorized requests on their behalf on other domains."},[P.OAuthForward]:{label:"Forward OAuth Identity",value:P.OAuthForward,description:"Forward the OAuth access token (and if available: the OIDC ID token) of the user querying to the data source"},[P.NoAuth]:{label:"No Authentication",value:P.NoAuth,description:"Data source is available without authentication"}},A=({selectedMethod:e,mostCommonMethod:t,visibleMethods:r,defaultOptionsOverrides:n,customMethods:o,onAuthMethodSelect:a,basicAuth:l,readOnly:i})=>{var s,c,u,d;const[p,f]=(0,y.useState)(!1),{colors:h,spacing:g}=(0,v.useTheme2)(),m=(0,y.useMemo)((()=>{var e;return null!=r?r:[P.BasicAuth,P.OAuthForward,P.NoAuth,...null!=(e=null==o?void 0:o.map((e=>e.id)))?e:[]]}),[o,r]),O=m.length>1,j=(0,y.useMemo)((()=>{var e;const r=null!=(e=null==o?void 0:o.reduce(((e,t)=>(e[t.id]={label:t.label,value:t.id,description:t.description},e)),{}))?e:{},a={};let l;for(l in T)a[l]={...T[l],...null==n?void 0:n[l]};const i={...r,...a};return m.filter((e=>Boolean(i[e]))).map((e=>{const r=i[e];return e===t&&O?{...r,label:`${r.label} (most common)`}:r}))}),[m,o,n,t,O]);let w=e;O?e===P.NoAuth&&t&&!p&&(w=t):w=m[0];let x=null;w===P.BasicAuth&&l?x=y.createElement(S,{...l,readOnly:i}):w.startsWith("custom-")&&(x=null!=(c=null==(s=null==o?void 0:o.find((e=>e.id===w)))?void 0:s.component)?c:null);const C=O?"Authentication methods":null!=(u=j[0].label)?u:"",A=O?"Choose an authentication method to access the data source":null!=(d=j[0].description)?d:"",N={authMethods:(0,b.css)({marginTop:g(2.5),...O&&{padding:g(2),border:`1px solid ${h.border.weak}`}}),selectedMethodFields:(0,b.css)({marginTop:g(1.5)})};return y.createElement(E,{title:C,description:A},y.createElement("div",{className:N.authMethods},O&&y.createElement(v.Field,{label:"Authentication method"},y.createElement(v.Select,{inputId:"auth-method-select",options:j,value:w,onChange:e=>{f(!0),a(e.value)},disabled:i})),x&&y.createElement("div",{className:N.selectedMethodFields},x)))},N=({children:e,enabled:t,label:r,tooltipText:n,onToggle:o,readOnly:a})=>{const{colors:l,spacing:i}=(0,v.useTheme2)(),s={container:(0,b.css)({marginTop:3}),checkboxContainer:(0,b.css)({display:"flex",alignItems:"center"}),infoIcon:(0,b.css)({marginTop:-2,marginLeft:5,color:l.text.secondary}),content:(0,b.css)({margin:i(1,0,2,3)})};return y.createElement("div",{className:s.container},y.createElement("div",{className:s.checkboxContainer},y.createElement(v.Checkbox,{value:t,label:r,onChange:()=>o(!t),disabled:a}),y.createElement(v.Tooltip,{placement:"top",content:n,interactive:!0},y.createElement(v.Icon,{name:"info-circle",className:s.infoIcon,size:"sm"}))),t&&e&&y.createElement("div",{className:s.content},e))},I=({enabled:e,certificateConfigured:t,onToggle:r,onCertificateChange:n,onCertificateReset:o,tooltips:a,readOnly:l})=>{var i;const s=C();return y.createElement(N,{enabled:e,label:"Add self-signed certificate",tooltipText:"Add your own Certificate Authority (CA) certificate on top of one generated by the certificate authorities for additional security measures",onToggle:e=>r(e),readOnly:l},y.createElement(v.InlineField,{label:"CA Certificate",labelWidth:24,tooltip:null!=(i=null==a?void 0:a.certificateLabel)?i:"Your self-signed certificate",required:!0,htmlFor:"self-signed-certificate-input",interactive:!0,grow:!0,className:(0,b.cx)(s.inlineFieldNoMarginRight,s.inlineFieldWithSecret),disabled:l},y.createElement(v.SecretTextArea,{id:"self-signed-certificate-input",isConfigured:t,onChange:e=>n(e.currentTarget.value),onReset:l?()=>{}:o,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})))},F=({enabled:e,serverName:t,clientCertificateConfigured:r,clientKeyConfigured:n,onToggle:o,onServerNameChange:a,onClientCertificateChange:l,onClientKeyChange:i,onClientCertificateReset:s,onClientKeyReset:c,tooltips:u,readOnly:d})=>{var p,f,h;const g=C();return y.createElement(N,{enabled:e,label:"TLS Client Authentication",tooltipText:"Validate using TLS client authentication, in which the server authenticates the client",onToggle:e=>o(e),readOnly:d},y.createElement(v.InlineField,{label:"ServerName",labelWidth:24,tooltip:null!=(p=null==u?void 0:u.serverNameLabel)?p:"A Servername is used to verify the hostname on the returned certificate",required:!0,htmlFor:"client-auth-servername-input",interactive:!0,grow:!0,className:g.inlineFieldNoMarginRight,disabled:d},y.createElement(v.Input,{id:"client-auth-servername-input",placeholder:"domain.example.com",value:t,onChange:e=>a(e.currentTarget.value),required:!0})),y.createElement(v.InlineField,{label:"Client Certificate",labelWidth:24,tooltip:null!=(f=null==u?void 0:u.certificateLabel)?f:"The client certificate can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-certificate-input",interactive:!0,grow:!0,className:(0,b.cx)(g.inlineFieldNoMarginRight,g.inlineFieldWithSecret),disabled:d},y.createElement(v.SecretTextArea,{id:"client-auth-client-certificate-input",isConfigured:r,onChange:e=>l(e.currentTarget.value),onReset:d?()=>{}:s,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})),y.createElement(v.InlineField,{label:"Client Key",labelWidth:24,tooltip:null!=(h=null==u?void 0:u.keyLabel)?h:"The client key can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-key-input",interactive:!0,grow:!0,className:(0,b.cx)(g.inlineFieldNoMarginRight,g.inlineFieldWithSecret),disabled:d},y.createElement(v.SecretTextArea,{id:"client-auth-client-key-input",isConfigured:n,onChange:e=>i(e.currentTarget.value),onReset:d?()=>{}:c,placeholder:"Begins with --- RSA PRIVATE KEY CERTIFICATE ---",rows:6,required:!0})))},D=({enabled:e,onToggle:t,readOnly:r})=>y.createElement(N,{enabled:e,label:"Skip TLS certificate validation",tooltipText:"Skipping TLS certificate validation is not recommended unless absolutely necessary or for testing",onToggle:e=>t(e),readOnly:r}),L=({selfSignedCertificate:e,TLSClientAuth:t,skipTLSVerification:r,readOnly:n})=>{const{spacing:o}=(0,v.useTheme2)(),a={container:(0,b.css)({marginTop:o(3)})};return y.createElement(E,{className:a.container,title:"TLS settings",description:"Additional security measures that can be applied on top of authentication"},y.createElement(I,{...e,readOnly:n}),y.createElement(F,{...t,readOnly:n}),y.createElement(D,{...r,readOnly:n}))},k=({header:e,onChange:t,onBlur:r,onDelete:n,readOnly:o})=>{const{spacing:a}=(0,v.useTheme2)(),l=C(),i={container:(0,b.css)({alignItems:"center"}),input:(0,b.css)({minWidth:"100%"}),headerNameField:(0,b.css)({width:"40%",marginRight:0,paddingRight:a(1)}),headerValueField:(0,b.css)({width:"45%",marginRight:0}),removeHeaderBtn:(0,b.css)({margin:"0 0 3px 10px"})};return y.createElement(y.Fragment,null,y.createElement(v.InlineFieldRow,{className:i.container},y.createElement(v.InlineField,{label:"Header",labelWidth:9,grow:!0,className:i.headerNameField,htmlFor:`custom-header-${e.id}-name-input`,disabled:o},y.createElement(v.Input,{id:`custom-header-${e.id}-name-input`,placeholder:"X-Custom-Header",value:e.name,width:12,onChange:r=>t({...e,name:r.currentTarget.value}),onBlur:r,className:i.input})),y.createElement(v.InlineField,{label:"Value",labelWidth:9,grow:!0,className:(0,b.cx)(l.inlineFieldWithSecret,i.headerValueField),htmlFor:`custom-header-${e.id}-value-input`,disabled:o},y.createElement(v.SecretInput,{id:`custom-header-${e.id}-value-input`,isConfigured:e.configured,placeholder:"Header value",value:e.value,width:12,onChange:r=>t({...e,value:r.currentTarget.value}),onReset:o?()=>{}:()=>t({...e,configured:!1,value:""}),onBlur:r,className:i.input})),y.createElement(v.IconButton,{name:"trash-alt",tooltip:"Remove header",tooltipPlacement:"top",className:i.removeHeaderBtn,onClick:n,type:"button",disabled:o})))},R=({headers:e,onChange:t,readOnly:r})=>{const{spacing:n}=(0,v.useTheme2)(),[o,a]=(0,y.useState)(e.map((e=>({...e,id:q(),value:""}))));(0,y.useEffect)((()=>{a((t=>{let r=!1;const n=t.map((t=>{var n;const o=null==(n=e.find((e=>e.name===t.name)))?void 0:n.configured;return void 0!==o&&t.configured!==o?(r=!0,{...t,configured:o}):t}));return r?n:t}))}),[e]);const l=()=>{t(o.map((({name:e,value:t,configured:r})=>({name:e,value:t,configured:r}))))},i={container:(0,b.css)({marginTop:n(3)}),addHeaderButton:(0,b.css)({marginTop:n(1.5)})};return y.createElement("div",{className:i.container},y.createElement(E,{title:"HTTP headers",description:"Pass along additional context and metadata about the request/response",isCollapsible:!0,isInitiallyOpen:o.length>0},y.createElement("div",null,o.map((e=>y.createElement(k,{key:e.id,header:e,onChange:e=>((e,t)=>{a(o.map((r=>r.id===e?{...t}:r)))})(e.id,e),onDelete:()=>(e=>{const r=o.findIndex((t=>t.id===e));if(-1===r)return;const n=[...o];n.splice(r,1),a(n),t(n.map((({name:e,value:t,configured:r})=>({name:e,value:t,configured:r}))))})(e.id),onBlur:l,readOnly:r})))),y.createElement("div",{className:i.addHeaderButton},y.createElement(v.Button,{icon:"plus",variant:"secondary",fill:"outline",onClick:()=>{a([...o,{id:q(),name:"",value:"",configured:!1}])},disabled:r},0===o.length?"Add header":"Add another header"))))};function q(){return Math.random().toString(16).slice(2)}const M=({selectedMethod:e,mostCommonMethod:t,visibleMethods:r,defaultOptionsOverrides:n,customMethods:o,onAuthMethodSelect:a,basicAuth:l,TLS:i,customHeaders:s,readOnly:c=!1})=>{const u={container:(0,b.css)({maxWidth:578})};return y.createElement("div",{className:u.container},y.createElement(w,{title:"Authentication"},y.createElement(A,{selectedMethod:e,mostCommonMethod:t,customMethods:o,visibleMethods:r,defaultOptionsOverrides:n,onAuthMethodSelect:a,basicAuth:l,readOnly:c}),i&&y.createElement(L,{...i,readOnly:c}),s&&y.createElement(R,{...s,readOnly:c})))},B="httpHeaderName",W="httpHeaderValue";function _({config:e,onChange:t}){return{selectedMethod:$(e),onAuthMethodSelect:V(e,t),basicAuth:J(e,t),TLS:U(e,t),customHeaders:z(e,t),readOnly:e.readOnly}}function $(e){return e.basicAuth?P.BasicAuth:e.withCredentials?P.CrossSiteCredentials:e.jsonData.oauthPassThru?P.OAuthForward:P.NoAuth}function V(e,t){return r=>{t({...e,basicAuth:r===P.BasicAuth,withCredentials:r===P.CrossSiteCredentials,jsonData:{...e.jsonData,oauthPassThru:r===P.OAuthForward}})}}function J(e,t){return{user:e.basicAuthUser,passwordConfigured:e.secureJsonFields.basicAuthPassword,onUserChange:r=>t({...e,basicAuthUser:r}),onPasswordChange:r=>t({...e,secureJsonData:{...e.secureJsonData,basicAuthPassword:r}}),onPasswordReset:()=>t({...e,secureJsonData:{...e.secureJsonData,basicAuthPassword:""},secureJsonFields:{...e.secureJsonFields,basicAuthPassword:!1}})}}function U(e,t){var r,n,o;return{selfSignedCertificate:{enabled:Boolean(e.jsonData.tlsAuthWithCACert),certificateConfigured:!!(null==(r=e.secureJsonFields)?void 0:r.tlsCACert),onToggle:r=>t(r?{...e,jsonData:{...e.jsonData,tlsAuthWithCACert:r}}:{...e,jsonData:{...e.jsonData,tlsAuthWithCACert:r},secureJsonData:{...e.secureJsonData,tlsCACert:""},secureJsonFields:{...e.secureJsonFields,tlsCACert:!1}}),onCertificateChange:r=>t({...e,secureJsonData:{...e.secureJsonData,tlsCACert:r}}),onCertificateReset:()=>t({...e,secureJsonData:{...e.secureJsonData,tlsCACert:""},secureJsonFields:{...e.secureJsonFields,tlsCACert:!1}})},TLSClientAuth:{enabled:e.jsonData.tlsAuth,serverName:e.jsonData.serverName,clientCertificateConfigured:!!(null==(n=e.secureJsonFields)?void 0:n.tlsClientCert),clientKeyConfigured:!!(null==(o=e.secureJsonFields)?void 0:o.tlsClientKey),onToggle:r=>t(r?{...e,jsonData:{...e.jsonData,tlsAuth:r}}:{...e,jsonData:{...e.jsonData,tlsAuth:r,serverName:""},secureJsonData:{...e.secureJsonData,tlsClientCert:"",tlsClientKey:""},secureJsonFields:{...e.secureJsonFields,tlsClientCert:!1,tlsClientKey:!1}}),onServerNameChange:r=>t({...e,jsonData:{...e.jsonData,serverName:r}}),onClientCertificateChange:r=>t({...e,secureJsonData:{...e.secureJsonData,tlsClientCert:r}}),onClientCertificateReset:()=>t({...e,secureJsonData:{...e.secureJsonData,tlsClientCert:""},secureJsonFields:{...e.secureJsonFields,tlsClientCert:!1}}),onClientKeyChange:r=>t({...e,secureJsonData:{...e.secureJsonData,tlsClientKey:r}}),onClientKeyReset:()=>t({...e,secureJsonData:{...e.secureJsonData,tlsClientKey:""},secureJsonFields:{...e.secureJsonFields,tlsClientKey:!1}})},skipTLSVerification:{enabled:e.jsonData.tlsSkipVerify,onToggle:r=>t({...e,jsonData:{...e.jsonData,tlsSkipVerify:r}})}}}function z(e,t){return{headers:Object.keys(e.jsonData).filter((e=>e.startsWith(B))).sort().map((t=>{var r;const n=t.slice(14);return{name:e.jsonData[t],configured:null!=(r=e.secureJsonFields[`${W}${n}`])&&r}})),onChange:r=>{const n=Object.fromEntries(Object.entries(e.jsonData).filter((([e])=>!e.startsWith(B)))),o=Object.fromEntries(Object.entries(e.secureJsonData||{}).filter((([e])=>!e.startsWith(W)))),a=Object.fromEntries(Object.entries(e.secureJsonFields).filter((([e])=>!e.startsWith(W))));r.forEach(((e,t)=>{n[`${B}${t+1}`]=e.name,e.configured?a[`${W}${t+1}`]=!0:o[`${W}${t+1}`]=e.value})),t({...e,jsonData:n,secureJsonData:o,secureJsonFields:a})}}}const K=({config:e,onChange:t,className:r})=>{const n={container:(0,b.css)({maxWidth:578})};return y.createElement(E,{title:"Advanced HTTP settings",className:(0,b.cx)(n.container,r)},y.createElement(v.InlineField,{htmlFor:"advanced-http-cookies",label:"Allowed cookies",labelWidth:24,tooltip:"Grafana proxy deletes forwarded cookies by default. Specify cookies by name that should be forwarded to the data source.",disabled:e.readOnly,grow:!0},y.createElement(v.TagsInput,{id:"advanced-http-cookies",placeholder:"New cookie (hit enter to add)",tags:e.jsonData.keepCookies,onChange:r=>{t({...e,jsonData:{...e.jsonData,keepCookies:r}})}})),y.createElement(v.InlineField,{htmlFor:"advanced-http-timeout",label:"Timeout",labelWidth:24,tooltip:"HTTP request timeout in seconds",disabled:e.readOnly,grow:!0},y.createElement(v.Input,{id:"advanced-http-timeout",type:"number",min:0,placeholder:"Timeout in seconds","aria-label":"Timeout in seconds",value:e.jsonData.timeout,onChange:r=>{t({...e,jsonData:{...e.jsonData,timeout:parseInt(r.currentTarget.value,10)}})}})))};var Q=d(531);function H(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){H(e,t,r[t])}))}return e}function Y(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Z=e=>({container:(0,b.css)({marginBottom:e.spacing(2),maxWidth:"900px"})});var X=d(513),ee=d.n(X),te=d(241),re=d(146),ne=d.n(re),oe=d(269);function ae(e,t,r,n,o,a,l){try{var i=e[a](l),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function le(e){const t=(r=e.profileTypes,(0,y.useMemo)((()=>{if(!r)return[];let e=new Map;for(let n of r){var t;let r=[];n.id.indexOf(":")>-1&&(r=n.id.split(":"));const[o,a]=r;e.has(o)||e.set(o,{label:o,value:o,items:[]}),null===(t=e.get(o))||void 0===t||t.items.push({label:a,value:n.id})}return Array.from(e.values())}),[r]));var r,n;return(0,m.jsx)(v.Cascader,{placeholder:e.placeholder,separator:"-",displayAllSelectedLevels:!0,initialValue:e.initialProfileTypeId,allowCustomValue:!0,onSelect:e.onChange,options:t,changeOnSelect:!1,width:null!==(n=e.width)&&void 0!==n?n:26})}function ie(e,t){const[r,n]=(0,y.useState)(),o={to:6e4*Math.ceil(((null==t?void 0:t.to.valueOf())||0)/6e4),from:6e4*Math.floor(((null==t?void 0:t.from.valueOf())||0)/6e4)};return(0,y.useEffect)((()=>{var t;(t=function*(){const t=yield e.getProfileTypes(o.from.valueOf(),o.to.valueOf());n(t)},function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function l(e){ae(a,n,o,l,i,"next",e)}function i(e){ae(a,n,o,l,i,"throw",e)}l(void 0)}))})()}),[e,o.from,o.to]),r}function se(e,t,r,n,o,a,l){try{var i=e[a](l),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function ce(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ce(e,t,r[t])}))}return e}function de(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function pe(e){var t,r;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(v.InlineFieldRow,{children:(0,m.jsx)(v.InlineField,{label:"Query type",labelWidth:20,tooltip:(0,m.jsx)("div",{children:"The Pyroscope data source plugin provides the following query types for template variables"}),children:(0,m.jsx)(v.Select,{placeholder:"Select query type","aria-label":"Query type",width:25,options:[{label:"Profile type",value:"profileType"},{label:"Label",value:"label"},{label:"Label value",value:"labelValue"}],onChange:t=>{"profileType"===t.value&&e.onChange({type:t.value,refId:e.query.refId}),"label"!==t.value&&"labelValue"!==t.value||e.onChange({type:t.value,refId:e.query.refId,profileTypeId:"profileType"!==e.query.type?e.query.profileTypeId:""})},value:e.query.type})})}),("labelValue"===e.query.type||"label"===e.query.type)&&(0,m.jsx)(he,{datasource:e.datasource,initialValue:e.query.profileTypeId,onChange:t=>{"label"!==e.query.type&&"labelValue"!==e.query.type||e.onChange(de(ue({},e.query),{profileTypeId:t}))},range:e.range}),"labelValue"===e.query.type&&(0,m.jsx)(fe,{value:e.query.labelName,datasource:e.datasource,profileTypeId:e.query.profileTypeId,onChange:t=>{"labelValue"===e.query.type&&e.onChange(de(ue({},e.query),{labelName:t}))},from:(null===(t=e.range)||void 0===t?void 0:t.from.valueOf())||Date.now().valueOf()-864e5,to:(null===(r=e.range)||void 0===r?void 0:r.to.valueOf())||Date.now().valueOf()})]})}function fe(e){const[t,r]=(0,y.useState)();(0,y.useEffect)((()=>{var t;(t=function*(){r(yield e.datasource.getLabelNames(e.profileTypeId?ge(e.profileTypeId):"{}",e.from,e.to))},function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function l(e){se(a,n,o,l,i,"next",e)}function i(e){se(a,n,o,l,i,"throw",e)}l(void 0)}))})()}),[e.datasource,e.profileTypeId,e.to,e.from]);const n=t?t.map((e=>({label:e,value:e}))):[];return t&&e.value&&!t.find((t=>t===e.value))&&n.push({value:e.value,label:e.value}),(0,m.jsx)(v.InlineFieldRow,{children:(0,m.jsx)(v.InlineField,{label:"Label",labelWidth:20,tooltip:(0,m.jsx)("div",{children:"Select label for which to retrieve available values"}),children:(0,m.jsx)(v.Select,{allowCustomValue:!0,placeholder:"Select label","aria-label":"Select label",width:25,options:n,onChange:t=>e.onChange(t.value),value:e.value})})})}function he(e){const t=ie(e.datasource,e.range);return(0,m.jsx)(v.InlineFieldRow,{children:(0,m.jsx)(v.InlineField,{label:"Profile type","aria-label":"Profile type",labelWidth:20,tooltip:(0,m.jsx)("div",{children:"Select profile type for which to retrieve available labels"}),children:t?(0,m.jsx)(le,{onChange:e.onChange,profileTypes:t,initialProfileTypeId:e.initialValue}):(0,m.jsx)(v.LoadingPlaceholder,{text:"Loading"})})})}function ge(e){return`{__profile_type__="${e}"}`}function me(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class be extends g.CustomVariableSupport{query(e){return"profileType"===e.targets[0].type?(0,oe.from)(this.dataAPI.getProfileTypes(e.range.from.valueOf(),e.range.to.valueOf())).pipe((0,oe.map)((e=>({data:e.map((e=>({text:e.label,value:e.id})))})))):"label"===e.targets[0].type?e.targets[0].profileTypeId?(0,oe.from)(this.dataAPI.getLabelNames(ge(e.targets[0].profileTypeId),e.range.from.valueOf(),e.range.to.valueOf())).pipe((0,oe.map)((e=>({data:e.map((e=>({text:e})))})))):(0,oe.of)({data:[]}):"labelValue"===e.targets[0].type&&e.targets[0].labelName&&e.targets[0].profileTypeId?(0,oe.from)(this.dataAPI.getLabelValues(ge(e.targets[0].profileTypeId),e.targets[0].labelName,e.range.from.valueOf(),e.range.to.valueOf())).pipe((0,oe.map)((e=>({data:e.map((e=>({text:e})))})))):(0,oe.of)({data:[]})}constructor(e){super(),me(this,"dataAPI",void 0),me(this,"editor",void 0),this.dataAPI=e,this.editor=pe}}function ye(e){const t=[];for(const r of e)if(r instanceof re.Token&&"context-labels"===r.type){let e="",n="",o="";const a=Array.isArray(r.content)?r.content:[r.content];for(let r of a)if("string"==typeof r){let e;e=r,"="!==e&&"!="!==e&&"=~"!==e&&"!~"!==e||(o=e)}else if(r instanceof re.Token)switch(r.type){case"label-key":e=Oe(r);break;case"label-value":n=Oe(r),n=n.substring(1,n.length-1);const a=je[o];a&&t.push({name:e,operator:a,value:n})}}return t}function ve(e){const t=e.map((e=>{const t=we[e.operator];return t?`${e.name}${t}"${e.value}"`:""})).filter((e=>""!==e)).join(", ");return t?`{${t}}`:""}function Oe(e){return"string"==typeof e.content?e.content:""}const je={"=":g.AbstractLabelOperator.Equal,"!=":g.AbstractLabelOperator.NotEqual,"=~":g.AbstractLabelOperator.EqualRegEx,"!~":g.AbstractLabelOperator.NotEqualRegEx},we=(0,te.invert)(je);function xe(e,t,r,n="="){if(!t||!r)throw new Error("Need label to add to query.");let o=ye(ne().tokenize(e,Ce));var a;return o=o.filter((e=>e.name!==t)),o.push({name:t,value:r.toString(),operator:null!==(a=je[n])&&void 0!==a?a:g.AbstractLabelOperator.Equal}),ve(o)}const Ce={"context-labels":{pattern:/\{[^}]*(?=}?)/,greedy:!0,inside:{comment:{pattern:/#.*/},"label-key":{pattern:/[a-zA-Z_]\w*(?=\s*(=|!=|=~|!~))/,alias:"attr-name",greedy:!0},"label-value":{pattern:/"(?:\\.|[^\\"])*"/,greedy:!0,alias:"attr-value"},punctuation:/[{]/}},punctuation:/[{}(),.]/};function Se(e,t,r,n,o,a,l){try{var i=e[a](l),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function Ee(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function l(e){Se(a,n,o,l,i,"next",e)}function i(e){Se(a,n,o,l,i,"throw",e)}l(void 0)}))}}function Pe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Pe(e,t,r[t])}))}return e}function Ae(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class Ne extends Q.DataSourceWithBackend{query(e){const t=e.targets.filter((e=>e.profileTypeId)).map((t=>""===t.labelSelector?Ae(Te({},t),{labelSelector:"{}"}):Fe(t,e.app)));return t.length?super.query(Ae(Te({},e),{targets:t})):(0,oe.of)({data:[]})}getProfileTypes(e,t){var r=this;return Ee((function*(){return yield r.getResource("profileTypes",{start:e,end:t})}))()}getAllProfileTypes(){var e=this;return Ee((function*(){return yield e.getResource("profileTypes")}))()}getLabelNames(e,t,r){var n=this;return Ee((function*(){return yield n.getResource("labelNames",{query:n.templateSrv.replace(e),start:t,end:r})}))()}getLabelValues(e,t,r,n){var o=this;return Ee((function*(){return yield o.getResource("labelValues",{label:o.templateSrv.replace(t),query:o.templateSrv.replace(e),start:r,end:n})}))()}getTagKeys(e){var t=this;return Ee((function*(){const r=t.adhocFilterData(e);return(yield t.getLabelNames(r.query,r.from,r.to)).map((e=>({text:e})))}))()}getTagValues(e){var t=this;return Ee((function*(){const r=t.adhocFilterData(e);return(yield t.getLabelValues(r.query,e.key,r.from,r.to)).map((e=>({text:e})))}))()}adhocFilterData(e){var t,r,n;var o;return{from:null!==(n=null===(t=e.timeRange)||void 0===t?void 0:t.from.valueOf())&&void 0!==n?n:Date.now()-864e5,to:null!==(o=null===(r=e.timeRange)||void 0===r?void 0:r.to.valueOf())&&void 0!==o?o:Date.now(),query:"{"+e.filters.map((e=>`${e.key}${e.operator}"${e.value}"`)).join(",")+"}"}}applyTemplateVariables(e,t,r){var n;let o=this.templateSrv.replace(null!==(n=e.labelSelector)&&void 0!==n?n:"",t);if(r&&o)for(const e of r)o=xe(o,e.key,e.value,e.operator);var a;return Ae(Te({},e),{labelSelector:o,profileTypeId:this.templateSrv.replace(null!==(a=e.profileTypeId)&&void 0!==a?a:"",t)})}importFromAbstractQueries(e){var t=this;return Ee((function*(){return e.map((e=>t.importFromAbstractQuery(e)))}))()}importFromAbstractQuery(e){return{refId:e.refId,labelSelector:ve(e.labelMatchers),queryType:"both",profileTypeId:"",groupBy:[]}}exportToAbstractQueries(e){var t=this;return Ee((function*(){return e.map((e=>t.exportToAbstractQuery(e)))}))()}exportToAbstractQuery(e){const t=e.labelSelector;if(!t||0===t.length)return{refId:e.refId,labelMatchers:[]};const r=ne().tokenize(t,Ce);return{refId:e.refId,labelMatchers:ye(r)}}getDefaultQuery(e){return Ie}constructor(e,t=(0,Q.getTemplateSrv)()){super(e),Pe(this,"templateSrv",void 0),this.templateSrv=t,this.variables=new be(this)}}const Ie=Ae(Te({},{groupBy:[],labelSelector:"{}",spanSelector:[]}),{queryType:"both"});function Fe(e,t){let r=Te({},Ie,e);return t!==g.CoreApp.Explore&&"both"===r.queryType&&(r.queryType="profile"),r}function De(e){const t=(0,v.useStyles2)(Le,e);return(0,m.jsx)("div",{className:t.root,children:e.children})}const Le=(e,t)=>{var r,n,o;return{root:(0,b.css)({display:"flex",flexDirection:null!==(r=t.direction)&&void 0!==r?r:"row",flexWrap:null===(n=t.wrap)||void 0===n||n?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!==(o=t.gap)&&void 0!==o?o:2),flexGrow:t.flexGrow})}};function ke(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Re(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ke(e,t,r[t])}))}return e}function qe(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Me=({children:e,stackProps:t})=>{const r=(0,v.useStyles2)(Be);return(0,m.jsx)("div",{className:r.root,children:(0,m.jsx)(De,qe(Re({gap:2},t),{children:e}))})},Be=e=>({root:(0,b.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.radius.default})}),We=({children:e})=>(0,m.jsx)(De,{gap:.5,direction:"column",children:e});const _e=function(e){var t=(0,y.useRef)(e);return t.current=e,t};var $e=function(){return $e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},$e.apply(this,arguments)};Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;function Ve(e,t,r){void 0===t&&(t=[]),void 0===r&&(r={loading:!1});var n,o,a=(0,y.useRef)(0),l=(n=(0,y.useRef)(!1),o=(0,y.useCallback)((function(){return n.current}),[]),(0,y.useEffect)((function(){return n.current=!0,function(){n.current=!1}}),[]),o),i=(0,y.useState)(r),s=i[0],c=i[1],u=(0,y.useCallback)((function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=++a.current;return s.loading||c((function(e){return $e($e({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return l()&&n===a.current&&c({value:e,loading:!1}),e}),(function(e){return l()&&n===a.current&&c({error:e,loading:!1}),e}))}),t);return[s,u]}const Je={id:"pyroscopeql",extensions:[".pyroscopeql"],aliases:["pyroscope","pyroscopeql"],mimetypes:[],def:{language:{ignoreCase:!1,defaultToken:"",tokenPostfix:".pyroscopeql",keywords:[],operators:[],symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,integersuffix:/(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,floatsuffix:/[fFlL]?/,tokenizer:{root:[[/[a-z_]\w*(?=\s*(=|!=|=~|!~))/,"tag"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/\d+/,"number"],[/\d*\d+[eE]([\-+]?\d+)?(@floatsuffix)/,"number.float"],[/\d*\.\d+([eE][\-+]?\d+)?(@floatsuffix)/,"number.float"],[/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/,"number.hex"],[/0[0-7']*[0-7](@integersuffix)/,"number.octal"],[/0[bB][0-1']*[0-1](@integersuffix)/,"number.binary"],[/\d[\d']*\d(@integersuffix)/,"number"],[/\d(@integersuffix)/,"number"]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],clauses:[[/[^(,)]/,"tag"],[/\)/,"identifier","@pop"]],whitespace:[[/[ \t\r\n]+/,"white"]]}},languageConfiguration:{wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()=+\[{\]}\\|;:'",<>\/?\s]+)/g,brackets:[["{","}"]],autoClosingPairs:[{open:"{",close:"}"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{}}}};function Ue(e,t,r,n,o,a,l){try{var i=e[a](l),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function ze(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Ke{init(e,t){this.labels=e,this.getLabelValues=t}provideCompletionItems(e,t){var r;if(!this.monaco||!this.editor)throw new Error("provideCompletionItems called before CompletionProvider was initialized");if((null===(r=this.editor.getModel())||void 0===r?void 0:r.id)!==e.id)return{suggestions:[]};const{range:n,offset:o}=function(e,t,r){const n=t.getWordAtPosition(r),o=null!=n?e.Range.lift({startLineNumber:r.lineNumber,endLineNumber:r.lineNumber,startColumn:n.startColumn,endColumn:n.endColumn}):e.Range.fromPositions(r),a={column:r.column,lineNumber:r.lineNumber},l=t.getOffsetAt(a);return{offset:l,range:o}}(this.monaco,e,t),a=function(e,t){if(""===e)return{type:"EMPTY"};const r=e.matchAll(Ye),n=Array.from(r).reduce(((e,t)=>{const[r,n,o]=t[1];return e.push({name:n,value:o}),e}),[]),o=e.substring(0,t).match(Ze);if(o)return{type:"IN_LABEL_VALUE",labelName:o[1],betweenQuotes:!!o[2],otherLabels:n};const a=e.substring(0,t).match(Xe);if(a)return{type:"IN_LABEL_NAME",otherLabels:n};return{type:"UNKNOWN"}}(e.getValue(),o);return this.getCompletions(a).then((e=>{const t=e.length.toString().length;return{suggestions:e.map(((e,r)=>({kind:Qe(e.type,this.monaco),label:e.label,insertText:e.insertText,sortText:r.toString().padStart(t,"0"),range:n})))}}))}getCompletions(e){var t,r=this;return(t=function*(){switch(e.type){case"UNKNOWN":return[];case"EMPTY":return r.labels.map((e=>({label:e,insertText:`{${e}="`,type:"LABEL_NAME"})));case"IN_LABEL_NAME":return r.labels.map((e=>({label:e,insertText:e,type:"LABEL_NAME"})));case"IN_LABEL_VALUE":let t=yield r.getLabelValues(e.labelName);return t?t.map((t=>({label:t,insertText:e.betweenQuotes?t:`"${t}"`,type:"LABEL_VALUE"}))):[];default:throw new Error(`Unexpected situation ${e}`)}},function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function l(e){Ue(a,n,o,l,i,"next",e)}function i(e){Ue(a,n,o,l,i,"throw",e)}l(void 0)}))})()}constructor(){ze(this,"triggerCharacters",["{",",","[","(","=","~"," ",'"']),ze(this,"monaco",void 0),ze(this,"editor",void 0),ze(this,"labels",[]),ze(this,"getLabelValues",(()=>Promise.resolve([])))}}function Qe(e,t){switch(e){case"LABEL_NAME":return t.languages.CompletionItemKind.Enum;case"LABEL_VALUE":return t.languages.CompletionItemKind.EnumMember;default:throw new Error(`Unexpected CompletionType: ${e}`)}}const He=/[a-zA-Z_][a-zA-Z0-9_]*/,Ge=/[^"]*/,Ye=new RegExp(`(${He.source})="(${Ge.source})"`,"g"),Ze=new RegExp(`(${He.source})=("?)${Ge.source}$`),Xe=new RegExp(/[{,]\s*[a-zA-Z0-9_]*$/);function et(e,t,r,n,o,a,l){try{var i=e[a](l),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function tt(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function l(e){et(a,n,o,l,i,"next",e)}function i(e){et(a,n,o,l,i,"throw",e)}l(void 0)}))}}function rt(e){const t=function(e,t){const r=(0,y.useRef)();void 0===r.current&&(r.current=new Ke);!function(e,t){void 0===t&&(t=[]);var r=Ve(e,t,{loading:!0}),n=r[0],o=r[1];(0,y.useEffect)((function(){o()}),[o])}(tt((function*(){r.current&&r.current.init(t||[],e)})),[t,e]);const n=(0,y.useRef)(null);return(0,y.useEffect)((()=>()=>{var e;null===(e=n.current)||void 0===e||e.call(n)}),[]),(e,t)=>{if(r.current){r.current.editor=e,r.current.monaco=t;const{dispose:o}=t.languages.registerCompletionItemProvider(at,r.current);n.current=o}}}(e.getLabelValues,e.labels),r=(0,v.useStyles2)(it),n=_e(e.onRunQuery),o=(0,y.useRef)(null);return(0,m.jsx)("div",{className:r.wrapper,ref:o,children:(0,m.jsx)(v.CodeEditor,{value:e.value,language:at,onChange:e.onChange,containerStyles:r.queryField,monacoOptions:{folding:!1,fontSize:14,lineNumbers:"off",overviewRulerLanes:0,renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,wordWrap:"on",padding:{top:4,bottom:5}},onBeforeEditorMount:lt,onEditorDidMount:(e,r)=>{t(e,r);const a=()=>{const t=o.current;if(null!==t){const r=e.getContentHeight();t.style.height=`${r+nt}px`,t.style.width="100%";const n=t.clientWidth;e.layout({width:n,height:r})}};e.onDidContentSizeChange(a),a(),e.addCommand(r.KeyMod.Shift|r.KeyCode.Enter,(()=>{n.current(e.getValue())}))}})})}const nt=2;let ot=!1;const at="pyroscopeql";function lt(e){if(!1===ot){ot=!0;const{aliases:t,extensions:r,mimetypes:n,def:o}=Je;e.languages.register({id:at,aliases:t,extensions:r,mimetypes:n}),e.languages.setMonarchTokensProvider(at,o.language),e.languages.setLanguageConfiguration(at,o.languageConfiguration)}}const it=e=>({queryField:(0,b.css)({label:"LabelsEditorQueryField",flex:1,width:"100px"}),wrapper:(0,b.css)({label:"LabelsEditorWrapper",display:"flex",flex:1,border:"1px solid rgba(36, 41, 46, 0.3)",borderRadius:e.shape.radius.default})});function st(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ct(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){st(e,t,r[t])}))}return e}function ut(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function dt(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}const pt=e=>{const{label:t,optional:r,tooltip:n,children:o,width:a}=e,l=dt(e,["label","optional","tooltip","children","width"]),i=(0,v.useStyles2)(ft,a),s=(null==l?void 0:l.htmlFor)||(null===v.ReactUtils||void 0===v.ReactUtils?void 0:v.ReactUtils.getChildId(o)),c=(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("label",{className:i.label,htmlFor:s,children:[t,r&&(0,m.jsx)("span",{className:i.optional,children:" - optional"}),n&&(0,m.jsx)(v.Tooltip,{placement:"top",content:n,theme:"info",children:(0,m.jsx)(v.Icon,{name:"info-circle",size:"sm",className:i.icon})})]}),(0,m.jsx)("span",{className:i.space})]});return(0,m.jsx)("div",{className:i.root,children:(0,m.jsx)(v.Field,ut(ct({className:i.field,label:c},l),{children:o}))})},ft=(e,t)=>({space:(0,b.css)({paddingRight:e.spacing(0),paddingBottom:e.spacing(.5)}),root:(0,b.css)({minWidth:e.spacing(null!=t?t:0)}),label:(0,b.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium}),optional:(0,b.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,b.css)({marginBottom:0}),icon:(0,b.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})});var ht=function(e,t){return"boolean"==typeof t?t:!e};const gt=function(e){return(0,y.useReducer)(ht,e)};function mt({title:e,children:t,collapsedInfo:r}){const[n,o]=gt(!1),a=(0,v.useStyles2)(bt);return(0,m.jsx)("div",{className:a.wrapper,children:(0,m.jsx)(v.Collapse,{className:a.collapse,collapsible:!0,isOpen:n,onToggle:o,label:(0,m.jsxs)(v.Stack,{gap:0,children:[(0,m.jsx)("h6",{className:a.title,children:e}),!n&&(0,m.jsx)("div",{className:a.description,children:r.map(((e,t)=>(0,m.jsx)("span",{children:e},t)))})]}),children:(0,m.jsx)("div",{className:a.body,children:t})})})}const bt=e=>({collapse:(0,b.css)({backgroundColor:"unset",border:"unset",marginBottom:0,"> button":{padding:e.spacing(0,1)}}),wrapper:(0,b.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,b.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,b.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.bodySmall.fontWeight,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,b.css)({display:"flex",gap:e.spacing(2),flexWrap:"wrap"})});function yt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){yt(e,t,r[t])}))}return e}function Ot(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const jt=[{value:"metrics",label:"Metric",description:"Return aggregated metrics"},{value:"profile",label:"Profile",description:"Return profile"},{value:"both",label:"Both",description:"Return both metric and profile data"}];function wt(e){return e===g.CoreApp.Explore?jt:jt.filter((e=>"both"!==e.value))}function xt({query:e,onQueryChange:t,app:r,labels:n}){var o,a;const l=(0,v.useStyles2)(Ct),i=wt(r),s=n?n.map((e=>({label:e,value:e}))):[];let c=[`Type: ${e.queryType}`];return(null===(o=e.groupBy)||void 0===o?void 0:o.length)&&c.push(`Group by: ${e.groupBy.join(", ")}`),e.limit&&c.push(`Limit: ${e.limit}`),(null===(a=e.spanSelector)||void 0===a?void 0:a.length)&&c.push(`Span ID: ${e.spanSelector.join(", ")}`),e.maxNodes&&c.push(`Max nodes: ${e.maxNodes}`),(0,m.jsx)(De,{gap:0,direction:"column",children:(0,m.jsx)(mt,{title:"Options",collapsedInfo:c,children:(0,m.jsxs)("div",{className:l.body,children:[(0,m.jsx)(pt,{label:"Query Type",children:(0,m.jsx)(v.RadioButtonGroup,{options:i,value:e.queryType,onChange:r=>t(Ot(vt({},e),{queryType:r}))})}),(0,m.jsx)(pt,{label:"Group by",tooltip:(0,m.jsx)(m.Fragment,{children:"Used to group the metric result by a specific label or set of labels. Does not apply to profile query."}),children:(0,m.jsx)(v.MultiSelect,{placeholder:"Label",value:e.groupBy,allowCustomValue:!0,options:s,onChange:r=>{const n=r.map((e=>e.value));t(Ot(vt({},e),{groupBy:n}))}})}),(0,m.jsx)(pt,{label:"Limit",tooltip:(0,m.jsx)(m.Fragment,{children:'When "Group by" is set, limits the maximum number of series to return. Does not apply to profile query.'}),children:(0,m.jsx)(v.Input,{value:e.limit||"",type:"number",placeholder:"0",onChange:r=>{let n=parseInt(r.currentTarget.value,10);n=isNaN(n)?0:n,t(Ot(vt({},e),{limit:n}))}})}),(0,m.jsx)(pt,{label:"Span ID",tooltip:(0,m.jsx)(m.Fragment,{children:"Sets the span ID from which to search for profiles."}),children:(0,m.jsx)(v.Input,{value:e.spanSelector||[""],type:"string",placeholder:"64f170a95f537095",onChange:r=>{t(Ot(vt({},e),{spanSelector:""!==r.currentTarget.value?[r.currentTarget.value]:[]}))}})}),(0,m.jsx)(pt,{label:"Max Nodes",tooltip:(0,m.jsx)(m.Fragment,{children:"Sets the maximum number of nodes to return in the flamegraph."}),children:(0,m.jsx)(v.Input,{value:e.maxNodes||"",type:"number",placeholder:"16384",onChange:r=>{let n=parseInt(r.currentTarget.value,10);n=isNaN(n)?0:n,t(Ot(vt({},e),{maxNodes:n}))}})})]})})})}const Ct=e=>({switchLabel:(0,b.css)({color:e.colors.text.secondary,cursor:"pointer",fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.text.primary}}),body:(0,b.css)({display:"flex",paddingTop:e.spacing(2),gap:e.spacing(2),flexWrap:"wrap"})});function St(e,t,r,n,o,a,l){try{var i=e[a](l),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function Et(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Et(e,t,r[t])}))}return e}function Tt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const At=/(\w+)\s*=\s*("[^,"]+")/g;const Nt=new g.DataSourcePlugin(Ne).setConfigEditor((e=>{const{options:t,onOptionsChange:r}=e,n=(0,v.useStyles2)(Z);return(0,m.jsxs)("div",{className:n.container,children:[(0,m.jsx)(O,{dataSourceName:"Pyroscope",docsLink:"https://grafana.com/docs/grafana/latest/datasources/pyroscope",hasRequiredFields:!1}),(0,m.jsx)(v.Divider,{spacing:4}),(0,m.jsx)(x,{config:t,onChange:r,urlPlaceholder:"http://localhost:4040"}),(0,m.jsx)(v.Divider,{spacing:4}),(0,m.jsx)(M,G({},_({config:t,onChange:r}))),(0,m.jsx)(v.Divider,{spacing:4}),(0,m.jsx)(w,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!1,children:(0,m.jsxs)(v.Stack,{gap:5,direction:"column",children:[(0,m.jsx)(K,{config:t,onChange:r}),Q.config.secureSocksDSProxyEnabled&&(0,m.jsx)(v.SecureSocksProxySettings,{options:t,onOptionsChange:r}),(0,m.jsx)(E,{title:"Querying",children:(0,m.jsx)(v.LegacyForms.FormField,{label:"Minimal step",labelWidth:13,inputEl:(0,m.jsx)(v.LegacyForms.Input,{className:"width-6",value:t.jsonData.minStep,spellCheck:!1,placeholder:"15s",onChange:e=>{r(Y(G({},t),{jsonData:Y(G({},t.jsonData),{minStep:e.currentTarget.value})}))},validationEvents:{[v.EventsWithValidation.onBlur]:[(0,v.regexValidation)(/^$|^\d+(ms|[Mwdhmsy])$/,"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s")]}}),tooltip:"Minimal step used for metric query. Should be the same or higher as the scrape interval setting in the Pyroscope database."})})]})})]})})).setQueryEditor((function(e){const{onChange:t,onRunQuery:r,datasource:n,query:o,range:a,app:l}=e,i=function(e,t){const r=(0,y.useRef)(e);r.current=e;const n=(0,te.debounce)((e=>{t&&t(Tt(Pt({},r.current),{labelSelector:e}))}),200),o=(0,y.useCallback)((e=>{n(e)}),[n]);return o}(o,t),s=ie(n,a),{labels:c,getLabelValues:u}=function(e,t,r){const n={to:1e4*Math.ceil(((null==e?void 0:e.to.valueOf())||0)/1e4),from:1e4*Math.floor(((null==e?void 0:e.from.valueOf())||0)/1e4)},o=(e,t,r)=>{let n,o=[`__profile_type__="${t}"`];for(;null!==(n=At.exec(e));)if(n[1]&&n[2]){if(n[1]===r)continue;o.push(`${n[1]}=${n[2]}`)}return`{${o.join(",")}}`},[a,l]=(0,y.useState)((()=>[""]));(0,y.useEffect)((()=>{const e=function(){var e,a=(e=function*(){const e=yield t.getLabelNames(o(r.labelSelector,r.profileTypeId,""),n.from,n.to);l(e)},function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function l(e){St(a,n,o,l,i,"next",e)}function i(e){St(a,n,o,l,i,"throw",e)}l(void 0)}))});return function(){return a.apply(this,arguments)}}();e()}),[r,n.from,n.to,t,l]);const i=(0,y.useCallback)((e=>{const a=o(r.labelSelector,r.profileTypeId,e);return t.getLabelValues(a,e,n.from,n.to)}),[t,r.labelSelector,r.profileTypeId,n.to,n.from]);return{labels:a,getLabelValues:i}}(a,n,o);!function(e,t,r,n){(0,y.useEffect)((()=>{if(!t)return;const o=Fe(e,n);e.profileTypeId||(o.profileTypeId=function(e){var t;const r=e.filter((e=>e.id.indexOf("cpu")>=0));if(r.length){const e=r.find((e=>-1===e.id.indexOf("samples")));return e?e.id:r[0].id}return(null===(t=e[0])||void 0===t?void 0:t.id)||""}(t)),ee()(e,o)||r(o)}),[n,e,t,r])}(o,s,t,l);let d=(0,m.jsx)(v.LoadingPlaceholder,{text:"Loading"});return s&&void 0!==o.profileTypeId&&(d=(0,m.jsx)(le,{placeholder:0===s.length?"No profile types found":"Select profile type",profileTypes:s,initialProfileTypeId:o.profileTypeId,onChange:e=>{t(Tt(Pt({},o),{profileTypeId:e}))}})),(0,m.jsxs)(We,{children:[(0,m.jsxs)(Me,{stackProps:{wrap:!1,gap:1},children:[d,(0,m.jsx)(rt,{value:o.labelSelector,onChange:i,onRunQuery:function(e){t(Tt(Pt({},o),{labelSelector:e})),r()},labels:c,getLabelValues:u})]}),(0,m.jsx)(Me,{children:(0,m.jsx)(xt,{query:o,onQueryChange:e.onChange,app:e.app,labels:c})})]})}));return p})()));
//# sourceMappingURL=module.js.map