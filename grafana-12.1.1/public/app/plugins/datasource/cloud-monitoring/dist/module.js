/*! For license information please see module.js.LICENSE.txt */
/* [create-plugin] version: 5.22.0 */
define(["module","lodash","@grafana/data","@grafana/runtime","react","@emotion/css","@grafana/ui","rxjs","rxjs/operators"],((e,t,r,n,o,i,a,u,c)=>(()=>{"use strict";var l={635:e=>{e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=void 0,o=void 0,i=void 0,a=[];return function(){var c=function(e){return"function"==typeof e?e():e}(t),l=(new Date).getTime(),s=!n||l-n>c;n=l;for(var p=arguments.length,f=Array(p),d=0;d<p;d++)f[d]=arguments[d];if(s&&r.leading)return r.accumulate?Promise.resolve(e.call(this,[f])).then((function(e){return e[0]})):Promise.resolve(e.call.apply(e,[this].concat(f)));if(o?clearTimeout(i):o=function(){var e={};return e.promise=new Promise((function(t,r){e.resolve=t,e.reject=r})),e}(),a.push(f),i=setTimeout(u.bind(this),c),r.accumulate){var y=a.length-1;return o.promise.then((function(e){return e[y]}))}return o.promise};function u(){var t=o;clearTimeout(i),Promise.resolve(r.accumulate?e.call(this,a):e.apply(this,a[a.length-1])).then(t.resolve,t.reject),a=[],o=null}}},513:e=>{e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,o,i;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(o=n;0!=o--;)if(!e(t[o],r[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(i=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(o=n;0!=o--;)if(!Object.prototype.hasOwnProperty.call(r,i[o]))return!1;for(o=n;0!=o--;){var a=i[o];if(!e(t[a],r[a]))return!1}return!0}return t!=t&&r!=r}},44:(e,t,r)=>{var n=r(959),o=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,u=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,r){var n,i={},l=null,s=null;for(n in void 0!==r&&(l=""+r),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(s=t.ref),t)a.call(t,n)&&!c.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:o,type:e,key:l,ref:s,props:i,_owner:u.current}}t.Fragment=i,t.jsx=l,t.jsxs=l},728:(e,t,r)=>{e.exports=r(44)},89:e=>{e.exports=i},781:e=>{e.exports=r},531:e=>{e.exports=n},7:e=>{e.exports=a},241:e=>{e.exports=t},308:t=>{t.exports=e},959:e=>{e.exports=o},269:e=>{e.exports=u},59:e=>{e.exports=c}},s={};function p(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={exports:{}};return l[e](r,r.exports,p),r.exports}p.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return p.d(t,{a:t}),t},p.d=(e,t)=>{for(var r in t)p.o(t,r)&&!p.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},p.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},p.p="public/plugins/stackdriver/";var f={};p.r(f),p.d(f,{plugin:()=>an});var d=p(308),y=p.n(d);p.p=y()&&y().uri?y().uri.slice(0,y().uri.lastIndexOf("/")+1):"public/plugins/stackdriver/";var h=p(241),v=p(781),g=p(531),m=p(728),b=p(89),O=p(959);class j extends O.PureComponent{render(){return(0,m.jsxs)("div",{children:[(0,m.jsx)("h2",{children:"Cloud Monitoring alias patterns"}),(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{children:"Format the legend keys any way you want by using alias patterns. Format the legend keys any way you want by using alias patterns."}),"Example:",(0,m.jsx)("code",{children:"{{metric.name}} - {{metric.label.instance_name}}"}),(0,m.jsx)("br",{}),"Result:   ",(0,m.jsx)("code",{children:"cpu/usage_time - server1-europe-west-1"}),(0,m.jsx)("br",{}),(0,m.jsx)("br",{}),(0,m.jsx)("span",{children:"Patterns:"}),(0,m.jsx)("br",{}),(0,m.jsxs)("ul",{className:(0,b.css)({listStyle:"none"}),children:[(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{metric.type}}"})," = metric type e.g. compute.googleapis.com/instance/cpu/usage_time"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{metric.name}}"})," = name part of metric e.g. instance/cpu/usage_time"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{metric.service}}"})," = service part of metric e.g. compute"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{metric.label.label_name}}"})," = Metric label metadata e.g. metric.label.instance_name"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{resource.label.label_name}}"})," = Resource label metadata e.g. resource.label.zone"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{metadata.system_labels.name}}"})," = Meta data system labels e.g. metadata.system_labels.name. For this to work, the needs to be included in the group by"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{metadata.user_labels.name}}"})," = Meta data user labels e.g. metadata.user_labels.name. For this to work, the needs to be included in the group by"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{bucket}}"})," = bucket boundary for distribution metrics when using a heatmap in Grafana"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{project}}"})," = The project name that was specified in the query editor"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{service}}"})," = The service id that was specified in the SLO query editor"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{slo}}"})," = The SLO id that was specified in the SLO query editor"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"{{selector}}"})," = The Selector function that was specified in the SLO query editor"]})]})]})]})}}var _=p(7);const E="jwt",S="gce",T=e=>e.jsonData.authenticationType?e:{...e,jsonData:{...e.jsonData,authenticationType:E}};var w,P="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},x={exports:{}};var I,N,D=(w||(w=1,I=x,N=x.exports,function(){var e,t="Expected a function",r="__lodash_hash_undefined__",n="__lodash_placeholder__",o=32,i=128,a=256,u=1/0,c=9007199254740991,l=NaN,s=4294967295,p=[["ary",i],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",o],["partialRight",64],["rearg",a]],f="[object Arguments]",d="[object Array]",y="[object Boolean]",h="[object Date]",v="[object Error]",g="[object Function]",m="[object GeneratorFunction]",b="[object Map]",O="[object Number]",j="[object Object]",_="[object Promise]",E="[object RegExp]",S="[object Set]",T="[object String]",w="[object Symbol]",x="[object WeakMap]",D="[object ArrayBuffer]",L="[object DataView]",A="[object Float32Array]",C="[object Float64Array]",R="[object Int8Array]",k="[object Int16Array]",U="[object Int32Array]",M="[object Uint8Array]",G="[object Uint8ClampedArray]",Q="[object Uint16Array]",B="[object Uint32Array]",q=/\b__p \+= '';/g,F=/\b(__p \+=) '' \+/g,V=/(__e\(.*?\)|\b__t\)) \+\n'';/g,K=/&(?:amp|lt|gt|quot|#39);/g,$=/[&<>"']/g,W=RegExp(K.source),z=RegExp($.source),Y=/<%-([\s\S]+?)%>/g,J=/<%([\s\S]+?)%>/g,H=/<%=([\s\S]+?)%>/g,Z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,X=/^\w*$/,ee=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,te=/[\\^$.*+?()[\]{}|]/g,re=RegExp(te.source),ne=/^\s+/,oe=/\s/,ie=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ae=/\{\n\/\* \[wrapped with (.+)\] \*/,ue=/,? & /,ce=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,le=/[()=,{}\[\]\/\s]/,se=/\\(\\)?/g,pe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,fe=/\w*$/,de=/^[-+]0x[0-9a-f]+$/i,ye=/^0b[01]+$/i,he=/^\[object .+?Constructor\]$/,ve=/^0o[0-7]+$/i,ge=/^(?:0|[1-9]\d*)$/,me=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,be=/($^)/,Oe=/['\n\r\u2028\u2029\\]/g,je="\\ud800-\\udfff",_e="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ee="\\u2700-\\u27bf",Se="a-z\\xdf-\\xf6\\xf8-\\xff",Te="A-Z\\xc0-\\xd6\\xd8-\\xde",we="\\ufe0e\\ufe0f",Pe="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",xe="['’]",Ie="["+je+"]",Ne="["+Pe+"]",De="["+_e+"]",Le="\\d+",Ae="["+Ee+"]",Ce="["+Se+"]",Re="[^"+je+Pe+Le+Ee+Se+Te+"]",ke="\\ud83c[\\udffb-\\udfff]",Ue="[^"+je+"]",Me="(?:\\ud83c[\\udde6-\\uddff]){2}",Ge="[\\ud800-\\udbff][\\udc00-\\udfff]",Qe="["+Te+"]",Be="\\u200d",qe="(?:"+Ce+"|"+Re+")",Fe="(?:"+Qe+"|"+Re+")",Ve="(?:['’](?:d|ll|m|re|s|t|ve))?",Ke="(?:['’](?:D|LL|M|RE|S|T|VE))?",$e="(?:"+De+"|"+ke+")?",We="["+we+"]?",ze=We+$e+"(?:"+Be+"(?:"+[Ue,Me,Ge].join("|")+")"+We+$e+")*",Ye="(?:"+[Ae,Me,Ge].join("|")+")"+ze,Je="(?:"+[Ue+De+"?",De,Me,Ge,Ie].join("|")+")",He=RegExp(xe,"g"),Ze=RegExp(De,"g"),Xe=RegExp(ke+"(?="+ke+")|"+Je+ze,"g"),et=RegExp([Qe+"?"+Ce+"+"+Ve+"(?="+[Ne,Qe,"$"].join("|")+")",Fe+"+"+Ke+"(?="+[Ne,Qe+qe,"$"].join("|")+")",Qe+"?"+qe+"+"+Ve,Qe+"+"+Ke,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Le,Ye].join("|"),"g"),tt=RegExp("["+Be+je+_e+we+"]"),rt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,nt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ot=-1,it={};it[A]=it[C]=it[R]=it[k]=it[U]=it[M]=it[G]=it[Q]=it[B]=!0,it[f]=it[d]=it[D]=it[y]=it[L]=it[h]=it[v]=it[g]=it[b]=it[O]=it[j]=it[E]=it[S]=it[T]=it[x]=!1;var at={};at[f]=at[d]=at[D]=at[L]=at[y]=at[h]=at[A]=at[C]=at[R]=at[k]=at[U]=at[b]=at[O]=at[j]=at[E]=at[S]=at[T]=at[w]=at[M]=at[G]=at[Q]=at[B]=!0,at[v]=at[g]=at[x]=!1;var ut={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ct=parseFloat,lt=parseInt,st="object"==typeof P&&P&&P.Object===Object&&P,pt="object"==typeof self&&self&&self.Object===Object&&self,ft=st||pt||Function("return this")(),dt=N&&!N.nodeType&&N,yt=dt&&I&&!I.nodeType&&I,ht=yt&&yt.exports===dt,vt=ht&&st.process,gt=function(){try{var e=yt&&yt.require&&yt.require("util").types;return e||vt&&vt.binding&&vt.binding("util")}catch(e){}}(),mt=gt&&gt.isArrayBuffer,bt=gt&&gt.isDate,Ot=gt&&gt.isMap,jt=gt&&gt.isRegExp,_t=gt&&gt.isSet,Et=gt&&gt.isTypedArray;function St(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function Tt(e,t,r,n){for(var o=-1,i=null==e?0:e.length;++o<i;){var a=e[o];t(n,a,r(a),e)}return n}function wt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function Pt(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}function xt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function It(e,t){for(var r=-1,n=null==e?0:e.length,o=0,i=[];++r<n;){var a=e[r];t(a,r,e)&&(i[o++]=a)}return i}function Nt(e,t){return!(null==e||!e.length)&&Qt(e,t,0)>-1}function Dt(e,t,r){for(var n=-1,o=null==e?0:e.length;++n<o;)if(r(t,e[n]))return!0;return!1}function Lt(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}function At(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}function Ct(e,t,r,n){var o=-1,i=null==e?0:e.length;for(n&&i&&(r=e[++o]);++o<i;)r=t(r,e[o],o,e);return r}function Rt(e,t,r,n){var o=null==e?0:e.length;for(n&&o&&(r=e[--o]);o--;)r=t(r,e[o],o,e);return r}function kt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var Ut=Vt("length");function Mt(e,t,r){var n;return r(e,(function(e,r,o){if(t(e,r,o))return n=r,!1})),n}function Gt(e,t,r,n){for(var o=e.length,i=r+(n?1:-1);n?i--:++i<o;)if(t(e[i],i,e))return i;return-1}function Qt(e,t,r){return t==t?function(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1}(e,t,r):Gt(e,qt,r)}function Bt(e,t,r,n){for(var o=r-1,i=e.length;++o<i;)if(n(e[o],t))return o;return-1}function qt(e){return e!=e}function Ft(e,t){var r=null==e?0:e.length;return r?Wt(e,t)/r:l}function Vt(t){return function(r){return null==r?e:r[t]}}function Kt(t){return function(r){return null==t?e:t[r]}}function $t(e,t,r,n,o){return o(e,(function(e,o,i){r=n?(n=!1,e):t(r,e,o,i)})),r}function Wt(t,r){for(var n,o=-1,i=t.length;++o<i;){var a=r(t[o]);a!==e&&(n=n===e?a:n+a)}return n}function zt(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function Yt(e){return e?e.slice(0,fr(e)+1).replace(ne,""):e}function Jt(e){return function(t){return e(t)}}function Ht(e,t){return Lt(t,(function(t){return e[t]}))}function Zt(e,t){return e.has(t)}function Xt(e,t){for(var r=-1,n=e.length;++r<n&&Qt(t,e[r],0)>-1;);return r}function er(e,t){for(var r=e.length;r--&&Qt(t,e[r],0)>-1;);return r}var tr=Kt({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),rr=Kt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function nr(e){return"\\"+ut[e]}function or(e){return tt.test(e)}function ir(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function ar(e,t){return function(r){return e(t(r))}}function ur(e,t){for(var r=-1,o=e.length,i=0,a=[];++r<o;){var u=e[r];u!==t&&u!==n||(e[r]=n,a[i++]=r)}return a}function cr(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}function lr(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=[e,e]})),r}function sr(e){return or(e)?function(e){for(var t=Xe.lastIndex=0;Xe.test(e);)++t;return t}(e):Ut(e)}function pr(e){return or(e)?function(e){return e.match(Xe)||[]}(e):function(e){return e.split("")}(e)}function fr(e){for(var t=e.length;t--&&oe.test(e.charAt(t)););return t}var dr=Kt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),yr=function P(I){var N,oe=(I=null==I?ft:yr.defaults(ft.Object(),I,yr.pick(ft,nt))).Array,je=I.Date,_e=I.Error,Ee=I.Function,Se=I.Math,Te=I.Object,we=I.RegExp,Pe=I.String,xe=I.TypeError,Ie=oe.prototype,Ne=Ee.prototype,De=Te.prototype,Le=I["__core-js_shared__"],Ae=Ne.toString,Ce=De.hasOwnProperty,Re=0,ke=(N=/[^.]+$/.exec(Le&&Le.keys&&Le.keys.IE_PROTO||""))?"Symbol(src)_1."+N:"",Ue=De.toString,Me=Ae.call(Te),Ge=ft._,Qe=we("^"+Ae.call(Ce).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Be=ht?I.Buffer:e,qe=I.Symbol,Fe=I.Uint8Array,Ve=Be?Be.allocUnsafe:e,Ke=ar(Te.getPrototypeOf,Te),$e=Te.create,We=De.propertyIsEnumerable,ze=Ie.splice,Ye=qe?qe.isConcatSpreadable:e,Je=qe?qe.iterator:e,Xe=qe?qe.toStringTag:e,tt=function(){try{var e=pi(Te,"defineProperty");return e({},"",{}),e}catch(e){}}(),ut=I.clearTimeout!==ft.clearTimeout&&I.clearTimeout,st=je&&je.now!==ft.Date.now&&je.now,pt=I.setTimeout!==ft.setTimeout&&I.setTimeout,dt=Se.ceil,yt=Se.floor,vt=Te.getOwnPropertySymbols,gt=Be?Be.isBuffer:e,Ut=I.isFinite,Kt=Ie.join,hr=ar(Te.keys,Te),vr=Se.max,gr=Se.min,mr=je.now,br=I.parseInt,Or=Se.random,jr=Ie.reverse,_r=pi(I,"DataView"),Er=pi(I,"Map"),Sr=pi(I,"Promise"),Tr=pi(I,"Set"),wr=pi(I,"WeakMap"),Pr=pi(Te,"create"),xr=wr&&new wr,Ir={},Nr=Ui(_r),Dr=Ui(Er),Lr=Ui(Sr),Ar=Ui(Tr),Cr=Ui(wr),Rr=qe?qe.prototype:e,kr=Rr?Rr.valueOf:e,Ur=Rr?Rr.toString:e;function Mr(e){if(eu(e)&&!Fa(e)&&!(e instanceof qr)){if(e instanceof Br)return e;if(Ce.call(e,"__wrapped__"))return Mi(e)}return new Br(e)}var Gr=function(){function t(){}return function(r){if(!Xa(r))return{};if($e)return $e(r);t.prototype=r;var n=new t;return t.prototype=e,n}}();function Qr(){}function Br(t,r){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!r,this.__index__=0,this.__values__=e}function qr(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=s,this.__views__=[]}function Fr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Vr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Kr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function $r(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Kr;++t<r;)this.add(e[t])}function Wr(e){var t=this.__data__=new Vr(e);this.size=t.size}function zr(e,t){var r=Fa(e),n=!r&&qa(e),o=!r&&!n&&Wa(e),i=!r&&!n&&!o&&cu(e),a=r||n||o||i,u=a?zt(e.length,Pe):[],c=u.length;for(var l in e)!t&&!Ce.call(e,l)||a&&("length"==l||o&&("offset"==l||"parent"==l)||i&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||mi(l,c))||u.push(l);return u}function Yr(t){var r=t.length;return r?t[Wn(0,r-1)]:e}function Jr(e,t){return Ci(Io(e),an(t,0,e.length))}function Hr(e){return Ci(Io(e))}function Zr(t,r,n){(n!==e&&!Ga(t[r],n)||n===e&&!(r in t))&&nn(t,r,n)}function Xr(t,r,n){var o=t[r];Ce.call(t,r)&&Ga(o,n)&&(n!==e||r in t)||nn(t,r,n)}function en(e,t){for(var r=e.length;r--;)if(Ga(e[r][0],t))return r;return-1}function tn(e,t,r,n){return pn(e,(function(e,o,i){t(n,e,r(e),i)})),n}function rn(e,t){return e&&No(t,Nu(t),e)}function nn(e,t,r){"__proto__"==t&&tt?tt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function on(t,r){for(var n=-1,o=r.length,i=oe(o),a=null==t;++n<o;)i[n]=a?e:Tu(t,r[n]);return i}function an(t,r,n){return t==t&&(n!==e&&(t=t<=n?t:n),r!==e&&(t=t>=r?t:r)),t}function un(t,r,n,o,i,a){var u,c=1&r,l=2&r,s=4&r;if(n&&(u=i?n(t,o,i,a):n(t)),u!==e)return u;if(!Xa(t))return t;var p=Fa(t);if(p){if(u=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Ce.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(t),!c)return Io(t,u)}else{var d=yi(t),v=d==g||d==m;if(Wa(t))return Eo(t,c);if(d==j||d==f||v&&!i){if(u=l||v?{}:vi(t),!c)return l?function(e,t){return No(e,di(e),t)}(t,function(e,t){return e&&No(t,Du(t),e)}(u,t)):function(e,t){return No(e,fi(e),t)}(t,rn(u,t))}else{if(!at[d])return i?t:{};u=function(e,t,r){var n,o=e.constructor;switch(t){case D:return So(e);case y:case h:return new o(+e);case L:return function(e,t){var r=t?So(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case A:case C:case R:case k:case U:case M:case G:case Q:case B:return To(e,r);case b:return new o;case O:case T:return new o(e);case E:return function(e){var t=new e.constructor(e.source,fe.exec(e));return t.lastIndex=e.lastIndex,t}(e);case S:return new o;case w:return n=e,kr?Te(kr.call(n)):{}}}(t,d,c)}}a||(a=new Wr);var _=a.get(t);if(_)return _;a.set(t,u),iu(t)?t.forEach((function(e){u.add(un(e,r,n,e,t,a))})):tu(t)&&t.forEach((function(e,o){u.set(o,un(e,r,n,o,t,a))}));var P=p?e:(s?l?oi:ni:l?Du:Nu)(t);return wt(P||t,(function(e,o){P&&(e=t[o=e]),Xr(u,o,un(e,r,n,o,t,a))})),u}function cn(t,r,n){var o=n.length;if(null==t)return!o;for(t=Te(t);o--;){var i=n[o],a=r[i],u=t[i];if(u===e&&!(i in t)||!a(u))return!1}return!0}function ln(r,n,o){if("function"!=typeof r)throw new xe(t);return Ni((function(){r.apply(e,o)}),n)}function sn(e,t,r,n){var o=-1,i=Nt,a=!0,u=e.length,c=[],l=t.length;if(!u)return c;r&&(t=Lt(t,Jt(r))),n?(i=Dt,a=!1):t.length>=200&&(i=Zt,a=!1,t=new $r(t));e:for(;++o<u;){var s=e[o],p=null==r?s:r(s);if(s=n||0!==s?s:0,a&&p==p){for(var f=l;f--;)if(t[f]===p)continue e;c.push(s)}else i(t,p,n)||c.push(s)}return c}Mr.templateSettings={escape:Y,evaluate:J,interpolate:H,variable:"",imports:{_:Mr}},Mr.prototype=Qr.prototype,Mr.prototype.constructor=Mr,Br.prototype=Gr(Qr.prototype),Br.prototype.constructor=Br,qr.prototype=Gr(Qr.prototype),qr.prototype.constructor=qr,Fr.prototype.clear=function(){this.__data__=Pr?Pr(null):{},this.size=0},Fr.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Fr.prototype.get=function(t){var n=this.__data__;if(Pr){var o=n[t];return o===r?e:o}return Ce.call(n,t)?n[t]:e},Fr.prototype.has=function(t){var r=this.__data__;return Pr?r[t]!==e:Ce.call(r,t)},Fr.prototype.set=function(t,n){var o=this.__data__;return this.size+=this.has(t)?0:1,o[t]=Pr&&n===e?r:n,this},Vr.prototype.clear=function(){this.__data__=[],this.size=0},Vr.prototype.delete=function(e){var t=this.__data__,r=en(t,e);return!(r<0||(r==t.length-1?t.pop():ze.call(t,r,1),--this.size,0))},Vr.prototype.get=function(t){var r=this.__data__,n=en(r,t);return n<0?e:r[n][1]},Vr.prototype.has=function(e){return en(this.__data__,e)>-1},Vr.prototype.set=function(e,t){var r=this.__data__,n=en(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},Kr.prototype.clear=function(){this.size=0,this.__data__={hash:new Fr,map:new(Er||Vr),string:new Fr}},Kr.prototype.delete=function(e){var t=li(this,e).delete(e);return this.size-=t?1:0,t},Kr.prototype.get=function(e){return li(this,e).get(e)},Kr.prototype.has=function(e){return li(this,e).has(e)},Kr.prototype.set=function(e,t){var r=li(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},$r.prototype.add=$r.prototype.push=function(e){return this.__data__.set(e,r),this},$r.prototype.has=function(e){return this.__data__.has(e)},Wr.prototype.clear=function(){this.__data__=new Vr,this.size=0},Wr.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Wr.prototype.get=function(e){return this.__data__.get(e)},Wr.prototype.has=function(e){return this.__data__.has(e)},Wr.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Vr){var n=r.__data__;if(!Er||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Kr(n)}return r.set(e,t),this.size=r.size,this};var pn=Ao(bn),fn=Ao(On,!0);function dn(e,t){var r=!0;return pn(e,(function(e,n,o){return r=!!t(e,n,o)})),r}function yn(t,r,n){for(var o=-1,i=t.length;++o<i;){var a=t[o],u=r(a);if(null!=u&&(c===e?u==u&&!uu(u):n(u,c)))var c=u,l=a}return l}function hn(e,t){var r=[];return pn(e,(function(e,n,o){t(e,n,o)&&r.push(e)})),r}function vn(e,t,r,n,o){var i=-1,a=e.length;for(r||(r=gi),o||(o=[]);++i<a;){var u=e[i];t>0&&r(u)?t>1?vn(u,t-1,r,n,o):At(o,u):n||(o[o.length]=u)}return o}var gn=Co(),mn=Co(!0);function bn(e,t){return e&&gn(e,t,Nu)}function On(e,t){return e&&mn(e,t,Nu)}function jn(e,t){return It(t,(function(t){return Ja(e[t])}))}function _n(t,r){for(var n=0,o=(r=bo(r,t)).length;null!=t&&n<o;)t=t[ki(r[n++])];return n&&n==o?t:e}function En(e,t,r){var n=t(e);return Fa(e)?n:At(n,r(e))}function Sn(t){return null==t?t===e?"[object Undefined]":"[object Null]":Xe&&Xe in Te(t)?function(t){var r=Ce.call(t,Xe),n=t[Xe];try{t[Xe]=e;var o=!0}catch(e){}var i=Ue.call(t);return o&&(r?t[Xe]=n:delete t[Xe]),i}(t):function(e){return Ue.call(e)}(t)}function Tn(e,t){return e>t}function wn(e,t){return null!=e&&Ce.call(e,t)}function Pn(e,t){return null!=e&&t in Te(e)}function xn(t,r,n){for(var o=n?Dt:Nt,i=t[0].length,a=t.length,u=a,c=oe(a),l=1/0,s=[];u--;){var p=t[u];u&&r&&(p=Lt(p,Jt(r))),l=gr(p.length,l),c[u]=!n&&(r||i>=120&&p.length>=120)?new $r(u&&p):e}p=t[0];var f=-1,d=c[0];e:for(;++f<i&&s.length<l;){var y=p[f],h=r?r(y):y;if(y=n||0!==y?y:0,!(d?Zt(d,h):o(s,h,n))){for(u=a;--u;){var v=c[u];if(!(v?Zt(v,h):o(t[u],h,n)))continue e}d&&d.push(h),s.push(y)}}return s}function In(t,r,n){var o=null==(t=Pi(t,r=bo(r,t)))?t:t[ki(Yi(r))];return null==o?e:St(o,t,n)}function Nn(e){return eu(e)&&Sn(e)==f}function Dn(t,r,n,o,i){return t===r||(null==t||null==r||!eu(t)&&!eu(r)?t!=t&&r!=r:function(t,r,n,o,i,a){var u=Fa(t),c=Fa(r),l=u?d:yi(t),s=c?d:yi(r),p=(l=l==f?j:l)==j,g=(s=s==f?j:s)==j,m=l==s;if(m&&Wa(t)){if(!Wa(r))return!1;u=!0,p=!1}if(m&&!p)return a||(a=new Wr),u||cu(t)?ti(t,r,n,o,i,a):function(e,t,r,n,o,i,a){switch(r){case L:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case D:return!(e.byteLength!=t.byteLength||!i(new Fe(e),new Fe(t)));case y:case h:case O:return Ga(+e,+t);case v:return e.name==t.name&&e.message==t.message;case E:case T:return e==t+"";case b:var u=ir;case S:var c=1&n;if(u||(u=cr),e.size!=t.size&&!c)return!1;var l=a.get(e);if(l)return l==t;n|=2,a.set(e,t);var s=ti(u(e),u(t),n,o,i,a);return a.delete(e),s;case w:if(kr)return kr.call(e)==kr.call(t)}return!1}(t,r,l,n,o,i,a);if(!(1&n)){var _=p&&Ce.call(t,"__wrapped__"),P=g&&Ce.call(r,"__wrapped__");if(_||P){var x=_?t.value():t,I=P?r.value():r;return a||(a=new Wr),i(x,I,n,o,a)}}return!!m&&(a||(a=new Wr),function(t,r,n,o,i,a){var u=1&n,c=ni(t),l=c.length,s=ni(r),p=s.length;if(l!=p&&!u)return!1;for(var f=l;f--;){var d=c[f];if(!(u?d in r:Ce.call(r,d)))return!1}var y=a.get(t),h=a.get(r);if(y&&h)return y==r&&h==t;var v=!0;a.set(t,r),a.set(r,t);for(var g=u;++f<l;){var m=t[d=c[f]],b=r[d];if(o)var O=u?o(b,m,d,r,t,a):o(m,b,d,t,r,a);if(!(O===e?m===b||i(m,b,n,o,a):O)){v=!1;break}g||(g="constructor"==d)}if(v&&!g){var j=t.constructor,_=r.constructor;j==_||!("constructor"in t)||!("constructor"in r)||"function"==typeof j&&j instanceof j&&"function"==typeof _&&_ instanceof _||(v=!1)}return a.delete(t),a.delete(r),v}(t,r,n,o,i,a))}(t,r,n,o,Dn,i))}function Ln(t,r,n,o){var i=n.length,a=i,u=!o;if(null==t)return!a;for(t=Te(t);i--;){var c=n[i];if(u&&c[2]?c[1]!==t[c[0]]:!(c[0]in t))return!1}for(;++i<a;){var l=(c=n[i])[0],s=t[l],p=c[1];if(u&&c[2]){if(s===e&&!(l in t))return!1}else{var f=new Wr;if(o)var d=o(s,p,l,t,r,f);if(!(d===e?Dn(p,s,3,o,f):d))return!1}}return!0}function An(e){return!(!Xa(e)||(t=e,ke&&ke in t))&&(Ja(e)?Qe:he).test(Ui(e));var t}function Cn(e){return"function"==typeof e?e:null==e?rc:"object"==typeof e?Fa(e)?Qn(e[0],e[1]):Gn(e):pc(e)}function Rn(e){if(!Ei(e))return hr(e);var t=[];for(var r in Te(e))Ce.call(e,r)&&"constructor"!=r&&t.push(r);return t}function kn(e){if(!Xa(e))return function(e){var t=[];if(null!=e)for(var r in Te(e))t.push(r);return t}(e);var t=Ei(e),r=[];for(var n in e)("constructor"!=n||!t&&Ce.call(e,n))&&r.push(n);return r}function Un(e,t){return e<t}function Mn(e,t){var r=-1,n=Ka(e)?oe(e.length):[];return pn(e,(function(e,o,i){n[++r]=t(e,o,i)})),n}function Gn(e){var t=si(e);return 1==t.length&&t[0][2]?Ti(t[0][0],t[0][1]):function(r){return r===e||Ln(r,e,t)}}function Qn(t,r){return Oi(t)&&Si(r)?Ti(ki(t),r):function(n){var o=Tu(n,t);return o===e&&o===r?wu(n,t):Dn(r,o,3)}}function Bn(t,r,n,o,i){t!==r&&gn(r,(function(a,u){if(i||(i=new Wr),Xa(a))!function(t,r,n,o,i,a,u){var c=xi(t,n),l=xi(r,n),s=u.get(l);if(s)Zr(t,n,s);else{var p=a?a(c,l,n+"",t,r,u):e,f=p===e;if(f){var d=Fa(l),y=!d&&Wa(l),h=!d&&!y&&cu(l);p=l,d||y||h?Fa(c)?p=c:$a(c)?p=Io(c):y?(f=!1,p=Eo(l,!0)):h?(f=!1,p=To(l,!0)):p=[]:nu(l)||qa(l)?(p=c,qa(c)?p=vu(c):Xa(c)&&!Ja(c)||(p=vi(l))):f=!1}f&&(u.set(l,p),i(p,l,o,a,u),u.delete(l)),Zr(t,n,p)}}(t,r,u,n,Bn,o,i);else{var c=o?o(xi(t,u),a,u+"",t,r,i):e;c===e&&(c=a),Zr(t,u,c)}}),Du)}function qn(t,r){var n=t.length;if(n)return mi(r+=r<0?n:0,n)?t[r]:e}function Fn(e,t,r){t=t.length?Lt(t,(function(e){return Fa(e)?function(t){return _n(t,1===e.length?e[0]:e)}:e})):[rc];var n=-1;t=Lt(t,Jt(ci()));var o=Mn(e,(function(e,r,o){var i=Lt(t,(function(t){return t(e)}));return{criteria:i,index:++n,value:e}}));return function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(o,(function(e,t){return function(e,t,r){for(var n=-1,o=e.criteria,i=t.criteria,a=o.length,u=r.length;++n<a;){var c=wo(o[n],i[n]);if(c)return n>=u?c:c*("desc"==r[n]?-1:1)}return e.index-t.index}(e,t,r)}))}function Vn(e,t,r){for(var n=-1,o=t.length,i={};++n<o;){var a=t[n],u=_n(e,a);r(u,a)&&Zn(i,bo(a,e),u)}return i}function Kn(e,t,r,n){var o=n?Bt:Qt,i=-1,a=t.length,u=e;for(e===t&&(t=Io(t)),r&&(u=Lt(e,Jt(r)));++i<a;)for(var c=0,l=t[i],s=r?r(l):l;(c=o(u,s,c,n))>-1;)u!==e&&ze.call(u,c,1),ze.call(e,c,1);return e}function $n(e,t){for(var r=e?t.length:0,n=r-1;r--;){var o=t[r];if(r==n||o!==i){var i=o;mi(o)?ze.call(e,o,1):so(e,o)}}return e}function Wn(e,t){return e+yt(Or()*(t-e+1))}function zn(e,t){var r="";if(!e||t<1||t>c)return r;do{t%2&&(r+=e),(t=yt(t/2))&&(e+=e)}while(t);return r}function Yn(e,t){return Di(wi(e,t,rc),e+"")}function Jn(e){return Yr(Gu(e))}function Hn(e,t){var r=Gu(e);return Ci(r,an(t,0,r.length))}function Zn(t,r,n,o){if(!Xa(t))return t;for(var i=-1,a=(r=bo(r,t)).length,u=a-1,c=t;null!=c&&++i<a;){var l=ki(r[i]),s=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return t;if(i!=u){var p=c[l];(s=o?o(p,l,c):e)===e&&(s=Xa(p)?p:mi(r[i+1])?[]:{})}Xr(c,l,s),c=c[l]}return t}var Xn=xr?function(e,t){return xr.set(e,t),e}:rc,eo=tt?function(e,t){return tt(e,"toString",{configurable:!0,enumerable:!1,value:Xu(t),writable:!0})}:rc;function to(e){return Ci(Gu(e))}function ro(e,t,r){var n=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(r=r>o?o:r)<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var i=oe(o);++n<o;)i[n]=e[n+t];return i}function no(e,t){var r;return pn(e,(function(e,n,o){return!(r=t(e,n,o))})),!!r}function oo(e,t,r){var n=0,o=null==e?n:e.length;if("number"==typeof t&&t==t&&o<=2147483647){for(;n<o;){var i=n+o>>>1,a=e[i];null!==a&&!uu(a)&&(r?a<=t:a<t)?n=i+1:o=i}return o}return io(e,t,rc,r)}function io(t,r,n,o){var i=0,a=null==t?0:t.length;if(0===a)return 0;for(var u=(r=n(r))!=r,c=null===r,l=uu(r),s=r===e;i<a;){var p=yt((i+a)/2),f=n(t[p]),d=f!==e,y=null===f,h=f==f,v=uu(f);if(u)var g=o||h;else g=s?h&&(o||d):c?h&&d&&(o||!y):l?h&&d&&!y&&(o||!v):!y&&!v&&(o?f<=r:f<r);g?i=p+1:a=p}return gr(a,4294967294)}function ao(e,t){for(var r=-1,n=e.length,o=0,i=[];++r<n;){var a=e[r],u=t?t(a):a;if(!r||!Ga(u,c)){var c=u;i[o++]=0===a?0:a}}return i}function uo(e){return"number"==typeof e?e:uu(e)?l:+e}function co(e){if("string"==typeof e)return e;if(Fa(e))return Lt(e,co)+"";if(uu(e))return Ur?Ur.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function lo(e,t,r){var n=-1,o=Nt,i=e.length,a=!0,u=[],c=u;if(r)a=!1,o=Dt;else if(i>=200){var l=t?null:Yo(e);if(l)return cr(l);a=!1,o=Zt,c=new $r}else c=t?[]:u;e:for(;++n<i;){var s=e[n],p=t?t(s):s;if(s=r||0!==s?s:0,a&&p==p){for(var f=c.length;f--;)if(c[f]===p)continue e;t&&c.push(p),u.push(s)}else o(c,p,r)||(c!==u&&c.push(p),u.push(s))}return u}function so(e,t){return null==(e=Pi(e,t=bo(t,e)))||delete e[ki(Yi(t))]}function po(e,t,r,n){return Zn(e,t,r(_n(e,t)),n)}function fo(e,t,r,n){for(var o=e.length,i=n?o:-1;(n?i--:++i<o)&&t(e[i],i,e););return r?ro(e,n?0:i,n?i+1:o):ro(e,n?i+1:0,n?o:i)}function yo(e,t){var r=e;return r instanceof qr&&(r=r.value()),Ct(t,(function(e,t){return t.func.apply(t.thisArg,At([e],t.args))}),r)}function ho(e,t,r){var n=e.length;if(n<2)return n?lo(e[0]):[];for(var o=-1,i=oe(n);++o<n;)for(var a=e[o],u=-1;++u<n;)u!=o&&(i[o]=sn(i[o]||a,e[u],t,r));return lo(vn(i,1),t,r)}function vo(t,r,n){for(var o=-1,i=t.length,a=r.length,u={};++o<i;){var c=o<a?r[o]:e;n(u,t[o],c)}return u}function go(e){return $a(e)?e:[]}function mo(e){return"function"==typeof e?e:rc}function bo(e,t){return Fa(e)?e:Oi(e,t)?[e]:Ri(gu(e))}var Oo=Yn;function jo(t,r,n){var o=t.length;return n=n===e?o:n,!r&&n>=o?t:ro(t,r,n)}var _o=ut||function(e){return ft.clearTimeout(e)};function Eo(e,t){if(t)return e.slice();var r=e.length,n=Ve?Ve(r):new e.constructor(r);return e.copy(n),n}function So(e){var t=new e.constructor(e.byteLength);return new Fe(t).set(new Fe(e)),t}function To(e,t){var r=t?So(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function wo(t,r){if(t!==r){var n=t!==e,o=null===t,i=t==t,a=uu(t),u=r!==e,c=null===r,l=r==r,s=uu(r);if(!c&&!s&&!a&&t>r||a&&u&&l&&!c&&!s||o&&u&&l||!n&&l||!i)return 1;if(!o&&!a&&!s&&t<r||s&&n&&i&&!o&&!a||c&&n&&i||!u&&i||!l)return-1}return 0}function Po(e,t,r,n){for(var o=-1,i=e.length,a=r.length,u=-1,c=t.length,l=vr(i-a,0),s=oe(c+l),p=!n;++u<c;)s[u]=t[u];for(;++o<a;)(p||o<i)&&(s[r[o]]=e[o]);for(;l--;)s[u++]=e[o++];return s}function xo(e,t,r,n){for(var o=-1,i=e.length,a=-1,u=r.length,c=-1,l=t.length,s=vr(i-u,0),p=oe(s+l),f=!n;++o<s;)p[o]=e[o];for(var d=o;++c<l;)p[d+c]=t[c];for(;++a<u;)(f||o<i)&&(p[d+r[a]]=e[o++]);return p}function Io(e,t){var r=-1,n=e.length;for(t||(t=oe(n));++r<n;)t[r]=e[r];return t}function No(t,r,n,o){var i=!n;n||(n={});for(var a=-1,u=r.length;++a<u;){var c=r[a],l=o?o(n[c],t[c],c,n,t):e;l===e&&(l=t[c]),i?nn(n,c,l):Xr(n,c,l)}return n}function Do(e,t){return function(r,n){var o=Fa(r)?Tt:tn,i=t?t():{};return o(r,e,ci(n,2),i)}}function Lo(t){return Yn((function(r,n){var o=-1,i=n.length,a=i>1?n[i-1]:e,u=i>2?n[2]:e;for(a=t.length>3&&"function"==typeof a?(i--,a):e,u&&bi(n[0],n[1],u)&&(a=i<3?e:a,i=1),r=Te(r);++o<i;){var c=n[o];c&&t(r,c,o,a)}return r}))}function Ao(e,t){return function(r,n){if(null==r)return r;if(!Ka(r))return e(r,n);for(var o=r.length,i=t?o:-1,a=Te(r);(t?i--:++i<o)&&!1!==n(a[i],i,a););return r}}function Co(e){return function(t,r,n){for(var o=-1,i=Te(t),a=n(t),u=a.length;u--;){var c=a[e?u:++o];if(!1===r(i[c],c,i))break}return t}}function Ro(t){return function(r){var n=or(r=gu(r))?pr(r):e,o=n?n[0]:r.charAt(0),i=n?jo(n,1).join(""):r.slice(1);return o[t]()+i}}function ko(e){return function(t){return Ct(Ju(qu(t).replace(He,"")),e,"")}}function Uo(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=Gr(e.prototype),n=e.apply(r,t);return Xa(n)?n:r}}function Mo(t){return function(r,n,o){var i=Te(r);if(!Ka(r)){var a=ci(n,3);r=Nu(r),n=function(e){return a(i[e],e,i)}}var u=t(r,n,o);return u>-1?i[a?r[u]:u]:e}}function Go(r){return ri((function(n){var o=n.length,i=o,a=Br.prototype.thru;for(r&&n.reverse();i--;){var u=n[i];if("function"!=typeof u)throw new xe(t);if(a&&!c&&"wrapper"==ai(u))var c=new Br([],!0)}for(i=c?i:o;++i<o;){var l=ai(u=n[i]),s="wrapper"==l?ii(u):e;c=s&&ji(s[0])&&424==s[1]&&!s[4].length&&1==s[9]?c[ai(s[0])].apply(c,s[3]):1==u.length&&ji(u)?c[l]():c.thru(u)}return function(){var e=arguments,t=e[0];if(c&&1==e.length&&Fa(t))return c.plant(t).value();for(var r=0,i=o?n[r].apply(this,e):t;++r<o;)i=n[r].call(this,i);return i}}))}function Qo(t,r,n,o,a,u,c,l,s,p){var f=r&i,d=1&r,y=2&r,h=24&r,v=512&r,g=y?e:Uo(t);return function i(){for(var m=arguments.length,b=oe(m),O=m;O--;)b[O]=arguments[O];if(h)var j=ui(i),_=function(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}(b,j);if(o&&(b=Po(b,o,a,h)),u&&(b=xo(b,u,c,h)),m-=_,h&&m<p){var E=ur(b,j);return Wo(t,r,Qo,i.placeholder,n,b,E,l,s,p-m)}var S=d?n:this,T=y?S[t]:t;return m=b.length,l?b=function(t,r){for(var n=t.length,o=gr(r.length,n),i=Io(t);o--;){var a=r[o];t[o]=mi(a,n)?i[a]:e}return t}(b,l):v&&m>1&&b.reverse(),f&&s<m&&(b.length=s),this&&this!==ft&&this instanceof i&&(T=g||Uo(T)),T.apply(S,b)}}function Bo(e,t){return function(r,n){return function(e,t,r,n){return bn(e,(function(e,o,i){t(n,r(e),o,i)})),n}(r,e,t(n),{})}}function qo(t,r){return function(n,o){var i;if(n===e&&o===e)return r;if(n!==e&&(i=n),o!==e){if(i===e)return o;"string"==typeof n||"string"==typeof o?(n=co(n),o=co(o)):(n=uo(n),o=uo(o)),i=t(n,o)}return i}}function Fo(e){return ri((function(t){return t=Lt(t,Jt(ci())),Yn((function(r){var n=this;return e(t,(function(e){return St(e,n,r)}))}))}))}function Vo(t,r){var n=(r=r===e?" ":co(r)).length;if(n<2)return n?zn(r,t):r;var o=zn(r,dt(t/sr(r)));return or(r)?jo(pr(o),0,t).join(""):o.slice(0,t)}function Ko(t){return function(r,n,o){return o&&"number"!=typeof o&&bi(r,n,o)&&(n=o=e),r=fu(r),n===e?(n=r,r=0):n=fu(n),function(e,t,r,n){for(var o=-1,i=vr(dt((t-e)/(r||1)),0),a=oe(i);i--;)a[n?i:++o]=e,e+=r;return a}(r,n,o=o===e?r<n?1:-1:fu(o),t)}}function $o(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=hu(t),r=hu(r)),e(t,r)}}function Wo(t,r,n,i,a,u,c,l,s,p){var f=8&r;r|=f?o:64,4&(r&=~(f?64:o))||(r&=-4);var d=[t,r,a,f?u:e,f?c:e,f?e:u,f?e:c,l,s,p],y=n.apply(e,d);return ji(t)&&Ii(y,d),y.placeholder=i,Li(y,t,r)}function zo(e){var t=Se[e];return function(e,r){if(e=hu(e),(r=null==r?0:gr(du(r),292))&&Ut(e)){var n=(gu(e)+"e").split("e");return+((n=(gu(t(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}var Yo=Tr&&1/cr(new Tr([,-0]))[1]==u?function(e){return new Tr(e)}:uc;function Jo(e){return function(t){var r=yi(t);return r==b?ir(t):r==S?lr(t):function(e,t){return Lt(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Ho(r,u,c,l,s,p,f,d){var y=2&u;if(!y&&"function"!=typeof r)throw new xe(t);var h=l?l.length:0;if(h||(u&=-97,l=s=e),f=f===e?f:vr(du(f),0),d=d===e?d:du(d),h-=s?s.length:0,64&u){var v=l,g=s;l=s=e}var m=y?e:ii(r),b=[r,u,c,l,s,v,g,p,f,d];if(m&&function(e,t){var r=e[1],o=t[1],u=r|o,c=u<131,l=o==i&&8==r||o==i&&r==a&&e[7].length<=t[8]||384==o&&t[7].length<=t[8]&&8==r;if(!c&&!l)return e;1&o&&(e[2]=t[2],u|=1&r?0:4);var s=t[3];if(s){var p=e[3];e[3]=p?Po(p,s,t[4]):s,e[4]=p?ur(e[3],n):t[4]}(s=t[5])&&(p=e[5],e[5]=p?xo(p,s,t[6]):s,e[6]=p?ur(e[5],n):t[6]),(s=t[7])&&(e[7]=s),o&i&&(e[8]=null==e[8]?t[8]:gr(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=u}(b,m),r=b[0],u=b[1],c=b[2],l=b[3],s=b[4],!(d=b[9]=b[9]===e?y?0:r.length:vr(b[9]-h,0))&&24&u&&(u&=-25),u&&1!=u)O=8==u||16==u?function(t,r,n){var o=Uo(t);return function i(){for(var a=arguments.length,u=oe(a),c=a,l=ui(i);c--;)u[c]=arguments[c];var s=a<3&&u[0]!==l&&u[a-1]!==l?[]:ur(u,l);return(a-=s.length)<n?Wo(t,r,Qo,i.placeholder,e,u,s,e,e,n-a):St(this&&this!==ft&&this instanceof i?o:t,this,u)}}(r,u,d):u!=o&&33!=u||s.length?Qo.apply(e,b):function(e,t,r,n){var o=1&t,i=Uo(e);return function t(){for(var a=-1,u=arguments.length,c=-1,l=n.length,s=oe(l+u),p=this&&this!==ft&&this instanceof t?i:e;++c<l;)s[c]=n[c];for(;u--;)s[c++]=arguments[++a];return St(p,o?r:this,s)}}(r,u,c,l);else var O=function(e,t,r){var n=1&t,o=Uo(e);return function t(){return(this&&this!==ft&&this instanceof t?o:e).apply(n?r:this,arguments)}}(r,u,c);return Li((m?Xn:Ii)(O,b),r,u)}function Zo(t,r,n,o){return t===e||Ga(t,De[n])&&!Ce.call(o,n)?r:t}function Xo(t,r,n,o,i,a){return Xa(t)&&Xa(r)&&(a.set(r,t),Bn(t,r,e,Xo,a),a.delete(r)),t}function ei(t){return nu(t)?e:t}function ti(t,r,n,o,i,a){var u=1&n,c=t.length,l=r.length;if(c!=l&&!(u&&l>c))return!1;var s=a.get(t),p=a.get(r);if(s&&p)return s==r&&p==t;var f=-1,d=!0,y=2&n?new $r:e;for(a.set(t,r),a.set(r,t);++f<c;){var h=t[f],v=r[f];if(o)var g=u?o(v,h,f,r,t,a):o(h,v,f,t,r,a);if(g!==e){if(g)continue;d=!1;break}if(y){if(!kt(r,(function(e,t){if(!Zt(y,t)&&(h===e||i(h,e,n,o,a)))return y.push(t)}))){d=!1;break}}else if(h!==v&&!i(h,v,n,o,a)){d=!1;break}}return a.delete(t),a.delete(r),d}function ri(t){return Di(wi(t,e,Vi),t+"")}function ni(e){return En(e,Nu,fi)}function oi(e){return En(e,Du,di)}var ii=xr?function(e){return xr.get(e)}:uc;function ai(e){for(var t=e.name+"",r=Ir[t],n=Ce.call(Ir,t)?r.length:0;n--;){var o=r[n],i=o.func;if(null==i||i==e)return o.name}return t}function ui(e){return(Ce.call(Mr,"placeholder")?Mr:e).placeholder}function ci(){var e=Mr.iteratee||nc;return e=e===nc?Cn:e,arguments.length?e(arguments[0],arguments[1]):e}function li(e,t){var r,n,o=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function si(e){for(var t=Nu(e),r=t.length;r--;){var n=t[r],o=e[n];t[r]=[n,o,Si(o)]}return t}function pi(t,r){var n=function(t,r){return null==t?e:t[r]}(t,r);return An(n)?n:e}var fi=vt?function(e){return null==e?[]:(e=Te(e),It(vt(e),(function(t){return We.call(e,t)})))}:yc,di=vt?function(e){for(var t=[];e;)At(t,fi(e)),e=Ke(e);return t}:yc,yi=Sn;function hi(e,t,r){for(var n=-1,o=(t=bo(t,e)).length,i=!1;++n<o;){var a=ki(t[n]);if(!(i=null!=e&&r(e,a)))break;e=e[a]}return i||++n!=o?i:!!(o=null==e?0:e.length)&&Za(o)&&mi(a,o)&&(Fa(e)||qa(e))}function vi(e){return"function"!=typeof e.constructor||Ei(e)?{}:Gr(Ke(e))}function gi(e){return Fa(e)||qa(e)||!!(Ye&&e&&e[Ye])}function mi(e,t){var r=typeof e;return!!(t=null==t?c:t)&&("number"==r||"symbol"!=r&&ge.test(e))&&e>-1&&e%1==0&&e<t}function bi(e,t,r){if(!Xa(r))return!1;var n=typeof t;return!!("number"==n?Ka(r)&&mi(t,r.length):"string"==n&&t in r)&&Ga(r[t],e)}function Oi(e,t){if(Fa(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!uu(e))||X.test(e)||!Z.test(e)||null!=t&&e in Te(t)}function ji(e){var t=ai(e),r=Mr[t];if("function"!=typeof r||!(t in qr.prototype))return!1;if(e===r)return!0;var n=ii(r);return!!n&&e===n[0]}(_r&&yi(new _r(new ArrayBuffer(1)))!=L||Er&&yi(new Er)!=b||Sr&&yi(Sr.resolve())!=_||Tr&&yi(new Tr)!=S||wr&&yi(new wr)!=x)&&(yi=function(t){var r=Sn(t),n=r==j?t.constructor:e,o=n?Ui(n):"";if(o)switch(o){case Nr:return L;case Dr:return b;case Lr:return _;case Ar:return S;case Cr:return x}return r});var _i=Le?Ja:hc;function Ei(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||De)}function Si(e){return e==e&&!Xa(e)}function Ti(t,r){return function(n){return null!=n&&n[t]===r&&(r!==e||t in Te(n))}}function wi(t,r,n){return r=vr(r===e?t.length-1:r,0),function(){for(var e=arguments,o=-1,i=vr(e.length-r,0),a=oe(i);++o<i;)a[o]=e[r+o];o=-1;for(var u=oe(r+1);++o<r;)u[o]=e[o];return u[r]=n(a),St(t,this,u)}}function Pi(e,t){return t.length<2?e:_n(e,ro(t,0,-1))}function xi(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Ii=Ai(Xn),Ni=pt||function(e,t){return ft.setTimeout(e,t)},Di=Ai(eo);function Li(e,t,r){var n=t+"";return Di(e,function(e,t){var r=t.length;if(!r)return e;var n=r-1;return t[n]=(r>1?"& ":"")+t[n],t=t.join(r>2?", ":" "),e.replace(ie,"{\n/* [wrapped with "+t+"] */\n")}(n,function(e,t){return wt(p,(function(r){var n="_."+r[0];t&r[1]&&!Nt(e,n)&&e.push(n)})),e.sort()}(function(e){var t=e.match(ae);return t?t[1].split(ue):[]}(n),r)))}function Ai(t){var r=0,n=0;return function(){var o=mr(),i=16-(o-n);if(n=o,i>0){if(++r>=800)return arguments[0]}else r=0;return t.apply(e,arguments)}}function Ci(t,r){var n=-1,o=t.length,i=o-1;for(r=r===e?o:r;++n<r;){var a=Wn(n,i),u=t[a];t[a]=t[n],t[n]=u}return t.length=r,t}var Ri=function(e){var t=Aa(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ee,(function(e,r,n,o){t.push(n?o.replace(se,"$1"):r||e)})),t}));function ki(e){if("string"==typeof e||uu(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Ui(e){if(null!=e){try{return Ae.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Mi(e){if(e instanceof qr)return e.clone();var t=new Br(e.__wrapped__,e.__chain__);return t.__actions__=Io(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Gi=Yn((function(e,t){return $a(e)?sn(e,vn(t,1,$a,!0)):[]})),Qi=Yn((function(t,r){var n=Yi(r);return $a(n)&&(n=e),$a(t)?sn(t,vn(r,1,$a,!0),ci(n,2)):[]})),Bi=Yn((function(t,r){var n=Yi(r);return $a(n)&&(n=e),$a(t)?sn(t,vn(r,1,$a,!0),e,n):[]}));function qi(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var o=null==r?0:du(r);return o<0&&(o=vr(n+o,0)),Gt(e,ci(t,3),o)}function Fi(t,r,n){var o=null==t?0:t.length;if(!o)return-1;var i=o-1;return n!==e&&(i=du(n),i=n<0?vr(o+i,0):gr(i,o-1)),Gt(t,ci(r,3),i,!0)}function Vi(e){return null!=e&&e.length?vn(e,1):[]}function Ki(t){return t&&t.length?t[0]:e}var $i=Yn((function(e){var t=Lt(e,go);return t.length&&t[0]===e[0]?xn(t):[]})),Wi=Yn((function(t){var r=Yi(t),n=Lt(t,go);return r===Yi(n)?r=e:n.pop(),n.length&&n[0]===t[0]?xn(n,ci(r,2)):[]})),zi=Yn((function(t){var r=Yi(t),n=Lt(t,go);return(r="function"==typeof r?r:e)&&n.pop(),n.length&&n[0]===t[0]?xn(n,e,r):[]}));function Yi(t){var r=null==t?0:t.length;return r?t[r-1]:e}var Ji=Yn(Hi);function Hi(e,t){return e&&e.length&&t&&t.length?Kn(e,t):e}var Zi=ri((function(e,t){var r=null==e?0:e.length,n=on(e,t);return $n(e,Lt(t,(function(e){return mi(e,r)?+e:e})).sort(wo)),n}));function Xi(e){return null==e?e:jr.call(e)}var ea=Yn((function(e){return lo(vn(e,1,$a,!0))})),ta=Yn((function(t){var r=Yi(t);return $a(r)&&(r=e),lo(vn(t,1,$a,!0),ci(r,2))})),ra=Yn((function(t){var r=Yi(t);return r="function"==typeof r?r:e,lo(vn(t,1,$a,!0),e,r)}));function na(e){if(!e||!e.length)return[];var t=0;return e=It(e,(function(e){if($a(e))return t=vr(e.length,t),!0})),zt(t,(function(t){return Lt(e,Vt(t))}))}function oa(t,r){if(!t||!t.length)return[];var n=na(t);return null==r?n:Lt(n,(function(t){return St(r,e,t)}))}var ia=Yn((function(e,t){return $a(e)?sn(e,t):[]})),aa=Yn((function(e){return ho(It(e,$a))})),ua=Yn((function(t){var r=Yi(t);return $a(r)&&(r=e),ho(It(t,$a),ci(r,2))})),ca=Yn((function(t){var r=Yi(t);return r="function"==typeof r?r:e,ho(It(t,$a),e,r)})),la=Yn(na),sa=Yn((function(t){var r=t.length,n=r>1?t[r-1]:e;return n="function"==typeof n?(t.pop(),n):e,oa(t,n)}));function pa(e){var t=Mr(e);return t.__chain__=!0,t}function fa(e,t){return t(e)}var da=ri((function(t){var r=t.length,n=r?t[0]:0,o=this.__wrapped__,i=function(e){return on(e,t)};return!(r>1||this.__actions__.length)&&o instanceof qr&&mi(n)?((o=o.slice(n,+n+(r?1:0))).__actions__.push({func:fa,args:[i],thisArg:e}),new Br(o,this.__chain__).thru((function(t){return r&&!t.length&&t.push(e),t}))):this.thru(i)})),ya=Do((function(e,t,r){Ce.call(e,r)?++e[r]:nn(e,r,1)})),ha=Mo(qi),va=Mo(Fi);function ga(e,t){return(Fa(e)?wt:pn)(e,ci(t,3))}function ma(e,t){return(Fa(e)?Pt:fn)(e,ci(t,3))}var ba=Do((function(e,t,r){Ce.call(e,r)?e[r].push(t):nn(e,r,[t])})),Oa=Yn((function(e,t,r){var n=-1,o="function"==typeof t,i=Ka(e)?oe(e.length):[];return pn(e,(function(e){i[++n]=o?St(t,e,r):In(e,t,r)})),i})),ja=Do((function(e,t,r){nn(e,r,t)}));function _a(e,t){return(Fa(e)?Lt:Mn)(e,ci(t,3))}var Ea=Do((function(e,t,r){e[r?0:1].push(t)}),(function(){return[[],[]]})),Sa=Yn((function(e,t){if(null==e)return[];var r=t.length;return r>1&&bi(e,t[0],t[1])?t=[]:r>2&&bi(t[0],t[1],t[2])&&(t=[t[0]]),Fn(e,vn(t,1),[])})),Ta=st||function(){return ft.Date.now()};function wa(t,r,n){return r=n?e:r,r=t&&null==r?t.length:r,Ho(t,i,e,e,e,e,r)}function Pa(r,n){var o;if("function"!=typeof n)throw new xe(t);return r=du(r),function(){return--r>0&&(o=n.apply(this,arguments)),r<=1&&(n=e),o}}var xa=Yn((function(e,t,r){var n=1;if(r.length){var i=ur(r,ui(xa));n|=o}return Ho(e,n,t,r,i)})),Ia=Yn((function(e,t,r){var n=3;if(r.length){var i=ur(r,ui(Ia));n|=o}return Ho(t,n,e,r,i)}));function Na(r,n,o){var i,a,u,c,l,s,p=0,f=!1,d=!1,y=!0;if("function"!=typeof r)throw new xe(t);function h(t){var n=i,o=a;return i=a=e,p=t,c=r.apply(o,n)}function v(t){var r=t-s;return s===e||r>=n||r<0||d&&t-p>=u}function g(){var e=Ta();if(v(e))return m(e);l=Ni(g,function(e){var t=n-(e-s);return d?gr(t,u-(e-p)):t}(e))}function m(t){return l=e,y&&i?h(t):(i=a=e,c)}function b(){var t=Ta(),r=v(t);if(i=arguments,a=this,s=t,r){if(l===e)return function(e){return p=e,l=Ni(g,n),f?h(e):c}(s);if(d)return _o(l),l=Ni(g,n),h(s)}return l===e&&(l=Ni(g,n)),c}return n=hu(n)||0,Xa(o)&&(f=!!o.leading,u=(d="maxWait"in o)?vr(hu(o.maxWait)||0,n):u,y="trailing"in o?!!o.trailing:y),b.cancel=function(){l!==e&&_o(l),p=0,i=s=a=l=e},b.flush=function(){return l===e?c:m(Ta())},b}var Da=Yn((function(e,t){return ln(e,1,t)})),La=Yn((function(e,t,r){return ln(e,hu(t)||0,r)}));function Aa(e,r){if("function"!=typeof e||null!=r&&"function"!=typeof r)throw new xe(t);var n=function(){var t=arguments,o=r?r.apply(this,t):t[0],i=n.cache;if(i.has(o))return i.get(o);var a=e.apply(this,t);return n.cache=i.set(o,a)||i,a};return n.cache=new(Aa.Cache||Kr),n}function Ca(e){if("function"!=typeof e)throw new xe(t);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Aa.Cache=Kr;var Ra=Oo((function(e,t){var r=(t=1==t.length&&Fa(t[0])?Lt(t[0],Jt(ci())):Lt(vn(t,1),Jt(ci()))).length;return Yn((function(n){for(var o=-1,i=gr(n.length,r);++o<i;)n[o]=t[o].call(this,n[o]);return St(e,this,n)}))})),ka=Yn((function(t,r){var n=ur(r,ui(ka));return Ho(t,o,e,r,n)})),Ua=Yn((function(t,r){var n=ur(r,ui(Ua));return Ho(t,64,e,r,n)})),Ma=ri((function(t,r){return Ho(t,a,e,e,e,r)}));function Ga(e,t){return e===t||e!=e&&t!=t}var Qa=$o(Tn),Ba=$o((function(e,t){return e>=t})),qa=Nn(function(){return arguments}())?Nn:function(e){return eu(e)&&Ce.call(e,"callee")&&!We.call(e,"callee")},Fa=oe.isArray,Va=mt?Jt(mt):function(e){return eu(e)&&Sn(e)==D};function Ka(e){return null!=e&&Za(e.length)&&!Ja(e)}function $a(e){return eu(e)&&Ka(e)}var Wa=gt||hc,za=bt?Jt(bt):function(e){return eu(e)&&Sn(e)==h};function Ya(e){if(!eu(e))return!1;var t=Sn(e);return t==v||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!nu(e)}function Ja(e){if(!Xa(e))return!1;var t=Sn(e);return t==g||t==m||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ha(e){return"number"==typeof e&&e==du(e)}function Za(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=c}function Xa(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function eu(e){return null!=e&&"object"==typeof e}var tu=Ot?Jt(Ot):function(e){return eu(e)&&yi(e)==b};function ru(e){return"number"==typeof e||eu(e)&&Sn(e)==O}function nu(e){if(!eu(e)||Sn(e)!=j)return!1;var t=Ke(e);if(null===t)return!0;var r=Ce.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Ae.call(r)==Me}var ou=jt?Jt(jt):function(e){return eu(e)&&Sn(e)==E},iu=_t?Jt(_t):function(e){return eu(e)&&yi(e)==S};function au(e){return"string"==typeof e||!Fa(e)&&eu(e)&&Sn(e)==T}function uu(e){return"symbol"==typeof e||eu(e)&&Sn(e)==w}var cu=Et?Jt(Et):function(e){return eu(e)&&Za(e.length)&&!!it[Sn(e)]},lu=$o(Un),su=$o((function(e,t){return e<=t}));function pu(e){if(!e)return[];if(Ka(e))return au(e)?pr(e):Io(e);if(Je&&e[Je])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[Je]());var t=yi(e);return(t==b?ir:t==S?cr:Gu)(e)}function fu(e){return e?(e=hu(e))===u||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function du(e){var t=fu(e),r=t%1;return t==t?r?t-r:t:0}function yu(e){return e?an(du(e),0,s):0}function hu(e){if("number"==typeof e)return e;if(uu(e))return l;if(Xa(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Xa(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Yt(e);var r=ye.test(e);return r||ve.test(e)?lt(e.slice(2),r?2:8):de.test(e)?l:+e}function vu(e){return No(e,Du(e))}function gu(e){return null==e?"":co(e)}var mu=Lo((function(e,t){if(Ei(t)||Ka(t))No(t,Nu(t),e);else for(var r in t)Ce.call(t,r)&&Xr(e,r,t[r])})),bu=Lo((function(e,t){No(t,Du(t),e)})),Ou=Lo((function(e,t,r,n){No(t,Du(t),e,n)})),ju=Lo((function(e,t,r,n){No(t,Nu(t),e,n)})),_u=ri(on),Eu=Yn((function(t,r){t=Te(t);var n=-1,o=r.length,i=o>2?r[2]:e;for(i&&bi(r[0],r[1],i)&&(o=1);++n<o;)for(var a=r[n],u=Du(a),c=-1,l=u.length;++c<l;){var s=u[c],p=t[s];(p===e||Ga(p,De[s])&&!Ce.call(t,s))&&(t[s]=a[s])}return t})),Su=Yn((function(t){return t.push(e,Xo),St(Au,e,t)}));function Tu(t,r,n){var o=null==t?e:_n(t,r);return o===e?n:o}function wu(e,t){return null!=e&&hi(e,t,Pn)}var Pu=Bo((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Ue.call(t)),e[t]=r}),Xu(rc)),xu=Bo((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Ue.call(t)),Ce.call(e,t)?e[t].push(r):e[t]=[r]}),ci),Iu=Yn(In);function Nu(e){return Ka(e)?zr(e):Rn(e)}function Du(e){return Ka(e)?zr(e,!0):kn(e)}var Lu=Lo((function(e,t,r){Bn(e,t,r)})),Au=Lo((function(e,t,r,n){Bn(e,t,r,n)})),Cu=ri((function(e,t){var r={};if(null==e)return r;var n=!1;t=Lt(t,(function(t){return t=bo(t,e),n||(n=t.length>1),t})),No(e,oi(e),r),n&&(r=un(r,7,ei));for(var o=t.length;o--;)so(r,t[o]);return r})),Ru=ri((function(e,t){return null==e?{}:function(e,t){return Vn(e,t,(function(t,r){return wu(e,r)}))}(e,t)}));function ku(e,t){if(null==e)return{};var r=Lt(oi(e),(function(e){return[e]}));return t=ci(t),Vn(e,r,(function(e,r){return t(e,r[0])}))}var Uu=Jo(Nu),Mu=Jo(Du);function Gu(e){return null==e?[]:Ht(e,Nu(e))}var Qu=ko((function(e,t,r){return t=t.toLowerCase(),e+(r?Bu(t):t)}));function Bu(e){return Yu(gu(e).toLowerCase())}function qu(e){return(e=gu(e))&&e.replace(me,tr).replace(Ze,"")}var Fu=ko((function(e,t,r){return e+(r?"-":"")+t.toLowerCase()})),Vu=ko((function(e,t,r){return e+(r?" ":"")+t.toLowerCase()})),Ku=Ro("toLowerCase"),$u=ko((function(e,t,r){return e+(r?"_":"")+t.toLowerCase()})),Wu=ko((function(e,t,r){return e+(r?" ":"")+Yu(t)})),zu=ko((function(e,t,r){return e+(r?" ":"")+t.toUpperCase()})),Yu=Ro("toUpperCase");function Ju(t,r,n){return t=gu(t),(r=n?e:r)===e?function(e){return rt.test(e)}(t)?function(e){return e.match(et)||[]}(t):function(e){return e.match(ce)||[]}(t):t.match(r)||[]}var Hu=Yn((function(t,r){try{return St(t,e,r)}catch(e){return Ya(e)?e:new _e(e)}})),Zu=ri((function(e,t){return wt(t,(function(t){t=ki(t),nn(e,t,xa(e[t],e))})),e}));function Xu(e){return function(){return e}}var ec=Go(),tc=Go(!0);function rc(e){return e}function nc(e){return Cn("function"==typeof e?e:un(e,1))}var oc=Yn((function(e,t){return function(r){return In(r,e,t)}})),ic=Yn((function(e,t){return function(r){return In(e,r,t)}}));function ac(e,t,r){var n=Nu(t),o=jn(t,n);null!=r||Xa(t)&&(o.length||!n.length)||(r=t,t=e,e=this,o=jn(t,Nu(t)));var i=!(Xa(r)&&"chain"in r&&!r.chain),a=Ja(e);return wt(o,(function(r){var n=t[r];e[r]=n,a&&(e.prototype[r]=function(){var t=this.__chain__;if(i||t){var r=e(this.__wrapped__);return(r.__actions__=Io(this.__actions__)).push({func:n,args:arguments,thisArg:e}),r.__chain__=t,r}return n.apply(e,At([this.value()],arguments))})})),e}function uc(){}var cc=Fo(Lt),lc=Fo(xt),sc=Fo(kt);function pc(e){return Oi(e)?Vt(ki(e)):function(e){return function(t){return _n(t,e)}}(e)}var fc=Ko(),dc=Ko(!0);function yc(){return[]}function hc(){return!1}var vc,gc=qo((function(e,t){return e+t}),0),mc=zo("ceil"),bc=qo((function(e,t){return e/t}),1),Oc=zo("floor"),jc=qo((function(e,t){return e*t}),1),_c=zo("round"),Ec=qo((function(e,t){return e-t}),0);return Mr.after=function(e,r){if("function"!=typeof r)throw new xe(t);return e=du(e),function(){if(--e<1)return r.apply(this,arguments)}},Mr.ary=wa,Mr.assign=mu,Mr.assignIn=bu,Mr.assignInWith=Ou,Mr.assignWith=ju,Mr.at=_u,Mr.before=Pa,Mr.bind=xa,Mr.bindAll=Zu,Mr.bindKey=Ia,Mr.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Fa(e)?e:[e]},Mr.chain=pa,Mr.chunk=function(t,r,n){r=(n?bi(t,r,n):r===e)?1:vr(du(r),0);var o=null==t?0:t.length;if(!o||r<1)return[];for(var i=0,a=0,u=oe(dt(o/r));i<o;)u[a++]=ro(t,i,i+=r);return u},Mr.compact=function(e){for(var t=-1,r=null==e?0:e.length,n=0,o=[];++t<r;){var i=e[t];i&&(o[n++]=i)}return o},Mr.concat=function(){var e=arguments.length;if(!e)return[];for(var t=oe(e-1),r=arguments[0],n=e;n--;)t[n-1]=arguments[n];return At(Fa(r)?Io(r):[r],vn(t,1))},Mr.cond=function(e){var r=null==e?0:e.length,n=ci();return e=r?Lt(e,(function(e){if("function"!=typeof e[1])throw new xe(t);return[n(e[0]),e[1]]})):[],Yn((function(t){for(var n=-1;++n<r;){var o=e[n];if(St(o[0],this,t))return St(o[1],this,t)}}))},Mr.conforms=function(e){return function(e){var t=Nu(e);return function(r){return cn(r,e,t)}}(un(e,1))},Mr.constant=Xu,Mr.countBy=ya,Mr.create=function(e,t){var r=Gr(e);return null==t?r:rn(r,t)},Mr.curry=function t(r,n,o){var i=Ho(r,8,e,e,e,e,e,n=o?e:n);return i.placeholder=t.placeholder,i},Mr.curryRight=function t(r,n,o){var i=Ho(r,16,e,e,e,e,e,n=o?e:n);return i.placeholder=t.placeholder,i},Mr.debounce=Na,Mr.defaults=Eu,Mr.defaultsDeep=Su,Mr.defer=Da,Mr.delay=La,Mr.difference=Gi,Mr.differenceBy=Qi,Mr.differenceWith=Bi,Mr.drop=function(t,r,n){var o=null==t?0:t.length;return o?ro(t,(r=n||r===e?1:du(r))<0?0:r,o):[]},Mr.dropRight=function(t,r,n){var o=null==t?0:t.length;return o?ro(t,0,(r=o-(r=n||r===e?1:du(r)))<0?0:r):[]},Mr.dropRightWhile=function(e,t){return e&&e.length?fo(e,ci(t,3),!0,!0):[]},Mr.dropWhile=function(e,t){return e&&e.length?fo(e,ci(t,3),!0):[]},Mr.fill=function(t,r,n,o){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&bi(t,r,n)&&(n=0,o=i),function(t,r,n,o){var i=t.length;for((n=du(n))<0&&(n=-n>i?0:i+n),(o=o===e||o>i?i:du(o))<0&&(o+=i),o=n>o?0:yu(o);n<o;)t[n++]=r;return t}(t,r,n,o)):[]},Mr.filter=function(e,t){return(Fa(e)?It:hn)(e,ci(t,3))},Mr.flatMap=function(e,t){return vn(_a(e,t),1)},Mr.flatMapDeep=function(e,t){return vn(_a(e,t),u)},Mr.flatMapDepth=function(t,r,n){return n=n===e?1:du(n),vn(_a(t,r),n)},Mr.flatten=Vi,Mr.flattenDeep=function(e){return null!=e&&e.length?vn(e,u):[]},Mr.flattenDepth=function(t,r){return null!=t&&t.length?vn(t,r=r===e?1:du(r)):[]},Mr.flip=function(e){return Ho(e,512)},Mr.flow=ec,Mr.flowRight=tc,Mr.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,n={};++t<r;){var o=e[t];n[o[0]]=o[1]}return n},Mr.functions=function(e){return null==e?[]:jn(e,Nu(e))},Mr.functionsIn=function(e){return null==e?[]:jn(e,Du(e))},Mr.groupBy=ba,Mr.initial=function(e){return null!=e&&e.length?ro(e,0,-1):[]},Mr.intersection=$i,Mr.intersectionBy=Wi,Mr.intersectionWith=zi,Mr.invert=Pu,Mr.invertBy=xu,Mr.invokeMap=Oa,Mr.iteratee=nc,Mr.keyBy=ja,Mr.keys=Nu,Mr.keysIn=Du,Mr.map=_a,Mr.mapKeys=function(e,t){var r={};return t=ci(t,3),bn(e,(function(e,n,o){nn(r,t(e,n,o),e)})),r},Mr.mapValues=function(e,t){var r={};return t=ci(t,3),bn(e,(function(e,n,o){nn(r,n,t(e,n,o))})),r},Mr.matches=function(e){return Gn(un(e,1))},Mr.matchesProperty=function(e,t){return Qn(e,un(t,1))},Mr.memoize=Aa,Mr.merge=Lu,Mr.mergeWith=Au,Mr.method=oc,Mr.methodOf=ic,Mr.mixin=ac,Mr.negate=Ca,Mr.nthArg=function(e){return e=du(e),Yn((function(t){return qn(t,e)}))},Mr.omit=Cu,Mr.omitBy=function(e,t){return ku(e,Ca(ci(t)))},Mr.once=function(e){return Pa(2,e)},Mr.orderBy=function(t,r,n,o){return null==t?[]:(Fa(r)||(r=null==r?[]:[r]),Fa(n=o?e:n)||(n=null==n?[]:[n]),Fn(t,r,n))},Mr.over=cc,Mr.overArgs=Ra,Mr.overEvery=lc,Mr.overSome=sc,Mr.partial=ka,Mr.partialRight=Ua,Mr.partition=Ea,Mr.pick=Ru,Mr.pickBy=ku,Mr.property=pc,Mr.propertyOf=function(t){return function(r){return null==t?e:_n(t,r)}},Mr.pull=Ji,Mr.pullAll=Hi,Mr.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?Kn(e,t,ci(r,2)):e},Mr.pullAllWith=function(t,r,n){return t&&t.length&&r&&r.length?Kn(t,r,e,n):t},Mr.pullAt=Zi,Mr.range=fc,Mr.rangeRight=dc,Mr.rearg=Ma,Mr.reject=function(e,t){return(Fa(e)?It:hn)(e,Ca(ci(t,3)))},Mr.remove=function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,o=[],i=e.length;for(t=ci(t,3);++n<i;){var a=e[n];t(a,n,e)&&(r.push(a),o.push(n))}return $n(e,o),r},Mr.rest=function(r,n){if("function"!=typeof r)throw new xe(t);return Yn(r,n=n===e?n:du(n))},Mr.reverse=Xi,Mr.sampleSize=function(t,r,n){return r=(n?bi(t,r,n):r===e)?1:du(r),(Fa(t)?Jr:Hn)(t,r)},Mr.set=function(e,t,r){return null==e?e:Zn(e,t,r)},Mr.setWith=function(t,r,n,o){return o="function"==typeof o?o:e,null==t?t:Zn(t,r,n,o)},Mr.shuffle=function(e){return(Fa(e)?Hr:to)(e)},Mr.slice=function(t,r,n){var o=null==t?0:t.length;return o?(n&&"number"!=typeof n&&bi(t,r,n)?(r=0,n=o):(r=null==r?0:du(r),n=n===e?o:du(n)),ro(t,r,n)):[]},Mr.sortBy=Sa,Mr.sortedUniq=function(e){return e&&e.length?ao(e):[]},Mr.sortedUniqBy=function(e,t){return e&&e.length?ao(e,ci(t,2)):[]},Mr.split=function(t,r,n){return n&&"number"!=typeof n&&bi(t,r,n)&&(r=n=e),(n=n===e?s:n>>>0)?(t=gu(t))&&("string"==typeof r||null!=r&&!ou(r))&&!(r=co(r))&&or(t)?jo(pr(t),0,n):t.split(r,n):[]},Mr.spread=function(e,r){if("function"!=typeof e)throw new xe(t);return r=null==r?0:vr(du(r),0),Yn((function(t){var n=t[r],o=jo(t,0,r);return n&&At(o,n),St(e,this,o)}))},Mr.tail=function(e){var t=null==e?0:e.length;return t?ro(e,1,t):[]},Mr.take=function(t,r,n){return t&&t.length?ro(t,0,(r=n||r===e?1:du(r))<0?0:r):[]},Mr.takeRight=function(t,r,n){var o=null==t?0:t.length;return o?ro(t,(r=o-(r=n||r===e?1:du(r)))<0?0:r,o):[]},Mr.takeRightWhile=function(e,t){return e&&e.length?fo(e,ci(t,3),!1,!0):[]},Mr.takeWhile=function(e,t){return e&&e.length?fo(e,ci(t,3)):[]},Mr.tap=function(e,t){return t(e),e},Mr.throttle=function(e,r,n){var o=!0,i=!0;if("function"!=typeof e)throw new xe(t);return Xa(n)&&(o="leading"in n?!!n.leading:o,i="trailing"in n?!!n.trailing:i),Na(e,r,{leading:o,maxWait:r,trailing:i})},Mr.thru=fa,Mr.toArray=pu,Mr.toPairs=Uu,Mr.toPairsIn=Mu,Mr.toPath=function(e){return Fa(e)?Lt(e,ki):uu(e)?[e]:Io(Ri(gu(e)))},Mr.toPlainObject=vu,Mr.transform=function(e,t,r){var n=Fa(e),o=n||Wa(e)||cu(e);if(t=ci(t,4),null==r){var i=e&&e.constructor;r=o?n?new i:[]:Xa(e)&&Ja(i)?Gr(Ke(e)):{}}return(o?wt:bn)(e,(function(e,n,o){return t(r,e,n,o)})),r},Mr.unary=function(e){return wa(e,1)},Mr.union=ea,Mr.unionBy=ta,Mr.unionWith=ra,Mr.uniq=function(e){return e&&e.length?lo(e):[]},Mr.uniqBy=function(e,t){return e&&e.length?lo(e,ci(t,2)):[]},Mr.uniqWith=function(t,r){return r="function"==typeof r?r:e,t&&t.length?lo(t,e,r):[]},Mr.unset=function(e,t){return null==e||so(e,t)},Mr.unzip=na,Mr.unzipWith=oa,Mr.update=function(e,t,r){return null==e?e:po(e,t,mo(r))},Mr.updateWith=function(t,r,n,o){return o="function"==typeof o?o:e,null==t?t:po(t,r,mo(n),o)},Mr.values=Gu,Mr.valuesIn=function(e){return null==e?[]:Ht(e,Du(e))},Mr.without=ia,Mr.words=Ju,Mr.wrap=function(e,t){return ka(mo(t),e)},Mr.xor=aa,Mr.xorBy=ua,Mr.xorWith=ca,Mr.zip=la,Mr.zipObject=function(e,t){return vo(e||[],t||[],Xr)},Mr.zipObjectDeep=function(e,t){return vo(e||[],t||[],Zn)},Mr.zipWith=sa,Mr.entries=Uu,Mr.entriesIn=Mu,Mr.extend=bu,Mr.extendWith=Ou,ac(Mr,Mr),Mr.add=gc,Mr.attempt=Hu,Mr.camelCase=Qu,Mr.capitalize=Bu,Mr.ceil=mc,Mr.clamp=function(t,r,n){return n===e&&(n=r,r=e),n!==e&&(n=(n=hu(n))==n?n:0),r!==e&&(r=(r=hu(r))==r?r:0),an(hu(t),r,n)},Mr.clone=function(e){return un(e,4)},Mr.cloneDeep=function(e){return un(e,5)},Mr.cloneDeepWith=function(t,r){return un(t,5,r="function"==typeof r?r:e)},Mr.cloneWith=function(t,r){return un(t,4,r="function"==typeof r?r:e)},Mr.conformsTo=function(e,t){return null==t||cn(e,t,Nu(t))},Mr.deburr=qu,Mr.defaultTo=function(e,t){return null==e||e!=e?t:e},Mr.divide=bc,Mr.endsWith=function(t,r,n){t=gu(t),r=co(r);var o=t.length,i=n=n===e?o:an(du(n),0,o);return(n-=r.length)>=0&&t.slice(n,i)==r},Mr.eq=Ga,Mr.escape=function(e){return(e=gu(e))&&z.test(e)?e.replace($,rr):e},Mr.escapeRegExp=function(e){return(e=gu(e))&&re.test(e)?e.replace(te,"\\$&"):e},Mr.every=function(t,r,n){var o=Fa(t)?xt:dn;return n&&bi(t,r,n)&&(r=e),o(t,ci(r,3))},Mr.find=ha,Mr.findIndex=qi,Mr.findKey=function(e,t){return Mt(e,ci(t,3),bn)},Mr.findLast=va,Mr.findLastIndex=Fi,Mr.findLastKey=function(e,t){return Mt(e,ci(t,3),On)},Mr.floor=Oc,Mr.forEach=ga,Mr.forEachRight=ma,Mr.forIn=function(e,t){return null==e?e:gn(e,ci(t,3),Du)},Mr.forInRight=function(e,t){return null==e?e:mn(e,ci(t,3),Du)},Mr.forOwn=function(e,t){return e&&bn(e,ci(t,3))},Mr.forOwnRight=function(e,t){return e&&On(e,ci(t,3))},Mr.get=Tu,Mr.gt=Qa,Mr.gte=Ba,Mr.has=function(e,t){return null!=e&&hi(e,t,wn)},Mr.hasIn=wu,Mr.head=Ki,Mr.identity=rc,Mr.includes=function(e,t,r,n){e=Ka(e)?e:Gu(e),r=r&&!n?du(r):0;var o=e.length;return r<0&&(r=vr(o+r,0)),au(e)?r<=o&&e.indexOf(t,r)>-1:!!o&&Qt(e,t,r)>-1},Mr.indexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var o=null==r?0:du(r);return o<0&&(o=vr(n+o,0)),Qt(e,t,o)},Mr.inRange=function(t,r,n){return r=fu(r),n===e?(n=r,r=0):n=fu(n),function(e,t,r){return e>=gr(t,r)&&e<vr(t,r)}(t=hu(t),r,n)},Mr.invoke=Iu,Mr.isArguments=qa,Mr.isArray=Fa,Mr.isArrayBuffer=Va,Mr.isArrayLike=Ka,Mr.isArrayLikeObject=$a,Mr.isBoolean=function(e){return!0===e||!1===e||eu(e)&&Sn(e)==y},Mr.isBuffer=Wa,Mr.isDate=za,Mr.isElement=function(e){return eu(e)&&1===e.nodeType&&!nu(e)},Mr.isEmpty=function(e){if(null==e)return!0;if(Ka(e)&&(Fa(e)||"string"==typeof e||"function"==typeof e.splice||Wa(e)||cu(e)||qa(e)))return!e.length;var t=yi(e);if(t==b||t==S)return!e.size;if(Ei(e))return!Rn(e).length;for(var r in e)if(Ce.call(e,r))return!1;return!0},Mr.isEqual=function(e,t){return Dn(e,t)},Mr.isEqualWith=function(t,r,n){var o=(n="function"==typeof n?n:e)?n(t,r):e;return o===e?Dn(t,r,e,n):!!o},Mr.isError=Ya,Mr.isFinite=function(e){return"number"==typeof e&&Ut(e)},Mr.isFunction=Ja,Mr.isInteger=Ha,Mr.isLength=Za,Mr.isMap=tu,Mr.isMatch=function(e,t){return e===t||Ln(e,t,si(t))},Mr.isMatchWith=function(t,r,n){return n="function"==typeof n?n:e,Ln(t,r,si(r),n)},Mr.isNaN=function(e){return ru(e)&&e!=+e},Mr.isNative=function(e){if(_i(e))throw new _e("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return An(e)},Mr.isNil=function(e){return null==e},Mr.isNull=function(e){return null===e},Mr.isNumber=ru,Mr.isObject=Xa,Mr.isObjectLike=eu,Mr.isPlainObject=nu,Mr.isRegExp=ou,Mr.isSafeInteger=function(e){return Ha(e)&&e>=-9007199254740991&&e<=c},Mr.isSet=iu,Mr.isString=au,Mr.isSymbol=uu,Mr.isTypedArray=cu,Mr.isUndefined=function(t){return t===e},Mr.isWeakMap=function(e){return eu(e)&&yi(e)==x},Mr.isWeakSet=function(e){return eu(e)&&"[object WeakSet]"==Sn(e)},Mr.join=function(e,t){return null==e?"":Kt.call(e,t)},Mr.kebabCase=Fu,Mr.last=Yi,Mr.lastIndexOf=function(t,r,n){var o=null==t?0:t.length;if(!o)return-1;var i=o;return n!==e&&(i=(i=du(n))<0?vr(o+i,0):gr(i,o-1)),r==r?function(e,t,r){for(var n=r+1;n--;)if(e[n]===t)return n;return n}(t,r,i):Gt(t,qt,i,!0)},Mr.lowerCase=Vu,Mr.lowerFirst=Ku,Mr.lt=lu,Mr.lte=su,Mr.max=function(t){return t&&t.length?yn(t,rc,Tn):e},Mr.maxBy=function(t,r){return t&&t.length?yn(t,ci(r,2),Tn):e},Mr.mean=function(e){return Ft(e,rc)},Mr.meanBy=function(e,t){return Ft(e,ci(t,2))},Mr.min=function(t){return t&&t.length?yn(t,rc,Un):e},Mr.minBy=function(t,r){return t&&t.length?yn(t,ci(r,2),Un):e},Mr.stubArray=yc,Mr.stubFalse=hc,Mr.stubObject=function(){return{}},Mr.stubString=function(){return""},Mr.stubTrue=function(){return!0},Mr.multiply=jc,Mr.nth=function(t,r){return t&&t.length?qn(t,du(r)):e},Mr.noConflict=function(){return ft._===this&&(ft._=Ge),this},Mr.noop=uc,Mr.now=Ta,Mr.pad=function(e,t,r){e=gu(e);var n=(t=du(t))?sr(e):0;if(!t||n>=t)return e;var o=(t-n)/2;return Vo(yt(o),r)+e+Vo(dt(o),r)},Mr.padEnd=function(e,t,r){e=gu(e);var n=(t=du(t))?sr(e):0;return t&&n<t?e+Vo(t-n,r):e},Mr.padStart=function(e,t,r){e=gu(e);var n=(t=du(t))?sr(e):0;return t&&n<t?Vo(t-n,r)+e:e},Mr.parseInt=function(e,t,r){return r||null==t?t=0:t&&(t=+t),br(gu(e).replace(ne,""),t||0)},Mr.random=function(t,r,n){if(n&&"boolean"!=typeof n&&bi(t,r,n)&&(r=n=e),n===e&&("boolean"==typeof r?(n=r,r=e):"boolean"==typeof t&&(n=t,t=e)),t===e&&r===e?(t=0,r=1):(t=fu(t),r===e?(r=t,t=0):r=fu(r)),t>r){var o=t;t=r,r=o}if(n||t%1||r%1){var i=Or();return gr(t+i*(r-t+ct("1e-"+((i+"").length-1))),r)}return Wn(t,r)},Mr.reduce=function(e,t,r){var n=Fa(e)?Ct:$t,o=arguments.length<3;return n(e,ci(t,4),r,o,pn)},Mr.reduceRight=function(e,t,r){var n=Fa(e)?Rt:$t,o=arguments.length<3;return n(e,ci(t,4),r,o,fn)},Mr.repeat=function(t,r,n){return r=(n?bi(t,r,n):r===e)?1:du(r),zn(gu(t),r)},Mr.replace=function(){var e=arguments,t=gu(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Mr.result=function(t,r,n){var o=-1,i=(r=bo(r,t)).length;for(i||(i=1,t=e);++o<i;){var a=null==t?e:t[ki(r[o])];a===e&&(o=i,a=n),t=Ja(a)?a.call(t):a}return t},Mr.round=_c,Mr.runInContext=P,Mr.sample=function(e){return(Fa(e)?Yr:Jn)(e)},Mr.size=function(e){if(null==e)return 0;if(Ka(e))return au(e)?sr(e):e.length;var t=yi(e);return t==b||t==S?e.size:Rn(e).length},Mr.snakeCase=$u,Mr.some=function(t,r,n){var o=Fa(t)?kt:no;return n&&bi(t,r,n)&&(r=e),o(t,ci(r,3))},Mr.sortedIndex=function(e,t){return oo(e,t)},Mr.sortedIndexBy=function(e,t,r){return io(e,t,ci(r,2))},Mr.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var n=oo(e,t);if(n<r&&Ga(e[n],t))return n}return-1},Mr.sortedLastIndex=function(e,t){return oo(e,t,!0)},Mr.sortedLastIndexBy=function(e,t,r){return io(e,t,ci(r,2),!0)},Mr.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var r=oo(e,t,!0)-1;if(Ga(e[r],t))return r}return-1},Mr.startCase=Wu,Mr.startsWith=function(e,t,r){return e=gu(e),r=null==r?0:an(du(r),0,e.length),t=co(t),e.slice(r,r+t.length)==t},Mr.subtract=Ec,Mr.sum=function(e){return e&&e.length?Wt(e,rc):0},Mr.sumBy=function(e,t){return e&&e.length?Wt(e,ci(t,2)):0},Mr.template=function(t,r,n){var o=Mr.templateSettings;n&&bi(t,r,n)&&(r=e),t=gu(t),r=Ou({},r,o,Zo);var i,a,u=Ou({},r.imports,o.imports,Zo),c=Nu(u),l=Ht(u,c),s=0,p=r.interpolate||be,f="__p += '",d=we((r.escape||be).source+"|"+p.source+"|"+(p===H?pe:be).source+"|"+(r.evaluate||be).source+"|$","g"),y="//# sourceURL="+(Ce.call(r,"sourceURL")?(r.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ot+"]")+"\n";t.replace(d,(function(e,r,n,o,u,c){return n||(n=o),f+=t.slice(s,c).replace(Oe,nr),r&&(i=!0,f+="' +\n__e("+r+") +\n'"),u&&(a=!0,f+="';\n"+u+";\n__p += '"),n&&(f+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),s=c+e.length,e})),f+="';\n";var h=Ce.call(r,"variable")&&r.variable;if(h){if(le.test(h))throw new _e("Invalid `variable` option passed into `_.template`")}else f="with (obj) {\n"+f+"\n}\n";f=(a?f.replace(q,""):f).replace(F,"$1").replace(V,"$1;"),f="function("+(h||"obj")+") {\n"+(h?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var v=Hu((function(){return Ee(c,y+"return "+f).apply(e,l)}));if(v.source=f,Ya(v))throw v;return v},Mr.times=function(e,t){if((e=du(e))<1||e>c)return[];var r=s,n=gr(e,s);t=ci(t),e-=s;for(var o=zt(n,t);++r<e;)t(r);return o},Mr.toFinite=fu,Mr.toInteger=du,Mr.toLength=yu,Mr.toLower=function(e){return gu(e).toLowerCase()},Mr.toNumber=hu,Mr.toSafeInteger=function(e){return e?an(du(e),-9007199254740991,c):0===e?e:0},Mr.toString=gu,Mr.toUpper=function(e){return gu(e).toUpperCase()},Mr.trim=function(t,r,n){if((t=gu(t))&&(n||r===e))return Yt(t);if(!t||!(r=co(r)))return t;var o=pr(t),i=pr(r);return jo(o,Xt(o,i),er(o,i)+1).join("")},Mr.trimEnd=function(t,r,n){if((t=gu(t))&&(n||r===e))return t.slice(0,fr(t)+1);if(!t||!(r=co(r)))return t;var o=pr(t);return jo(o,0,er(o,pr(r))+1).join("")},Mr.trimStart=function(t,r,n){if((t=gu(t))&&(n||r===e))return t.replace(ne,"");if(!t||!(r=co(r)))return t;var o=pr(t);return jo(o,Xt(o,pr(r))).join("")},Mr.truncate=function(t,r){var n=30,o="...";if(Xa(r)){var i="separator"in r?r.separator:i;n="length"in r?du(r.length):n,o="omission"in r?co(r.omission):o}var a=(t=gu(t)).length;if(or(t)){var u=pr(t);a=u.length}if(n>=a)return t;var c=n-sr(o);if(c<1)return o;var l=u?jo(u,0,c).join(""):t.slice(0,c);if(i===e)return l+o;if(u&&(c+=l.length-c),ou(i)){if(t.slice(c).search(i)){var s,p=l;for(i.global||(i=we(i.source,gu(fe.exec(i))+"g")),i.lastIndex=0;s=i.exec(p);)var f=s.index;l=l.slice(0,f===e?c:f)}}else if(t.indexOf(co(i),c)!=c){var d=l.lastIndexOf(i);d>-1&&(l=l.slice(0,d))}return l+o},Mr.unescape=function(e){return(e=gu(e))&&W.test(e)?e.replace(K,dr):e},Mr.uniqueId=function(e){var t=++Re;return gu(e)+t},Mr.upperCase=zu,Mr.upperFirst=Yu,Mr.each=ga,Mr.eachRight=ma,Mr.first=Ki,ac(Mr,(vc={},bn(Mr,(function(e,t){Ce.call(Mr.prototype,t)||(vc[t]=e)})),vc),{chain:!1}),Mr.VERSION="4.17.21",wt(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Mr[e].placeholder=Mr})),wt(["drop","take"],(function(t,r){qr.prototype[t]=function(n){n=n===e?1:vr(du(n),0);var o=this.__filtered__&&!r?new qr(this):this.clone();return o.__filtered__?o.__takeCount__=gr(n,o.__takeCount__):o.__views__.push({size:gr(n,s),type:t+(o.__dir__<0?"Right":"")}),o},qr.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),wt(["filter","map","takeWhile"],(function(e,t){var r=t+1,n=1==r||3==r;qr.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:ci(e,3),type:r}),t.__filtered__=t.__filtered__||n,t}})),wt(["head","last"],(function(e,t){var r="take"+(t?"Right":"");qr.prototype[e]=function(){return this[r](1).value()[0]}})),wt(["initial","tail"],(function(e,t){var r="drop"+(t?"":"Right");qr.prototype[e]=function(){return this.__filtered__?new qr(this):this[r](1)}})),qr.prototype.compact=function(){return this.filter(rc)},qr.prototype.find=function(e){return this.filter(e).head()},qr.prototype.findLast=function(e){return this.reverse().find(e)},qr.prototype.invokeMap=Yn((function(e,t){return"function"==typeof e?new qr(this):this.map((function(r){return In(r,e,t)}))})),qr.prototype.reject=function(e){return this.filter(Ca(ci(e)))},qr.prototype.slice=function(t,r){t=du(t);var n=this;return n.__filtered__&&(t>0||r<0)?new qr(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),r!==e&&(n=(r=du(r))<0?n.dropRight(-r):n.take(r-t)),n)},qr.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},qr.prototype.toArray=function(){return this.take(s)},bn(qr.prototype,(function(t,r){var n=/^(?:filter|find|map|reject)|While$/.test(r),o=/^(?:head|last)$/.test(r),i=Mr[o?"take"+("last"==r?"Right":""):r],a=o||/^find/.test(r);i&&(Mr.prototype[r]=function(){var r=this.__wrapped__,u=o?[1]:arguments,c=r instanceof qr,l=u[0],s=c||Fa(r),p=function(e){var t=i.apply(Mr,At([e],u));return o&&f?t[0]:t};s&&n&&"function"==typeof l&&1!=l.length&&(c=s=!1);var f=this.__chain__,d=!!this.__actions__.length,y=a&&!f,h=c&&!d;if(!a&&s){r=h?r:new qr(this);var v=t.apply(r,u);return v.__actions__.push({func:fa,args:[p],thisArg:e}),new Br(v,f)}return y&&h?t.apply(this,u):(v=this.thru(p),y?o?v.value()[0]:v.value():v)})})),wt(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Ie[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);Mr.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var o=this.value();return t.apply(Fa(o)?o:[],e)}return this[r]((function(r){return t.apply(Fa(r)?r:[],e)}))}})),bn(qr.prototype,(function(e,t){var r=Mr[t];if(r){var n=r.name+"";Ce.call(Ir,n)||(Ir[n]=[]),Ir[n].push({name:t,func:r})}})),Ir[Qo(e,2).name]=[{name:"wrapper",func:e}],qr.prototype.clone=function(){var e=new qr(this.__wrapped__);return e.__actions__=Io(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Io(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Io(this.__views__),e},qr.prototype.reverse=function(){if(this.__filtered__){var e=new qr(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},qr.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=Fa(e),n=t<0,o=r?e.length:0,i=function(e,t,r){for(var n=-1,o=r.length;++n<o;){var i=r[n],a=i.size;switch(i.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=gr(t,e+a);break;case"takeRight":e=vr(e,t-a)}}return{start:e,end:t}}(0,o,this.__views__),a=i.start,u=i.end,c=u-a,l=n?u:a-1,s=this.__iteratees__,p=s.length,f=0,d=gr(c,this.__takeCount__);if(!r||!n&&o==c&&d==c)return yo(e,this.__actions__);var y=[];e:for(;c--&&f<d;){for(var h=-1,v=e[l+=t];++h<p;){var g=s[h],m=g.iteratee,b=g.type,O=m(v);if(2==b)v=O;else if(!O){if(1==b)continue e;break e}}y[f++]=v}return y},Mr.prototype.at=da,Mr.prototype.chain=function(){return pa(this)},Mr.prototype.commit=function(){return new Br(this.value(),this.__chain__)},Mr.prototype.next=function(){this.__values__===e&&(this.__values__=pu(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?e:this.__values__[this.__index__++]}},Mr.prototype.plant=function(t){for(var r,n=this;n instanceof Qr;){var o=Mi(n);o.__index__=0,o.__values__=e,r?i.__wrapped__=o:r=o;var i=o;n=n.__wrapped__}return i.__wrapped__=t,r},Mr.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof qr){var r=t;return this.__actions__.length&&(r=new qr(this)),(r=r.reverse()).__actions__.push({func:fa,args:[Xi],thisArg:e}),new Br(r,this.__chain__)}return this.thru(Xi)},Mr.prototype.toJSON=Mr.prototype.valueOf=Mr.prototype.value=function(){return yo(this.__wrapped__,this.__actions__)},Mr.prototype.first=Mr.prototype.head,Je&&(Mr.prototype[Je]=function(){return this}),Mr}();yt?((yt.exports=yr)._=yr,dt._=yr):ft._=yr}.call(x.exports)),x.exports);const L="Configuration help box",A="Configuration drop zone",C="Configuration text area",R="Paste JWT button",k="Upload JWT button",U="JWT form",M="JWT button",G="GCE button",Q="Private Key Path Input",B="Private Key Input",q="Fill JWT info manually",F="Show private key path input",V="Show private key input",K=["private_key","token_uri","client_email","project_id"],$=({onChange:e,showConfigEditor:t,showPaste:r,showUpload:n,isPasting:o,isUploading:i})=>{const[a,u]=(0,O.useState)(),c=(0,_.useTheme2)(),l=(0,O.useCallback)((e=>{u(null),r()}),[r]),s=(0,O.useCallback)((e=>{n(),u(null)}),[n]),p=(0,O.useCallback)((r=>{if(""!==r.trim()){let n;try{n=JSON.parse(r)}catch(e){u("Invalid JWT token")}const o=W(n);o.isValid?(t(),e({privateKey:n.private_key,tokenUri:n.token_uri,clientEmail:n.client_email,projectId:n.project_id})):u(o.error)}}),[u,e,t]);return O.createElement(O.Fragment,null,O.createElement(_.Field,{label:"JWT token",invalid:Boolean(a),description:o?"Paste JWT token below":"Upload or paste Google JWT token",error:a},O.createElement(O.Fragment,null,i&&O.createElement("div",{"data-testid":A},_.FileDropzone&&O.createElement(_.FileDropzone,{options:{multiple:!1,accept:".json"},readAs:"readAsText",onLoad:e=>{p(e)}},O.createElement("p",{style:{margin:0,fontSize:`${c.typography.h4.fontSize}`,textAlign:"center"}},"Drop the Google JWT file here",O.createElement("br",null),O.createElement("br",null),O.createElement(_.Button,{fill:"outline"},"Click to browse files")))),o&&O.createElement(_.TextArea,{"data-testid":C,autoFocus:!0,invalid:Boolean(a),placeholder:"Paste Google JWT token here",onBlur:e=>p(e.currentTarget.value),rows:12}))),!o&&O.createElement(O.Fragment,null,O.createElement(_.Button,{"data-testid":R,type:"button",fill:"outline",style:{color:`${c.colors.primary.text}`},onClick:l},"Paste JWT Token"),O.createElement("span",{style:{paddingRight:"10px",paddingLeft:"10px"}},"or")),o&&O.createElement(O.Fragment,null,O.createElement(_.Button,{"data-testid":k,type:"button",fill:"outline",style:{color:`${c.colors.primary.text}`},onClick:()=>{n()}},"Upload JWT Token"),O.createElement("span",{style:{paddingRight:"10px",paddingLeft:"10px"}},"or")),O.createElement(_.Button,{"data-testid":q,type:"button",fill:"outline",style:{color:`${c.colors.primary.text}`},onClick:t},"Fill In JWT Token manually"),o&&a&&O.createElement(_.Field,null,O.createElement(_.Button,{type:"button",fill:"outline",style:{color:`${c.colors.primary.text}`},onClick:s},"Upload JWT Token")))},W=e=>{if(!D.isObject(e))return{isValid:!1,error:"Invalid JWT token"};const t=K.filter((t=>!e[t]));return t.length>0?{isValid:!1,error:`Missing keys: ${t.join(", ")}`}:{isValid:!0}},{SecretFormField:z}=_.LegacyForms,Y=({options:e,onReset:t,onOptionsChange:r,showPaste:n,showUpload:o})=>{var i;const[a,u]=O.useState((e=>"privateKeyPath"in e&&""!==e.privateKeyPath?"path":"jwt")(e.jsonData)),c=t=>(0,v.onUpdateDatasourceJsonDataOption)({options:e,onOptionsChange:r},t),l=()=>{u("jwt"===a?"path":"jwt")},s=(0,_.useTheme2)(),p=O.createElement("span",null,"path"===a?O.createElement("a",{className:"external-link",onClick:l,"data-testid":V},"Paste private key"):"Paste private key"," ","or  ","jwt"===a?O.createElement("a",{className:"external-link",onClick:l,"data-testid":F},"provide path to private file"):"provide path to private key file"),f={isConfigured:Boolean(e.secureJsonFields.privateKey),value:(null==(i=e.secureJsonData)?void 0:i.privateKey)||"",placeholder:"Enter Private key",onReset:()=>t(),onChange:(0,v.onUpdateDatasourceSecureJsonDataOption)({options:e,onOptionsChange:r},"privateKey"),"data-testid":B};return O.createElement("div",{"data-testid":U},O.createElement(_.Field,{label:"Project ID"},O.createElement(_.Input,{id:"defaultProject",width:60,value:e.jsonData.defaultProject||"",onChange:c("defaultProject")})),O.createElement(_.Field,{label:"Client email"},O.createElement(_.Input,{width:60,id:"clientEmail",value:e.jsonData.clientEmail||"",onChange:c("clientEmail")})),O.createElement(_.Field,{label:"Token URI"},O.createElement(_.Input,{width:60,id:"tokenUri",value:e.jsonData.tokenUri||"",onChange:c("tokenUri")})),"path"===a&&O.createElement(_.Field,{label:"Private key path",description:p},O.createElement(_.Input,{width:60,id:"privateKeyPath",value:e.jsonData.privateKeyPath||"",placeholder:"File location of your private key (e.g. /etc/secrets/gce.pem)",onChange:c("privateKeyPath"),"data-testid":Q})),"jwt"===a&&O.createElement(O.Fragment,null,_.SecretInput?O.createElement(_.Field,{label:"Private key",description:p},O.createElement(_.SecretInput,{...f,width:60})):O.createElement(z,{...f,label:"Private key",labelWidth:10,inputWidth:20})),O.createElement(O.Fragment,null,O.createElement(_.Button,{"data-testid":R,type:"button",fill:"outline",style:{color:`${s.colors.primary.text}`},onClick:n},"Paste JWT Token"),O.createElement("span",{style:{paddingRight:"10px",paddingLeft:"10px"}},"or"),O.createElement(_.Button,{"data-testid":k,type:"button",fill:"outline",style:{color:`${s.colors.primary.text}`},onClick:o},"Upload JWT Token")))};function J(e){const{options:t,onOptionsChange:r,authOptions:n,showServiceAccountImpersonationConfig:o}=e,{jsonData:i,secureJsonFields:a,secureJsonData:u}=T(t),c=()=>Boolean(i.clientEmail&&i.defaultProject&&i.tokenUri&&(a&&a.privateKey||i.privateKeyPath)),[l,s]=(0,O.useState)(H(i.authenticationType)),[p,f]=(0,O.useState)(c()),[d,y]=(0,O.useState)(!1),[h,g]=(0,O.useState)(!0),m=()=>{y(!1),g(!0),f(!1)},b=()=>{y(!0),g(!1),f(!1)};return O.createElement(O.Fragment,null,O.createElement(_.FieldSet,{label:"Authentication"},O.createElement(_.Field,{label:"Authentication type"},O.createElement(_.RadioButtonGroup,{options:n,value:i.authenticationType||E,onChange:e=>{f(c()),r({...t,jsonData:{...t.jsonData,authenticationType:e}}),s(H(e))}}))),l&&O.createElement(_.FieldSet,{label:"JWT Key Details"},p?O.createElement(Y,{options:t,onReset:()=>(()=>{const e={...u},n={...t.jsonData};delete n.clientEmail,delete n.defaultProject,delete n.tokenUri,delete n.privateKeyPath,delete e.privateKey,s(!0),f(!1),r({...t,secureJsonFields:{...t.secureJsonFields,privateKey:!1},secureJsonData:e,jsonData:n})})(),onOptionsChange:r,showUpload:m,showPaste:b}):O.createElement($,{showConfigEditor:()=>{f(!0)},showUpload:m,showPaste:b,isPasting:d,isUploading:h,onChange:e=>{r({...t,secureJsonFields:{...a,privateKey:!0},secureJsonData:{...u,privateKey:e.privateKey},jsonData:{...i,clientEmail:e.clientEmail,defaultProject:e.projectId,tokenUri:e.tokenUri}})}})," "),i.authenticationType===S&&O.createElement(_.Field,{label:"Default project"},O.createElement(_.Input,{id:"defaultProject",width:60,value:t.jsonData.defaultProject||"",onChange:(0,v.onUpdateDatasourceJsonDataOption)(e,"defaultProject")})),o&&O.createElement(_.FieldSet,{label:"Service account impersonation"},O.createElement(_.Field,{label:"Enable",htmlFor:"usingImpersonation",description:O.createElement("span",null,"Read more about service account impersonation"," ",O.createElement("a",{href:"https://cloud.google.com/iam/docs/service-account-impersonation",rel:"noreferrer",className:"external-link",target:"_blank"},"here"))},O.createElement(_.Switch,{value:t.jsonData.usingImpersonation||!1,onChange:(0,v.onUpdateDatasourceJsonDataOptionChecked)(e,"usingImpersonation"),id:"usingImpersonation"})),t.jsonData.usingImpersonation&&O.createElement(_.Field,{label:"Service account to impersonate",htmlFor:"serviceAccountToImpersonate"},O.createElement(_.Input,{id:"serviceAccountToImpersonate",width:60,value:t.jsonData.serviceAccountToImpersonate||"",onChange:(0,v.onUpdateDatasourceJsonDataOption)(e,"serviceAccountToImpersonate")}))))}const H=e=>e===E||void 0===e,Z=[{label:"Google JWT File",value:E,ariaLabel:M},{label:"GCE Default Service Account",value:S,ariaLabel:G}],X=e=>{const t=T(e.options),r=t.jsonData.authenticationType===E||void 0===t.jsonData.authenticationType;return O.createElement(O.Fragment,null,O.createElement(J,{authOptions:Z,onOptionsChange:e.onOptionsChange,showServiceAccountImpersonationConfig:!0,options:t}),O.createElement("div",{className:"grafana-info-box",style:{marginTop:"16px"},"data-testid":L},O.createElement("p",null,"Don’t know how to get a service account key file or create a service account? Read more"," ",O.createElement("a",{className:"external-link",target:"_blank",rel:"noopener noreferrer",href:"https://grafana.com/docs/grafana/latest/datasources/google-cloud-monitoring/google-authentication/"},"in the documentation."))),!r&&O.createElement(_.Alert,{title:"",severity:"info"},"Verify GCE default service account by clicking Save & Test"))},ee=({dataSourceName:e,docsLink:t,hasRequiredFields:r=!0,className:n})=>{const o=(0,_.useTheme2)(),i={container:(0,b.css)({p:{margin:0},"p + p":{marginTop:o.spacing(2)}}),text:(0,b.css)({...o.typography.body,color:o.colors.text.secondary,a:(0,b.css)({color:o.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})})};return O.createElement("div",{className:(0,b.cx)(i.container,n)},O.createElement("p",{className:i.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",O.createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),r&&O.createElement("p",{className:i.text},O.createElement("i",null,"Fields marked with * are required")))},te=({children:e,title:t,description:r,isCollapsible:n=!1,isInitiallyOpen:o=!0,kind:i="section",className:a})=>{const{colors:u,typography:c,spacing:l}=(0,_.useTheme2)(),[s,p]=(0,O.useState)(!n||o),f=s?"angle-up":"angle-down",d="sub-section"===i,y=`${s?"Collapse":"Expand"} section ${t}`,h={header:(0,b.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,b.css)({margin:0}),subtitle:(0,b.css)({margin:0,fontWeight:c.fontWeightRegular}),descriptionText:(0,b.css)({marginTop:l(d?.25:.5),marginBottom:0,...c.bodySmall,color:u.text.secondary}),content:(0,b.css)({marginTop:l(2)})};return O.createElement("div",{className:a},O.createElement("div",{className:h.header},"section"===i?O.createElement("h3",{className:h.title},t):O.createElement("h6",{className:h.subtitle},t),n&&O.createElement(_.IconButton,{name:f,onClick:()=>p(!s),type:"button",size:"xl","aria-label":y})),r&&O.createElement("p",{className:h.descriptionText},r),s&&O.createElement("div",{className:h.content},e))},re=({children:e,...t})=>O.createElement(te,{...t,kind:"section"},e);function ne(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ne(e,t,r[t])}))}return e}function ie(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class ae extends O.PureComponent{render(){const{options:e,onOptionsChange:t}=this.props;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(ee,{dataSourceName:"Google Cloud Monitoring",docsLink:"https://grafana.com/docs/grafana/latest/datasources/google-cloud-monitoring/",hasRequiredFields:!0}),(0,m.jsx)(_.Divider,{}),(0,m.jsx)(X,ie(oe({},this.props),{onOptionsChange:this.handleOnOptionsChange})),g.config.secureSocksDSProxyEnabled&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(_.Divider,{}),(0,m.jsx)(re,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source. This includes Secure Socks Proxy.",isCollapsible:!0,isInitiallyOpen:void 0!==e.jsonData.enableSecureSocksProxy,children:(0,m.jsx)(_.SecureSocksProxySettings,{options:e,onOptionsChange:t})})]})]})}constructor(...e){super(...e),ne(this,"handleOnOptionsChange",(e=>{(e.jsonData.privateKeyPath||e.secureJsonFields.privateKey)&&(0,g.reportInteraction)("grafana_cloud_monitoring_config_changed",{authenticationType:"JWT",privateKey:e.secureJsonFields.privateKey,privateKeyPath:!!e.jsonData.privateKeyPath}),this.props.onOptionsChange(e)}))}}var ue=p(513),ce=p.n(ue);const le=({children:e,wrap:t=!0,...r})=>{var n,o;return O.createElement(_.Stack,{wrap:t?"wrap":void 0,direction:null!=(n=r.direction)?n:"row",gap:null!=(o=r.gap)?o:2,...r},e)},se=({children:e})=>O.createElement(le,{gap:.5,direction:"column"},e),pe={queryEditor:{container:"data-testid cloud-monitoring-query-editor",header:{select:"data-testid cloud-monitoring-header"},visualMetricsQueryEditor:{container:{input:"data-testid cloud-monitoring-visual-metrics-query-editor"}},mqlMetricsQueryEditor:{container:{input:"data-testid cloud-monitoring-mql-query-editor"}},sloQueryEditor:{container:{input:"data-testid cloud-monitoring-slo-query-editor"}},promQlQueryEditor:{container:{input:"data-testid cloud-monitoring-prom-ql-query-editor"}}}};var fe=function(e){return e.ANNOTATION="annotation",e.PROMQL="promQL",e.SLO="slo",e.TIME_SERIES_LIST="timeSeriesList",e.TIME_SERIES_QUERY="timeSeriesQuery",e}({});var de=function(e){return e.Delta="delta",e.None="none",e.Rate="rate",e}({});var ye=function(e){return e.CUMULATIVE="CUMULATIVE",e.DELTA="DELTA",e.GAUGE="GAUGE",e.METRIC_KIND_UNSPECIFIED="METRIC_KIND_UNSPECIFIED",e}({}),he=function(e){return e.BOOL="BOOL",e.DISTRIBUTION="DISTRIBUTION",e.DOUBLE="DOUBLE",e.INT64="INT64",e.MONEY="MONEY",e.STRING="STRING",e.VALUE_TYPE_UNSPECIFIED="VALUE_TYPE_UNSPECIFIED",e}({}),ve=function(e){return e.ALIGN_COUNT="ALIGN_COUNT",e.ALIGN_COUNT_FALSE="ALIGN_COUNT_FALSE",e.ALIGN_COUNT_TRUE="ALIGN_COUNT_TRUE",e.ALIGN_DELTA="ALIGN_DELTA",e.ALIGN_FRACTION_TRUE="ALIGN_FRACTION_TRUE",e.ALIGN_INTERPOLATE="ALIGN_INTERPOLATE",e.ALIGN_MAX="ALIGN_MAX",e.ALIGN_MEAN="ALIGN_MEAN",e.ALIGN_MIN="ALIGN_MIN",e.ALIGN_NEXT_OLDER="ALIGN_NEXT_OLDER",e.ALIGN_NONE="ALIGN_NONE",e.ALIGN_PERCENTILE_05="ALIGN_PERCENTILE_05",e.ALIGN_PERCENTILE_50="ALIGN_PERCENTILE_50",e.ALIGN_PERCENTILE_95="ALIGN_PERCENTILE_95",e.ALIGN_PERCENTILE_99="ALIGN_PERCENTILE_99",e.ALIGN_PERCENT_CHANGE="ALIGN_PERCENT_CHANGE",e.ALIGN_RATE="ALIGN_RATE",e.ALIGN_STDDEV="ALIGN_STDDEV",e.ALIGN_SUM="ALIGN_SUM",e}({});var ge=function(e){return e.Aggregations="aggregations",e.Aligners="aligners",e.AlignmentPeriods="alignmentPeriods",e.DefaultProject="defaultProject",e.LabelKeys="labelKeys",e.LabelValues="labelValues",e.MetricTypes="metricTypes",e.Projects="projects",e.ResourceTypes="resourceTypes",e.SLO="slo",e.SLOServices="sloServices",e.Selectors="selectors",e.Services="services",e}({});const me=e=>{var t;const{label:r,optional:n,tooltip:o,tooltipInteractive:i,children:a,width:u,...c}=e,l=(0,_.useStyles2)(be,u),s=(null==c?void 0:c.htmlFor)||(null==(t=_.ReactUtils)?void 0:t.getChildId(a)),p=O.createElement(O.Fragment,null,O.createElement("label",{className:l.label,htmlFor:s},r,n&&O.createElement("span",{className:l.optional}," - optional"),o&&O.createElement(_.Tooltip,{placement:"top",content:o,theme:"info",interactive:i},O.createElement(_.Icon,{tabIndex:0,name:"info-circle",size:"sm",className:l.icon}))),O.createElement(_.Space,{v:.5}));return O.createElement("div",{className:l.root},O.createElement(_.Field,{className:l.field,label:p,...c},a))},be=(e,t)=>({root:(0,b.css)({minWidth:e.spacing(null!=t?t:0)}),label:(0,b.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium}),optional:(0,b.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,b.css)({marginBottom:0}),icon:(0,b.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})}),Oe=({refId:e,value:t="",onChange:r})=>{const[n,o]=(0,O.useState)(null!=t?t:""),i=(0,h.debounce)(r,1e3);return(0,m.jsx)(me,{label:"Alias by",children:(0,m.jsx)(_.Input,{id:`${e}-alias-by`,value:n,onChange:e=>{o(e.currentTarget.value),i(e.currentTarget.value)}})})},je=({children:e})=>{const t=(0,_.useStyles2)(_e);return O.createElement("div",{className:t.root},O.createElement(le,{gap:2},e))},_e=e=>({root:(0,b.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.radius.default})}),Ee=[{text:"none",value:"ALIGN_NONE",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.DISTRIBUTION,he.STRING,he.VALUE_TYPE_UNSPECIFIED,he.BOOL],metricKinds:[ye.GAUGE]},{text:"delta",value:"ALIGN_DELTA",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.DISTRIBUTION],metricKinds:[ye.CUMULATIVE,ye.DELTA]},{text:"rate",value:"ALIGN_RATE",valueTypes:[he.INT64,he.DOUBLE,he.MONEY],metricKinds:[ye.CUMULATIVE,ye.DELTA]},{text:"interpolate",value:"ALIGN_INTERPOLATE",valueTypes:[he.INT64,he.DOUBLE,he.MONEY],metricKinds:[ye.GAUGE]},{text:"next older",value:"ALIGN_NEXT_OLDER",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.DISTRIBUTION,he.STRING,he.VALUE_TYPE_UNSPECIFIED,he.BOOL],metricKinds:[ye.GAUGE]},{text:"min",value:"ALIGN_MIN",valueTypes:[he.INT64,he.DOUBLE,he.MONEY],metricKinds:[ye.GAUGE,ye.DELTA]},{text:"max",value:"ALIGN_MAX",valueTypes:[he.INT64,he.DOUBLE,he.MONEY],metricKinds:[ye.GAUGE,ye.DELTA]},{text:"mean",value:"ALIGN_MEAN",valueTypes:[he.INT64,he.DOUBLE,he.MONEY],metricKinds:[ye.GAUGE,ye.DELTA]},{text:"count",value:"ALIGN_COUNT",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.BOOL],metricKinds:[ye.GAUGE,ye.DELTA]},{text:"sum",value:"ALIGN_SUM",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.DISTRIBUTION],metricKinds:[ye.GAUGE,ye.DELTA]},{text:"stddev",value:"ALIGN_STDDEV",valueTypes:[he.INT64,he.DOUBLE,he.MONEY],metricKinds:[ye.GAUGE,ye.DELTA]},{text:"count true",value:"ALIGN_COUNT_TRUE",valueTypes:[he.BOOL],metricKinds:[ye.GAUGE]},{text:"count false",value:"ALIGN_COUNT_FALSE",valueTypes:[he.BOOL],metricKinds:[ye.GAUGE]},{text:"fraction true",value:"ALIGN_FRACTION_TRUE",valueTypes:[he.BOOL],metricKinds:[ye.GAUGE]},{text:"percentile 99",value:"ALIGN_PERCENTILE_99",valueTypes:[he.DISTRIBUTION],metricKinds:[ye.GAUGE,ye.DELTA]},{text:"percentile 95",value:"ALIGN_PERCENTILE_95",valueTypes:[he.DISTRIBUTION],metricKinds:[ye.GAUGE,ye.DELTA]},{text:"percentile 50",value:"ALIGN_PERCENTILE_50",valueTypes:[he.DISTRIBUTION],metricKinds:[ye.GAUGE,ye.DELTA]},{text:"percentile 05",value:"ALIGN_PERCENTILE_05",valueTypes:[he.DISTRIBUTION],metricKinds:[ye.GAUGE,ye.DELTA]},{text:"percent change",value:"ALIGN_PERCENT_CHANGE",valueTypes:[he.INT64,he.DOUBLE,he.MONEY],metricKinds:[ye.GAUGE,ye.DELTA]}],Se=[{text:"none",value:"REDUCE_NONE",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.DISTRIBUTION,he.BOOL,he.STRING],metricKinds:[ye.GAUGE,ye.DELTA,ye.CUMULATIVE,ye.METRIC_KIND_UNSPECIFIED]},{text:"mean",value:"REDUCE_MEAN",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.DISTRIBUTION],metricKinds:[ye.GAUGE,ye.DELTA,ye.CUMULATIVE]},{text:"min",value:"REDUCE_MIN",valueTypes:[he.INT64,he.DOUBLE,he.MONEY],metricKinds:[ye.GAUGE,ye.DELTA,ye.CUMULATIVE,ye.METRIC_KIND_UNSPECIFIED]},{text:"max",value:"REDUCE_MAX",valueTypes:[he.INT64,he.DOUBLE,he.MONEY],metricKinds:[ye.GAUGE,ye.DELTA,ye.CUMULATIVE,ye.METRIC_KIND_UNSPECIFIED]},{text:"sum",value:"REDUCE_SUM",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.DISTRIBUTION],metricKinds:[ye.GAUGE,ye.DELTA,ye.CUMULATIVE,ye.METRIC_KIND_UNSPECIFIED]},{text:"std. dev.",value:"REDUCE_STDDEV",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.DISTRIBUTION],metricKinds:[ye.GAUGE,ye.DELTA,ye.CUMULATIVE,ye.METRIC_KIND_UNSPECIFIED]},{text:"count",value:"REDUCE_COUNT",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.DISTRIBUTION,he.BOOL,he.STRING],metricKinds:[ye.GAUGE,ye.DELTA,ye.CUMULATIVE]},{text:"count true",value:"REDUCE_COUNT_TRUE",valueTypes:[he.BOOL],metricKinds:[ye.GAUGE,ye.DELTA]},{text:"count false",value:"REDUCE_COUNT_FALSE",valueTypes:[he.BOOL],metricKinds:[ye.GAUGE,ye.DELTA]},{text:"99th percentile",value:"REDUCE_PERCENTILE_99",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.DISTRIBUTION],metricKinds:[ye.GAUGE,ye.DELTA,ye.CUMULATIVE]},{text:"95th percentile",value:"REDUCE_PERCENTILE_95",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.DISTRIBUTION],metricKinds:[ye.GAUGE,ye.DELTA,ye.CUMULATIVE]},{text:"50th percentile",value:"REDUCE_PERCENTILE_50",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.DISTRIBUTION],metricKinds:[ye.GAUGE,ye.DELTA,ye.CUMULATIVE]},{text:"5th percentile",value:"REDUCE_PERCENTILE_05",valueTypes:[he.INT64,he.DOUBLE,he.MONEY,he.DISTRIBUTION],metricKinds:[ye.GAUGE,ye.DELTA,ye.CUMULATIVE]}],Te=[{text:"grafana auto",value:"grafana-auto"},{text:"stackdriver auto",value:"stackdriver-auto",hidden:!0},{text:"cloud monitoring auto",value:"cloud-monitoring-auto"},{text:"1m",value:"+60s"},{text:"2m",value:"+120s"},{text:"5m",value:"+300s"},{text:"10m",value:"+600s"},{text:"30m",value:"+1800s"},{text:"1h",value:"+3600s"},{text:"3h",value:"+7200s"},{text:"6h",value:"+21600s"},{text:"1d",value:"+86400s"},{text:"3d",value:"+259200s"},{text:"1w",value:"+604800s"}],we=[{text:"auto",value:"auto"},{text:"1m",value:"1m"},{text:"2m",value:"2m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"30m",value:"30m"},{text:"1h",value:"1h"},{text:"3h",value:"3h"},{text:"6h",value:"6h"},{text:"1d",value:"1d"},{text:"3d",value:"3d"},{text:"1w",value:"1w"}],Pe=[{text:"1m",value:"1m"},{text:"2m",value:"2m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"30m",value:"30m"},{text:"1h",value:"1h"},{text:"3h",value:"3h"},{text:"6h",value:"6h"},{text:"24h",value:"24h"},{text:"72h",value:"72h"}],xe=["metadata.system_labels.cloud_account","metadata.system_labels.name","metadata.system_labels.region","metadata.system_labels.state","metadata.system_labels.instance_group","metadata.system_labels.node_name","metadata.system_labels.service_name","metadata.system_labels.top_level_controller_type","metadata.system_labels.top_level_controller_name","metadata.system_labels.container_image"],Ie="select_slo_burn_rate",Ne=[{label:"SLI Value",value:"select_slo_health"},{label:"SLO Compliance",value:"select_slo_compliance"},{label:"SLO Error Budget Remaining",value:"select_slo_budget_fraction"},{label:"SLO Burn Rate",value:Ie}],De=[{label:"Builder",value:fe.TIME_SERIES_LIST},{label:"MQL",value:fe.TIME_SERIES_QUERY},{label:"Service Level Objectives (SLO)",value:fe.SLO},{label:"PromQL",value:fe.PROMQL}];function Le(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ae(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Ce({inputId:e,templateVariableOptions:t,onChange:r,current:n,disabled:o,aligmentPeriods:i}){const a=(0,O.useMemo)((()=>i.map((e=>Ae(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Le(e,t,r[t])}))}return e}({},e),{label:e.text})))),[i]),u=(0,O.useMemo)((()=>a.filter((e=>!e.hidden))),[a]);return(0,m.jsx)(_.Select,{width:"auto",onChange:({value:e})=>r(e),value:[...a,...t].find((e=>e.value===n)),options:[{label:"Template Variables",options:t},{label:"Aggregations",expanded:!0,options:u}],placeholder:"Select Period",inputId:e,disabled:o,allowCustomValue:!0,menuPlacement:"top"})}const Re=({refId:e,onChange:t,graphPeriod:r,variableOptionGroup:n})=>(0,m.jsx)(je,{children:(0,m.jsx)(me,{label:"Graph period",htmlFor:`${e}-graph-period`,tooltip:(0,m.jsxs)(m.Fragment,{children:["Set ",(0,m.jsx)("code",{children:"graph_period"})," which forces a preferred period between points. Automatically set to the current interval if left blank."]}),children:(0,m.jsxs)(_.Stack,{gap:1,children:[(0,m.jsx)(_.Switch,{"data-testid":`${e}-switch-graph-period`,value:"disabled"!==r,onChange:e=>t(e.currentTarget.checked?"":"disabled")}),(0,m.jsx)(Ce,{inputId:`${e}-graph-period`,templateVariableOptions:n.options,current:r,onChange:t,disabled:"disabled"===r,aligmentPeriods:we})]})})});function ke({query:e,onChange:t,onRunQuery:r}){return(0,m.jsx)("span",{"data-testid":pe.queryEditor.mqlMetricsQueryEditor.container.input,children:(0,m.jsx)(_.TextArea,{name:"Query",className:"slate-query-field",value:e,rows:10,placeholder:"Enter a Cloud Monitoring MQL query (Run with Shift+Enter)",onBlur:r,onChange:e=>t(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&(e.shiftKey||e.ctrlKey)&&(e.preventDefault(),r())}})})}function Ue({refId:e,projectName:t,datasource:r,onChange:n,templateVariableOptions:o}){const[i,a]=(0,O.useState)([]);(0,O.useEffect)((()=>{r.getProjects().then((e=>a(e)))}),[r]);const u=(0,O.useMemo)((()=>[{label:"Template Variables",options:o},...i]),[i,o]);return(0,m.jsx)(me,{label:"Project",children:(0,m.jsx)(_.Select,{width:"auto",allowCustomValue:!0,formatCreateLabel:e=>`Use project: ${e}`,onChange:({value:e})=>n(e),options:u,value:{value:t,label:t},placeholder:"Select Project",inputId:`${e}-project`})})}var Me=p(635),Ge=p.n(Me);const Qe=({children:e})=>O.createElement(le,{gap:1},e);function Be(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function qe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fe(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Ve=e=>(0,h.uniqBy)(e,"service"),Ke=(e,t)=>e.filter((e=>e.service===t)),$e=(e,t,r,n)=>{const o=Ke(e,n).map((e=>({value:e.type,name:e.displayName}))),i=o.some((e=>e.value===r)),a=o.length?o[0].value:"";return{metricTypes:o,selectedMetricType:i?t:a}},We=(e,t,r)=>(r&&r===de.Rate&&(t=ye.GAUGE),e?Ee.filter((r=>-1!==r.valueTypes.indexOf(e)&&-1!==r.metricKinds.indexOf(t))):[]),ze=(e,t)=>t?Se.filter((r=>-1!==r.valueTypes.indexOf(e)&&-1!==r.metricKinds.indexOf(t))):[],Ye=function(){var e,t=(e=function*(e,t,r){const n=yield e.getLabels(t,"handleLabelKeysQuery",r);return[...Object.keys(n),...xe]},function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Be(i,n,o,a,u,"next",e)}function u(e){Be(i,n,o,a,u,"throw",e)}a(void 0)}))});return function(e,r,n){return t.apply(this,arguments)}}(),Je=(e=he.DOUBLE,t=ye.GAUGE,r=ve.ALIGN_MEAN,n)=>{const o=(0,g.getTemplateSrv)(),i=We(e,t,n).map((e=>Fe(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){qe(e,t,r[t])}))}return e}({},e),{label:e.text})));return i.some((e=>e.value===o.replace(r)))||(r=i.length>0?i[0].value:ve.ALIGN_MEAN),{alignOptions:i,perSeriesAligner:r}},He=e=>{const t=e.reduce(((e,t)=>{const r=t.split(".").map(h.startCase),n=(2===r.length?r:(0,h.initial)(r)).join(" "),o={value:t,label:t};return e[n]?e[n]=[...e[n],o]:e[n]=[o],e}),{});return Object.entries(t).map((([e,t])=>({label:e,options:t,expanded:!0})),[])},Ze=(e,t)=>{const{perSeriesAligner:r,alignmentPeriod:n}=e;if(!n||!r)return"";const o=Ee.find((e=>e.value===t.templateSrv.replace(r))),i=parseInt(n,10);var a;return`${v.rangeUtil.secondsToHms(i)} interval (${null!==(a=null==o?void 0:o.text)&&void 0!==a?a:""})`},Xe=e=>{var t,r;const n=null==e||null===(t=e.filters)||void 0===t?void 0:t.findIndex((e=>"metric.type"===e));return(null==e||null===(r=e.filters)||void 0===r?void 0:r[n+2])||""},et=(e,t)=>{var r;if(!e.filters)return e.filters=["metric.type","=",t],e;const n=null==e||null===(r=e.filters)||void 0===r?void 0:r.findIndex((e=>"metric.type"===e));return-1===n?e.filters.push("metric.type","=",t):e.filters[n+2]=t,e};function tt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const nt=({inputId:e,query:t,templateVariableOptions:r,onChange:n,metricDescriptor:o,preprocessor:i})=>{const{perSeriesAligner:a}=t;let{valueType:u,metricKind:c}=o||{};const{perSeriesAligner:l,alignOptions:s}=(0,O.useMemo)((()=>Je(u,c,a,i)),[u,c,a,i]);return(0,m.jsx)(_.Select,{onChange:({value:e})=>n(rt(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){tt(e,t,r[t])}))}return e}({},t),{perSeriesAligner:e})),value:[...s,...r].find((e=>e.value===l)),options:[{label:"Template Variables",options:r},{label:"Alignment options",expanded:!0,options:s}],placeholder:"Select Alignment",inputId:e,menuPlacement:"top"})};function ot(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function it(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ot(e,t,r[t])}))}return e}function at(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ut=({refId:e,templateVariableOptions:t,onChange:r,query:n,customMetaData:o,datasource:i,metricDescriptor:a,preprocessor:u})=>{const c=(0,O.useMemo)((()=>Ze(o,i)),[o,i]);return(0,m.jsxs)(Qe,{children:[(0,m.jsx)(me,{label:"Alignment function",tooltip:"The process of alignment consists of collecting all data points received in a fixed length of time, applying a function to combine those data points, and assigning a timestamp to the result.",children:(0,m.jsx)(nt,{inputId:`${e}-alignment-function`,templateVariableOptions:t,query:n,onChange:e=>r(it({},n,e)),metricDescriptor:a,preprocessor:u})}),(0,m.jsx)(me,{label:"Alignment period",tooltip:c,children:(0,m.jsx)(Ce,{inputId:`${e}-alignment-period`,templateVariableOptions:t,current:n.alignmentPeriod,onChange:e=>r(at(it({},n),{alignmentPeriod:e})),aligmentPeriods:Te})})]})};function ct(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const st=e=>{const t=pt(e),r=ft(t,e);return(0,m.jsx)(me,{label:"Group by function","data-testid":"cloud-monitoring-aggregation",tooltip:"Aggregation function used on the metric data. Defaults to none for scalar data and mean for distribution data. Not applying an aggregation to distribution data may lead to performance issues.",children:(0,m.jsx)(_.Select,{width:"auto",onChange:({value:t})=>e.onChange(t),value:r,options:[{label:"Template Variables",options:e.templateVariableOptions},{label:"Aggregations",expanded:!0,options:t}],placeholder:"Select Reducer",inputId:`${e.refId}-group-by-function`,menuPlacement:"top"})})},pt=({metricDescriptor:e})=>{const t=null==e?void 0:e.valueType,r=null==e?void 0:e.metricKind;return(0,O.useMemo)((()=>t&&r?ze(t,r).map((e=>lt(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ct(e,t,r[t])}))}return e}({},e),{label:e.text}))):[]),[t,r])},ft=(e,t)=>(0,O.useMemo)((()=>[...e,...t.templateVariableOptions].find((e=>e.value===t.crossSeriesReducer))),[e,t.crossSeriesReducer,t.templateVariableOptions]);function dt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){dt(e,t,r[t])}))}return e}function ht(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const vt=({refId:e,labels:t=[],query:r,onChange:n,variableOptionGroup:o,metricDescriptor:i})=>{const a=(0,O.useMemo)((()=>[o,...He([...t,...xe])]),[t,o]);var u,c;return(0,m.jsxs)(Qe,{children:[(0,m.jsx)(me,{label:"Group by",tooltip:"You can reduce the amount of data returned for a metric by combining different time series. To combine multiple time series, you can specify a grouping and a function. Grouping is done on the basis of labels. The grouping function is used to combine the time series in the group into a single time series.",children:(0,m.jsx)(_.MultiSelect,{allowCustomValue:!0,inputId:`${e}-group-by`,width:"auto",placeholder:"Choose label",options:a,value:null!==(u=r.groupBys)&&void 0!==u?u:[],onChange:e=>{n(ht(yt({},r),{groupBys:e.map((e=>e.value))}))},menuPlacement:"top"})}),(0,m.jsx)(st,{metricDescriptor:i,templateVariableOptions:o.options,crossSeriesReducer:r.crossSeriesReducer,groupBys:null!==(c=r.groupBys)&&void 0!==c?c:[],onChange:e=>n(ht(yt({},r),{crossSeriesReducer:e})),refId:e})]})},gt=({className:e,...t})=>{const r=(0,_.useStyles2)(mt);return O.createElement(_.Button,{...t,className:(0,b.cx)(e,r.button)})},mt=e=>({button:(0,b.css)({paddingLeft:e.spacing(1.5),paddingRight:e.spacing(1.5)})}),bt=O.forwardRef((function({items:e,renderItem:t,onChange:r},n){return O.createElement(le,null,e.map(((n,o)=>O.createElement("div",{key:o},t(n,(t=>((t,n)=>{const o=[...e];o[t]=n,r(o)})(o,t)),(()=>(t=>{const n=[...e];n.splice(t,1),r(n)})(o)))))),O.createElement(_.Button,{ref:n,onClick:()=>{const t=[...e,{}];r(t)},variant:"secondary",size:"md",icon:"plus","aria-label":"Add",type:"button"}))})),Ot="=",jt="AND",_t=["=","!=","=~","!=~"].map(v.toOption),Et=["metric.type"],St=({labels:e={},filters:t,onChange:r,variableOptionGroup:n})=>{const o=(e=>(0,h.chunk)(e,4).map((([e,t,r,n="AND"])=>({key:e,operator:t,value:r,condition:n}))))(t),i=o.filter((({key:e})=>!Et.includes(e))),a=o.filter((({key:e})=>Et.includes(e))),u=(0,O.useMemo)((()=>[n,...He(Object.keys(e))]),[e,n]),c=({key:t="",value:r=""})=>{u.some((e=>e.options?u.some((e=>e.label===t)):e.label===t))||u.push({label:t,value:t});const o=e.hasOwnProperty(t)?[n,...e[t].map(v.toOption)]:[n];return o.some((e=>e.label===r))||o.push({label:r,value:r}),{options:u,valueOptions:o}};return(0,m.jsx)(je,{children:(0,m.jsx)(me,{label:"Filter",tooltip:"To reduce the amount of data charted, apply a filter. A filter has three components: a label, a comparison, and a value. The comparison can be an equality, inequality, or regular expression.",children:(0,m.jsx)(bt,{items:i,renderItem:(e,t,r)=>{const{key:n="",operator:o=Ot,value:i="",condition:a=jt}=e,{options:u,valueOptions:l}=c(e);return(0,m.jsxs)(_.Stack,{gap:1,width:"auto",children:[(0,m.jsx)(_.Select,{"aria-label":"Filter label key",formatCreateLabel:e=>`Use label key: ${e}`,allowCustomValue:!0,value:n,options:u,onChange:({value:e=""})=>t({key:e,operator:o,value:i,condition:a})}),(0,m.jsx)(_.Select,{value:o,options:_t,onChange:({value:e=Ot})=>t({key:n,operator:e,value:i,condition:a})}),(0,m.jsx)(_.Select,{"aria-label":"Filter label value",placeholder:"add filter value",formatCreateLabel:e=>`Use label value: ${e}`,allowCustomValue:!0,value:i,options:l,onChange:({value:e=""})=>t({key:n,operator:o,value:e,condition:a})}),(0,m.jsx)(gt,{"aria-label":"Remove",icon:"times",variant:"secondary",onClick:r,type:"button"})]})},onChange:e=>{const t=e.concat(a).map((({key:e,operator:t,value:r,condition:n})=>({key:e||"",operator:t||Ot,value:r||"",condition:n||jt})));r((e=>e.flatMap((({key:e,operator:t,value:r,condition:n})=>[e,t,r,n])).slice(0,-1))(t))}})})})};function Tt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Pt={label:"None",value:de.None},xt=({query:e,metricDescriptor:t,onChange:r})=>{const n=It(t);var o;return(0,m.jsx)(me,{label:"Pre-processing",tooltip:"Preprocessing options are displayed when the selected metric has a metric kind of delta or cumulative. The specific options available are determined by the metric's value type. If you select 'Rate', data points are aligned and converted to a rate per time series. If you select 'Delta', data points are aligned by their delta (difference) per time series",children:(0,m.jsx)(_.RadioButtonGroup,{onChange:n=>{const{perSeriesAligner:o}=e,{valueType:i,metricKind:a}=null!=t?t:{},{perSeriesAligner:u}=Je(i,a,o,n);r(wt(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Tt(e,t,r[t])}))}return e}({},e),{preprocessor:n,perSeriesAligner:u}))},value:null!==(o=e.preprocessor)&&void 0!==o?o:de.None,options:n})})},It=e=>{const t=null==e?void 0:e.metricKind,r=null==e?void 0:e.valueType;return(0,O.useMemo)((()=>{if(!t||t===ye.GAUGE||r===he.DISTRIBUTION)return[Pt];const e=[Pt,{label:"Rate",value:de.Rate,description:"Data points are aligned and converted to a rate per time series"}];return t===ye.CUMULATIVE?[...e,{label:"Delta",value:de.Delta,description:"Data points are aligned by their delta (difference) per time series"}]:e}),[t,r])};function Nt(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function Dt(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Nt(i,n,o,a,u,"next",e)}function u(e){Nt(i,n,o,a,u,"throw",e)}a(void 0)}))}}function Lt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function At(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Lt(e,t,r[t])}))}return e}function Ct(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Rt({refId:e,onChange:t,datasource:r,query:n,variableOptionGroup:o,customMetaData:i,aliasBy:a,onChangeAliasBy:u,range:c}){const[l,s]=(0,O.useState)({}),[p,f]=(0,O.useState)([]),[d,y]=(0,O.useState)(),[v,b]=(0,O.useState)([]),[j,E]=(0,O.useState)([]),[S,T]=(0,O.useState)(""),[w,P]=(0,O.useState)(At({},c));var x;x=c,null===w||w.raw.from.toString()===x.raw.from.toString()&&w.raw.to.toString()===x.raw.to.toString()||P(At({},x));const I=(0,_.useTheme2)(),N=(0,_.getSelectStyles)(I),D=(0,_.useStyles2)(kt),{projectName:L,groupBys:A,crossSeriesReducer:C}=n,R=Xe(n),{templateSrv:k}=r,U=(0,O.useCallback)(((e,t)=>e.find((e=>e.type===k.replace(t)))),[k]);(0,O.useEffect)((()=>{L&&R&&r.getLabels(R,e,L,{groupBys:A,crossSeriesReducer:C},w).then((e=>s(e)))}),[r,A,R,L,e,C,w]),(0,O.useEffect)((()=>{const e=function(){var e=Dt((function*(){if(L){const e=yield r.getMetricTypes(L);(0,g.reportInteraction)("cloud-monitoring-metric-descriptors-loaded",{count:e.length});const t=M(e);f(e),E(t)}}));return function(){return e.apply(this,arguments)}}();e()}),[r,L,D,N.optionDescription]),(0,O.useEffect)((()=>{const e=(e=>{const t=U(e,R);if(!t)return[];return e.filter((e=>e.service===t.service)).map((e=>({service:e.service,value:e.type,label:e.displayName,component:function(){return(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:D,children:e.type}),(0,m.jsx)("div",{className:N.optionDescription,children:e.description})]})}})))})(p),t=e.length>0?e[0].service:"",r=U(p,R);y(r),b(e),T(t)}),[p,U,R,D,N.optionDescription]);const M=e=>{const t=e.map((e=>({value:e.service,label:(0,h.startCase)(e.serviceShortName)})));return t.length>0?(0,h.uniqBy)(t,(e=>e.value)):[]},G=function(){var e=Dt((function*(e){const t=(yield r.filterMetricsByType(L,S)).filter((t=>t.type.includes(e.toLowerCase()))).map((e=>({value:e.type,label:e.displayName,component:function(){return(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:D,children:e.type}),(0,m.jsx)("div",{className:N.optionDescription,children:e.description})]})}})));return[{label:"Template Variables",options:o.options},...t]}));return function(t){return e.apply(this,arguments)}}(),Q=Ge()(G,400),B=({value:e})=>{const o=U(p,e);y(o);const{metricKind:i,valueType:a}=o,u=i===ye.GAUGE||a===he.DISTRIBUTION?de.None:de.Rate,{perSeriesAligner:c}=Je(a,i,n.perSeriesAligner,u);Object.assign(n,Ct(At({},Bt(r)),{crossSeriesReducer:a===he.DISTRIBUTION?"REDUCE_MEAN":"REDUCE_NONE",projectName:n.projectName,filters:n.filters})),t(Ct(At({},et(Ct(At({},n),{perSeriesAligner:c}),e)),{preprocessor:u}))};return(0,m.jsxs)("span",{"data-testid":pe.queryEditor.visualMetricsQueryEditor.container.input,children:[(0,m.jsx)(je,{children:(0,m.jsxs)(Qe,{children:[(0,m.jsx)(Ue,{refId:e,templateVariableOptions:o.options,projectName:L,datasource:r,onChange:e=>{t(Ct(At({},n),{projectName:e}))}}),(0,m.jsx)(me,{label:"Service",width:"auto",children:(0,m.jsx)(_.Select,{width:"auto",onChange:({value:e})=>{const t=p.filter((t=>t.service===k.replace(e))).map((e=>({service:e.service,value:e.type,label:e.displayName,description:e.description})));n.filters=[],t.length>0&&!t.some((e=>e.value===k.replace(R)))?(B(t[0]),T(e),b(t)):(T(e),b(t))},isLoading:0===j.length,value:[...j,...o.options].find((e=>e.value===S)),options:[{label:"Template Variables",options:o.options},...j],placeholder:"Select Services",inputId:`${e}-service`})}),(0,m.jsx)(me,{label:"Metric name",width:"auto",htmlFor:`${e}-select-metric`,children:(0,m.jsx)("span",{title:""===S?"Select a service first":"Type to search metrics",children:(0,m.jsx)(_.AsyncSelect,{width:"auto",onChange:B,value:[...v,...o.options].find((e=>e.value===R)),loadOptions:Q,defaultOptions:[{label:"Template Variables",options:o.options},...v.slice(0,100)],placeholder:"Select Metric",inputId:`${e}-select-metric`,disabled:""===S})})})]})}),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(St,{labels:l,filters:n.filters,onChange:e=>t(Ct(At({},n),{filters:e})),variableOptionGroup:o}),(0,m.jsxs)(je,{children:[(0,m.jsx)(xt,{metricDescriptor:d,query:n,onChange:t}),(0,m.jsx)(vt,{refId:e,labels:Object.keys(l),query:n,onChange:t,variableOptionGroup:o,metricDescriptor:d}),(0,m.jsx)(ut,{refId:e,datasource:r,templateVariableOptions:o.options,query:n,customMetaData:i,onChange:t,metricDescriptor:d,preprocessor:n.preprocessor}),(0,m.jsx)(Oe,{refId:e,value:a,onChange:u})]})]})]})}const kt=e=>(0,b.css)({label:"grafana-select-option-description",fontWeight:"normal",fontStyle:"italic",color:e.colors.text.secondary}),Ut=O.memo(Rt);function Mt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Mt(e,t,r[t])}))}return e}function Qt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Bt=e=>({projectName:e.getDefaultProject(),crossSeriesReducer:"REDUCE_NONE",alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:ve.ALIGN_MEAN,groupBys:[],filters:[]}),qt=e=>({projectName:e.getDefaultProject(),query:""});function Ft({refId:e,query:t,datasource:r,onChange:n,onRunQuery:o,customMetaData:i,variableOptionGroup:a,range:u}){const c=(0,O.useCallback)((e=>{let r=!0;if((null==e?void 0:e.filters)&&e.filters.length>0)for(const t of e.filters)if(""===t){r=!1;break}n(Qt(Gt({},t),{timeSeriesList:e})),r&&o()}),[n,o,t]),l=(0,O.useCallback)((e=>{n(Qt(Gt({},t),{timeSeriesQuery:e})),o()}),[n,o,t]);return(0,O.useEffect)((()=>{t.queryType!==fe.TIME_SERIES_LIST||t.timeSeriesList||n({refId:t.refId,datasource:t.datasource,queryType:fe.TIME_SERIES_LIST,timeSeriesList:Bt(r),aliasBy:t.aliasBy}),t.queryType!==fe.TIME_SERIES_QUERY||t.timeSeriesQuery||n({refId:t.refId,datasource:t.datasource,queryType:fe.TIME_SERIES_QUERY,timeSeriesQuery:qt(r),aliasBy:t.aliasBy})}),[n,t,r]),(0,m.jsxs)(se,{children:[(t.queryType===fe.ANNOTATION||t.queryType===fe.TIME_SERIES_LIST)&&t.timeSeriesList&&(0,m.jsx)(Ut,{refId:e,variableOptionGroup:a,customMetaData:i,onChange:c,datasource:r,query:t.timeSeriesList,aliasBy:t.aliasBy,onChangeAliasBy:e=>n(Qt(Gt({},t),{aliasBy:e})),range:u}),t.queryType===fe.TIME_SERIES_QUERY&&t.timeSeriesQuery&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(_.Stack,{gap:1,direction:"row",children:[(0,m.jsx)(Ue,{refId:e,datasource:r,onChange:e=>l(Qt(Gt({},t.timeSeriesQuery),{projectName:e})),templateVariableOptions:a.options,projectName:t.timeSeriesQuery.projectName}),(0,m.jsx)(Oe,{refId:e,value:t.aliasBy,onChange:e=>n(Qt(Gt({},t),{aliasBy:e}))})]}),(0,m.jsx)(ke,{onChange:e=>l(Qt(Gt({},t.timeSeriesQuery),{query:e})),onRunQuery:o,query:t.timeSeriesQuery.query}),(0,m.jsx)(Re,{onChange:e=>l(Qt(Gt({},t.timeSeriesQuery),{graphPeriod:e})),graphPeriod:t.timeSeriesQuery.graphPeriod,refId:e,variableOptionGroup:a})]})]})}const Vt=O.memo(Ft);function Kt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $t(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Kt(e,t,r[t])}))}return e}function Wt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function zt({refId:e,query:t,datasource:r,onChange:n,variableOptionGroup:o,onRunQuery:i}){function a(e){"Enter"===e.key&&e.shiftKey&&(i(),e.preventDefault(),e.stopPropagation())}var u;return(0,m.jsx)("span",{"data-testid":pe.queryEditor.promQlQueryEditor.container.input,children:(0,m.jsxs)(je,{children:[(0,m.jsx)(Ue,{refId:e,templateVariableOptions:o.options,projectName:t.projectName,datasource:r,onChange:e=>n(Wt($t({},t),{projectName:e}))}),(0,m.jsx)(_.TextArea,{name:"Query",className:"slate-query-field",value:t.expr,rows:10,placeholder:"Enter a Cloud Monitoring Prometheus query (Run with Shift+Enter)",onBlur:i,onKeyDown:a,onChange:e=>n(Wt($t({},t),{expr:e.currentTarget.value}))}),(0,m.jsx)(me,{label:"Min step",tooltip:"Time units and built-in variables can be used here, for example: $__interval, $__rate_interval, 5s, 1m, 3h, 1d, 1y (Default if no unit is specified: 10s)",children:(0,m.jsx)(_.Input,{type:"string",placeholder:"auto",onChange:e=>n(Wt($t({},t),{step:e.currentTarget.value})),onKeyDown:a,value:null!==(u=t.step)&&void 0!==u?u:""})})]})})}const Yt=({children:e})=>{const t=(0,_.useStyles2)(Jt);return O.createElement("div",{className:t.root},e)},Jt=e=>({root:(0,b.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:e.spacing(3),minHeight:e.spacing(4)})});function Ht({label:e,...t}){const[r]=(0,O.useState)((()=>Math.random().toString(16).slice(2))),n=(0,_.useStyles2)(er),o={SelectContainer:Zt,ValueContainer:Xt,SingleValue:Xt};return O.createElement("div",{className:n.root},e&&O.createElement("label",{className:n.label,htmlFor:r},e,":"," "),O.createElement(_.Select,{openMenuOnFocus:!0,inputId:r,...t,components:o}))}const Zt=e=>{const{children:t}=e,r=(0,_.useStyles2)(er);return O.createElement(_.SelectContainer,{...e,className:(0,b.cx)(e.className,r.container)},t)},Xt=e=>{const{className:t,children:r}=e,n=(0,_.useStyles2)(er);return O.createElement("div",{className:(0,b.cx)(t,n.valueContainer)},r)},er=e=>({root:(0,b.css)({display:"flex",fontSize:12,alignItems:"center"}),label:(0,b.css)({color:e.colors.text.secondary,whiteSpace:"nowrap"}),container:(0,b.css)({background:"none",borderColor:"transparent"}),valueContainer:(0,b.css)({display:"flex",alignItems:"center",flex:"initial",color:e.colors.text.secondary,fontSize:12})}),tr=({grow:e,shrink:t})=>O.createElement("div",{style:{display:"block",flexGrow:e,flexShrink:t}});function rr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const or=e=>{const{query:t,onChange:r,onRunQuery:n}=e,{queryType:o}=t;return(0,m.jsxs)(Yt,{children:[(0,m.jsx)(Ht,{label:"Query type",options:De,value:o,onChange:({value:e})=>{r(nr(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){rr(e,t,r[t])}))}return e}({},t),{queryType:e})),n()}}),(0,m.jsx)(tr,{grow:1})]})};function ir(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ar(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ur=({refId:e,current:t,templateVariableOptions:r,onChange:n})=>{const o=Pe.map((e=>ar(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ir(e,t,r[t])}))}return e}({},e),{label:e.text})));t&&!o.find((e=>e.value===t))&&o.push({label:t,text:t,value:t,hidden:!1});const i=o.filter((e=>!e.hidden));return(0,m.jsx)(me,{label:"Lookback period",htmlFor:`${e}-lookback-period`,children:(0,m.jsx)(_.Select,{inputId:`${e}-lookback-period`,width:"auto",allowCustomValue:!0,value:[...o,...r].find((e=>e.value===t)),options:[{label:"Template Variables",options:r},{label:"Predefined periods",expanded:!0,options:i}],onChange:({value:e})=>n(e)})})};function cr(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function lr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const pr=({refId:e,query:t,templateVariableOptions:r,onChange:n,datasource:o})=>{const[i,a]=(0,O.useState)([]),{projectName:u,serviceId:c}=t;return(0,O.useEffect)((()=>{u&&c&&o.getServiceLevelObjectives(u,c).then((e=>{a([{label:"Template Variables",options:r},...e])}))}),[o,u,c,r]),(0,m.jsx)(me,{label:"SLO",children:(0,m.jsx)(_.Select,{inputId:`${e}-slo`,width:"auto",allowCustomValue:!0,value:(null==t?void 0:t.sloId)&&{value:null==t?void 0:t.sloId,label:(null==t?void 0:t.sloName)||(null==t?void 0:t.sloId)},placeholder:"Select SLO",options:i,onChange:function(){var e,r=(e=function*({value:e="",label:r=""}){const i=(yield o.getServiceLevelObjectives(u,c)).find((({value:t})=>t===o.templateSrv.replace(e)));n(sr(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){lr(e,t,r[t])}))}return e}({},t),{sloId:e,sloName:r,goal:null==i?void 0:i.goal}))},function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){cr(i,n,o,a,u,"next",e)}function u(e){cr(i,n,o,a,u,"throw",e)}a(void 0)}))});return function(e){return r.apply(this,arguments)}}()})})};function fr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const yr=({refId:e,query:t,templateVariableOptions:r,onChange:n,datasource:o})=>(0,m.jsx)(me,{label:"Selector",htmlFor:`${e}-slo-selector`,children:(0,m.jsx)(_.Select,{inputId:`${e}-slo-selector`,width:"auto",allowCustomValue:!0,value:[...Ne,...r].find((e=>e.value===(null==t?void 0:t.selectorName))),options:[{label:"Template Variables",options:r},...Ne],onChange:({value:e})=>n(dr(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){fr(e,t,r[t])}))}return e}({},t),{selectorName:null!=e?e:""}))})});function hr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const gr=({refId:e,query:t,templateVariableOptions:r,onChange:n,datasource:o})=>{const[i,a]=(0,O.useState)([]),{projectName:u}=t;return(0,O.useEffect)((()=>{u&&o.getSLOServices(u).then((e=>{a([{label:"Template Variables",options:r},...e])}))}),[o,u,r]),(0,m.jsx)(me,{label:"Service",children:(0,m.jsx)(_.Select,{inputId:`${e}-slo-service`,width:"auto",allowCustomValue:!0,value:(null==t?void 0:t.serviceId)&&{value:null==t?void 0:t.serviceId,label:(null==t?void 0:t.serviceName)||(null==t?void 0:t.serviceId)},placeholder:"Select service",options:i,onChange:({value:e="",label:r=""})=>n(vr(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){hr(e,t,r[t])}))}return e}({},t),{serviceId:e,serviceName:r,sloId:""}))})})};function mr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function br(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){mr(e,t,r[t])}))}return e}function Or(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function jr({refId:e,query:t,datasource:r,onChange:n,variableOptionGroup:o,customMetaData:i,aliasBy:a,onChangeAliasBy:u}){const c=(0,O.useMemo)((()=>Ze(i,r)),[i,r]);return(0,m.jsx)("span",{"data-testid":pe.queryEditor.sloQueryEditor.container.input,children:(0,m.jsxs)(je,{children:[(0,m.jsx)(Ue,{refId:e,templateVariableOptions:o.options,projectName:t.projectName,datasource:r,onChange:e=>n(Or(br({},t),{projectName:e}))}),(0,m.jsx)(gr,{refId:e,datasource:r,templateVariableOptions:o.options,query:t,onChange:n}),(0,m.jsx)(pr,{refId:e,datasource:r,templateVariableOptions:o.options,query:t,onChange:n}),(0,m.jsx)(yr,{refId:e,datasource:r,templateVariableOptions:o.options,query:t,onChange:n}),t.selectorName===Ie&&(0,m.jsx)(ur,{refId:e,onChange:e=>n(Or(br({},t),{lookbackPeriod:e})),current:t.lookbackPeriod,templateVariableOptions:o.options}),(0,m.jsx)(Qe,{children:(0,m.jsx)(me,{label:"Alignment period",tooltip:c,children:(0,m.jsx)(Ce,{inputId:`${e}-alignment-period`,templateVariableOptions:o.options,current:t.alignmentPeriod,onChange:e=>n(Or(br({},t),{alignmentPeriod:e})),aligmentPeriods:Te})})}),(0,m.jsx)(Oe,{refId:e,value:a,onChange:u})]})})}function _r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Er(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_r(e,t,r[t])}))}return e}function Sr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Tr=({label:e,onChange:t,value:r,options:n,allowCustomValue:o=!1})=>(0,m.jsx)(_.Field,{label:e,children:(0,m.jsx)(_.Select,{width:25,allowCustomValue:o,value:r,onChange:({value:e})=>t(e),options:n})});function wr(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function Pr(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){wr(i,n,o,a,u,"next",e)}function u(e){wr(i,n,o,a,u,"throw",e)}a(void 0)}))}}function xr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ir(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){xr(e,t,r[t])}))}return e}function Nr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Dr(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}class Lr extends O.PureComponent{componentDidMount(){var e=this;return Pr((function*(){yield e.props.datasource.ensureGCEDefaultProject();const t=e.props.query.projectName||e.props.datasource.getDefaultProject(),r=yield e.props.datasource.getProjects(),n=yield e.props.datasource.getMetricTypes(e.props.query.projectName||e.props.datasource.getDefaultProject()),o=Ve(n).map((e=>({value:e.service,label:e.serviceShortName})));let i="";o.some((t=>t.value===(0,g.getTemplateSrv)().replace(e.state.selectedService)))?i=e.state.selectedService:o&&o.length>0&&(i=o[0].value);const{metricTypes:a,selectedMetricType:u}=$e(n,e.state.selectedMetricType,(0,g.getTemplateSrv)().replace(e.state.selectedMetricType),(0,g.getTemplateSrv)().replace(i)),c=yield e.props.datasource.getSLOServices(t),l=Nr(Ir({services:o,selectedService:i,metricTypes:a,selectedMetricType:u,metricDescriptors:n,projects:r},yield e.getLabels(u,t)),{sloServices:c,loading:!1,projectName:t});e.setState(l,(()=>e.onPropsChange()))}))()}onQueryTypeChange(e){var t=this;return Pr((function*(){const r=Ir({selectedQueryType:e},yield t.getLabels(t.state.selectedMetricType,t.state.projectName,e));t.setState(r)}))()}onProjectChange(e){var t=this;return Pr((function*(){const r=yield t.props.datasource.getMetricTypes(e),n=yield t.getLabels(t.state.selectedMetricType,e),{metricTypes:o,selectedMetricType:i}=$e(r,t.state.selectedMetricType,(0,g.getTemplateSrv)().replace(t.state.selectedMetricType),(0,g.getTemplateSrv)().replace(t.state.selectedService)),a=yield t.props.datasource.getSLOServices(e);t.setState(Nr(Ir({},n),{metricTypes:o,selectedMetricType:i,metricDescriptors:r,projectName:e,sloServices:a}),(()=>t.onPropsChange()))}))()}onServiceChange(e){var t=this;return Pr((function*(){const{metricTypes:r,selectedMetricType:n}=$e(t.state.metricDescriptors,t.state.selectedMetricType,(0,g.getTemplateSrv)().replace(t.state.selectedMetricType),(0,g.getTemplateSrv)().replace(e)),o=Ir({selectedService:e,metricTypes:r,selectedMetricType:n},yield t.getLabels(n,t.state.projectName));t.setState(o,(()=>t.onPropsChange()))}))()}onMetricTypeChange(e){var t=this;return Pr((function*(){const r=Ir({selectedMetricType:e},yield t.getLabels((0,g.getTemplateSrv)().replace(e),t.state.projectName));t.setState(r,(()=>t.onPropsChange()))}))()}onLabelKeyChange(e){this.setState({labelKey:e},(()=>this.onPropsChange()))}componentDidUpdate(e,t){const r=t.selectedQueryType!==this.state.selectedQueryType,n=this.state.selectedSLOService!==t.selectedSLOService;(r||n)&&this.onPropsChange()}getLabels(e,t,r=this.state.selectedQueryType){var n=this;return Pr((function*(){let o={labels:n.state.labels,labelKey:n.state.labelKey};if(e&&r===ge.LabelValues){const r=yield Ye(n.props.datasource,e,t),i=r.some((e=>e===(0,g.getTemplateSrv)().replace(n.state.labelKey)))?n.state.labelKey:r[0];o={labels:r,labelKey:i}}return o}))()}renderQueryTypeSwitch(e){const t={label:"Template Variables",expanded:!1,options:(0,g.getTemplateSrv)().getVariables().map((e=>({value:`$${e.name}`,label:`$${e.name}`})))};switch(e){case ge.MetricTypes:return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Tr,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"}),(0,m.jsx)(Tr,{value:this.state.selectedService,options:[t,...this.state.services],onChange:e=>this.onServiceChange(e),label:"Service"})]});case ge.LabelKeys:case ge.LabelValues:case ge.ResourceTypes:return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Tr,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"}),(0,m.jsx)(Tr,{value:this.state.selectedService,options:[t,...this.state.services],onChange:e=>this.onServiceChange(e),label:"Service"}),(0,m.jsx)(Tr,{value:this.state.selectedMetricType,options:[t,...this.state.metricTypes.map((({value:e,name:t})=>({value:e,label:t})))],onChange:e=>this.onMetricTypeChange(e),label:"Metric Type"}),e===ge.LabelValues&&(0,m.jsx)(Tr,{value:this.state.labelKey,options:[t,...this.state.labels.map((e=>({value:e,label:e})))],onChange:e=>this.onLabelKeyChange(e),label:"Label Key"})]});case ge.Aligners:case ge.Aggregations:return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Tr,{value:this.state.selectedService,options:[t,...this.state.services],onChange:e=>this.onServiceChange(e),label:"Service"}),(0,m.jsx)(Tr,{value:this.state.selectedMetricType,options:[t,...this.state.metricTypes.map((({value:e,name:t})=>({value:e,label:t})))],onChange:e=>this.onMetricTypeChange(e),label:"Metric Type"})]});case ge.Services:case ge.SLOServices:return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(Tr,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"})});case ge.SLO:return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Tr,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"}),(0,m.jsx)(Tr,{value:this.state.selectedSLOService,options:[t,...this.state.sloServices],onChange:e=>{this.setState(Nr(Ir({},this.state),{selectedSLOService:e}))},label:"SLO Service"})]});default:return""}}render(){return this.state.loading?(0,m.jsx)(Tr,{value:"loading",options:[{value:"loading",label:"Loading..."}],onChange:e=>null,label:"Query Type"}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Tr,{value:this.state.selectedQueryType,options:this.queryTypes,onChange:e=>this.onQueryTypeChange(e),label:"Query Type"}),this.renderQueryTypeSwitch(this.state.selectedQueryType)]})}constructor(e){super(e),xr(this,"queryTypes",[{value:ge.Projects,label:"Projects"},{value:ge.Services,label:"Services"},{value:ge.MetricTypes,label:"Metric Types"},{value:ge.LabelKeys,label:"Label Keys"},{value:ge.LabelValues,label:"Label Values"},{value:ge.ResourceTypes,label:"Resource Types"},{value:ge.Aggregations,label:"Aggregations"},{value:ge.Aligners,label:"Aligners"},{value:ge.AlignmentPeriods,label:"Alignment Periods"},{value:ge.Selectors,label:"Selectors"},{value:ge.SLOServices,label:"SLO Services"},{value:ge.SLO,label:"Service Level Objectives (SLO)"}]),xr(this,"defaults",{selectedQueryType:this.queryTypes[0].value,metricDescriptors:[],selectedService:"",selectedMetricType:"",labels:[],labelKey:"",metricTypes:[],services:[],sloServices:[],selectedSLOService:"",projects:[],projectName:"",loading:!0}),xr(this,"onPropsChange",(()=>{const e=this.state,{metricDescriptors:t,labels:r,metricTypes:n,services:o}=e,i=Dr(e,["metricDescriptors","labels","metricTypes","services"]);this.props.onChange(Nr(Ir({},i),{refId:"CloudMonitoringVariableQueryEditor-VariableQuery"}))})),this.state=Object.assign(this.defaults,this.props.query)}}var Ar=p(269),Cr=p(59);function Rr(e,t,r){void 0===t&&(t=0),void 0===r&&(r=[]);var n=function(e,t){void 0===t&&(t=0);var r=(0,O.useRef)(!1),n=(0,O.useRef)(),o=(0,O.useRef)(e),i=(0,O.useCallback)((function(){return r.current}),[]),a=(0,O.useCallback)((function(){r.current=!1,n.current&&clearTimeout(n.current),n.current=setTimeout((function(){r.current=!0,o.current()}),t)}),[t]),u=(0,O.useCallback)((function(){r.current=null,n.current&&clearTimeout(n.current)}),[]);return(0,O.useEffect)((function(){o.current=e}),[e]),(0,O.useEffect)((function(){return a(),u}),[t]),[i,u,a]}(e,t),o=n[0],i=n[1],a=n[2];return(0,O.useEffect)(a,r),[o,i]}const kr=()=>(0,m.jsx)(_.Alert,{severity:"info",title:"Annotation Query Format",children:(0,m.jsxs)("div",{children:[(0,m.jsxs)("p",{children:["An annotation is an event that is overlaid on top of graphs. Annotation rendering is expensive so it is important to limit the number of rows returned."," "]}),(0,m.jsx)("p",{children:"The Title and Text fields support templating and can use data returned from the query. For example, the Title field could have the following text:"}),(0,m.jsxs)("code",{children:["{{metric.type}}"," has value: ","{{metric.value}}"]}),(0,m.jsxs)("p",{children:["Example Result: ",(0,m.jsx)("code",{children:"monitoring.googleapis.com/uptime_check/http_status has this value: 502"})]}),(0,m.jsx)("span",{children:"Patterns:"}),(0,m.jsxs)("p",{children:[(0,m.jsx)("code",{children:"{{metric.value}}"})," = value of the metric/point"]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("code",{children:"{{metric.type}}"})," = metric type e.g. compute.googleapis.com/instance/cpu/usage_time"]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("code",{children:"{{metric.name}}"})," = name part of metric e.g. instance/cpu/usage_time"]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("code",{children:"{{metric.service}}"})," = service part of metric e.g. compute"]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("code",{children:"{{metric.label.label_name}}"})," = Metric label metadata e.g. metric.label.instance_name"]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("code",{children:"{{resource.label.label_name}}"})," = Resource label metadata e.g. resource.label.zone"]})]})});function Ur(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Ur(e,t,r[t])}))}return e}function Gr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Qr=e=>{const{datasource:t,query:r,onRunQuery:n,data:o,onChange:i,range:a}=e,u=(null==o?void 0:o.series.length)?null==o?void 0:o.series[0].meta:{};var c;const l=null!==(c=null==u?void 0:u.custom)&&void 0!==c?c:{},s=Mr({},(e=>Gr(Mr({},Bt(e)),{title:"",text:""}))(t),r.timeSeriesList),[p,f]=(0,O.useState)(s.title||""),[d,y]=(0,O.useState)(s.text||""),h={label:"Template Variables",options:t.getVariables().map(v.toOption)};return Rr((()=>{i(Gr(Mr({},r),{timeSeriesList:Gr(Mr({},s),{title:p})}))}),1e3,[p,i]),Rr((()=>{i(Gr(Mr({},r),{timeSeriesList:Gr(Mr({},s),{text:d})}))}),1e3,[d,i]),(0,O.useEffect)((()=>{r.queryType&&Object.values(fe).includes(r.queryType)||i(Gr(Mr({},r),{queryType:fe.TIME_SERIES_LIST}))})),(0,m.jsxs)(se,{children:[(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Vt,{refId:r.refId,variableOptionGroup:h,customMetaData:l,onChange:i,onRunQuery:n,datasource:t,query:r,range:a||(0,v.getDefaultTimeRange)()}),(0,m.jsx)(me,{label:"Title",htmlFor:"annotation-query-title",children:(0,m.jsx)(_.Input,{id:"annotation-query-title",value:p,onChange:e=>{f(e.target.value)}})}),(0,m.jsx)(me,{label:"Text",htmlFor:"annotation-query-text",children:(0,m.jsx)(_.Input,{id:"annotation-query-text",value:d,onChange:e=>{y(e.target.value)}})})]}),(0,m.jsx)(kr,{})]})};function Br(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Fr=e=>({prepareAnnotation:t=>{if(!(e=>{var t,r;return void 0!==(null===(t=e.target)||void 0===t?void 0:t.title)||void 0!==(null===(r=e.target)||void 0===r?void 0:r.text)})(t))return t;const{enable:r,name:n,iconColor:o}=t,{target:i}=t;return{datasource:t.datasource,enable:r,name:n,iconColor:o,target:{intervalMs:e.intervalMs,refId:(null==i?void 0:i.refId)||"annotationQuery",queryType:fe.ANNOTATION,timeSeriesList:{projectName:(null==i?void 0:i.projectName)||e.getDefaultProject(),filters:(null==i?void 0:i.filters)||[],crossSeriesReducer:"REDUCE_NONE",perSeriesAligner:ve.ALIGN_NONE,title:(null==i?void 0:i.title)||"",text:(null==i?void 0:i.text)||""}}}},prepareQuery:e=>{if(e.target)return qr(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Br(e,t,r[t])}))}return e}({},e.target),{queryType:fe.ANNOTATION,type:"annotationQuery"})},QueryEditor:Qr});function Vr(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function Kr(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Vr(i,n,o,a,u,"next",e)}function u(e){Vr(i,n,o,a,u,"throw",e)}a(void 0)}))}}function $r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Wr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class zr{execute(e){var t=this;return Kr((function*(){try{switch(e.projectName||(e.projectName=t.datasource.getDefaultProject()),e.selectedQueryType){case ge.Projects:return t.handleProjectsQuery();case ge.Services:return t.handleServiceQuery(e);case ge.MetricTypes:return t.handleMetricTypesQuery(e);case ge.LabelKeys:return t.handleLabelKeysQuery(e);case ge.LabelValues:return t.handleLabelValuesQuery(e);case ge.ResourceTypes:return t.handleResourceTypeQuery(e);case ge.Aligners:return t.handleAlignersQuery(e);case ge.AlignmentPeriods:return t.handleAlignmentPeriodQuery();case ge.Aggregations:return t.handleAggregationQuery(e);case ge.SLOServices:return t.handleSLOServicesQuery(e);case ge.SLO:return t.handleSLOQuery(e);case ge.Selectors:return t.handleSelectorQuery();default:return[]}}catch(t){return console.error(`Could not run CloudMonitoringMetricFindQuery ${e}`,t),[]}}))()}handleProjectsQuery(){var e=this;return Kr((function*(){return(yield e.datasource.getProjects()).map((e=>({text:e.label,value:e.value,expandable:!0})))}))()}handleServiceQuery({projectName:e}){var t=this;return Kr((function*(){const r=yield t.datasource.getMetricTypes(e);return Ve(r).map((e=>({text:e.serviceShortName,value:e.service,expandable:!0})))}))()}handleMetricTypesQuery({selectedService:e,projectName:t}){var r=this;return Kr((function*(){if(!e)return[];const n=yield r.datasource.getMetricTypes(t);return Ke(n,r.datasource.templateSrv.replace(e)).map((e=>({text:e.displayName,value:e.type,expandable:!0})))}))()}handleLabelKeysQuery({selectedMetricType:e,projectName:t}){var r=this;return Kr((function*(){if(!e)return[];return(yield Ye(r.datasource,e,t)).map(r.toFindQueryResult)}))()}handleLabelValuesQuery({selectedMetricType:e,labelKey:t,projectName:r}){var n=this;return Kr((function*(){if(!e)return[];const o=yield n.datasource.getLabels(e,"handleLabelValuesQuery",r,{groupBys:[t],crossSeriesReducer:"REDUCE_MEAN"}),i=n.datasource.templateSrv.replace(t);return(o.hasOwnProperty(i)?o[i]:[]).map(n.toFindQueryResult)}))()}handleResourceTypeQuery({selectedMetricType:e,projectName:t}){var r=this;return Kr((function*(){var n;if(!e)return[];var o;return null!==(o=null===(n=(yield r.datasource.getLabels(e,"handleResourceTypeQueryQueryType",t))["resource.type"])||void 0===n?void 0:n.map(r.toFindQueryResult))&&void 0!==o?o:[]}))()}handleAlignersQuery({selectedMetricType:e,projectName:t}){var r=this;return Kr((function*(){if(!e)return[];const n=(yield r.datasource.getMetricTypes(t)).find((t=>t.type===r.datasource.templateSrv.replace(e)));return n?We(n.valueType,n.metricKind).map(r.toFindQueryResult):[]}))()}handleAggregationQuery({selectedMetricType:e,projectName:t}){var r=this;return Kr((function*(){if(!e)return[];const n=(yield r.datasource.getMetricTypes(t)).find((t=>t.type===r.datasource.templateSrv.replace(e)));return n?ze(n.valueType,n.metricKind).map(r.toFindQueryResult):[]}))()}handleSLOServicesQuery({projectName:e}){var t=this;return Kr((function*(){return(yield t.datasource.getSLOServices(e)).map(t.toFindQueryResult)}))()}handleSLOQuery({selectedSLOService:e,projectName:t}){var r=this;return Kr((function*(){return(yield r.datasource.getServiceLevelObjectives(t,e)).map(r.toFindQueryResult)}))()}handleSelectorQuery(){var e=this;return Kr((function*(){return Ne.map(e.toFindQueryResult)}))()}handleAlignmentPeriodQuery(){return Te.map(this.toFindQueryResult)}toFindQueryResult(e){return(0,h.isString)(e)?{text:e,expandable:!0}:Wr(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){$r(e,t,r[t])}))}return e}({},e),{expandable:!0})}constructor(e){$r(this,"datasource",void 0),this.datasource=e}}function Yr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Jr extends v.CustomVariableSupport{query(e){const t=(0,Ar.from)(this.metricFindQuery.execute(e.targets[0]));return(0,Ar.from)(this.datasource.ensureGCEDefaultProject()).pipe((0,Cr.mergeMap)((()=>t)),(0,Cr.map)((e=>({data:e}))))}constructor(e){super(),Yr(this,"datasource",void 0),Yr(this,"metricFindQuery",void 0),Yr(this,"editor",void 0),this.datasource=e,this.editor=Lr,this.metricFindQuery=new zr(e)}}function Hr(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function Zr(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Hr(i,n,o,a,u,"next",e)}function u(e){Hr(i,n,o,a,u,"throw",e)}a(void 0)}))}}function Xr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function en(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Xr(e,t,r[t])}))}return e}function tn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function rn(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}class nn extends g.DataSourceWithBackend{getVariables(){return this.templateSrv.getVariables().map((e=>`$${e.name}`))}query(e){return e.targets=e.targets.map((t=>tn(en({},this.migrateQuery(t)),{intervalMs:e.intervalMs}))),super.query(e)}applyTemplateVariables(e,t){const{timeSeriesList:r,timeSeriesQuery:n,sloQuery:o,promQLQuery:i}=e;return tn(en({},e),{datasource:this.getRef(),intervalMs:this.intervalMs,timeSeriesList:r&&tn(en({},this.interpolateProps(r,t)),{projectName:this.templateSrv.replace(r.projectName?r.projectName:this.getDefaultProject(),t),filters:this.interpolateFilters(r.filters||[],t),groupBys:this.interpolateGroupBys(r.groupBys||[],t),view:r.view||"FULL"}),timeSeriesQuery:n&&tn(en({},this.interpolateProps(n,t)),{projectName:this.templateSrv.replace(n.projectName?n.projectName:this.getDefaultProject(),t)}),sloQuery:o&&this.interpolateProps(o,t),promQLQuery:i&&this.interpolateProps(i,t,{expr:this.interpolatePromQLQuery})})}getLabels(e,t,r,n,o){var i=this;return Zr((function*(){const a={targets:[{refId:t,datasource:i.getRef(),queryType:fe.TIME_SERIES_LIST,timeSeriesList:et({projectName:i.templateSrv.replace(r),groupBys:i.interpolateGroupBys((null==n?void 0:n.groupBys)||[],{}),crossSeriesReducer:"REDUCE_NONE",view:"HEADERS"},i.templateSrv.replace(e))}],range:o||(0,v.getDefaultTimeRange)()},u=a.targets;return u.length?(0,Ar.lastValueFrom)((0,Ar.from)(i.ensureGCEDefaultProject()).pipe((0,Cr.mergeMap)((()=>i.backendSrv.fetch({url:"/api/ds/query",method:"POST",headers:i.getRequestHeaders(),data:{from:a.range.from.valueOf().toString(),to:a.range.to.valueOf().toString(),queries:u}}))),(0,Cr.map)((({data:e})=>{const t=(0,g.toDataQueryResponse)({data:e}),r=null==t?void 0:t.data.map((e=>{var t,r;return null===(r=e.meta)||void 0===r||null===(t=r.custom)||void 0===t?void 0:t.labels})).filter((e=>!!e)).reduce(((e,t)=>{for(let r in t)e[r]||(e[r]=new Set),t[r]&&e[r].add(t[r]);return e}),{});return Object.fromEntries(Object.entries(r).map((([e,t])=>[e,Array.from(t)])))})))):(0,Ar.lastValueFrom)((0,Ar.of)({results:[]}))}))()}getGCEDefaultProject(){var e=this;return Zr((function*(){return e.getResource("gceDefaultProject")}))()}getDefaultProject(){const{defaultProject:e,authenticationType:t,gceDefaultProject:r}=this.instanceSettings.jsonData;return"gce"===t?r||"":e||""}ensureGCEDefaultProject(){var e=this;return Zr((function*(){const{authenticationType:t,gceDefaultProject:r}=e.instanceSettings.jsonData;"gce"!==t||r||(e.instanceSettings.jsonData.gceDefaultProject=yield e.getGCEDefaultProject())}))()}getMetricTypes(e){var t=this;return Zr((function*(){return e?t.getResource(`metricDescriptors/v3/projects/${t.templateSrv.replace(e)}/metricDescriptors`):[]}))()}filterMetricsByType(e,t){var r=this;return Zr((function*(){return e?r.getResource(`metricDescriptors/v3/projects/${r.templateSrv.replace(e)}/metricDescriptors`,{filter:`metric.type : "${t}"`}):[]}))()}getSLOServices(e){var t=this;return Zr((function*(){return t.getResource(`services/v3/projects/${t.templateSrv.replace(e)}/services?pageSize=1000`)}))()}getServiceLevelObjectives(e,t){var r=this;return Zr((function*(){if(!t)return Promise.resolve([]);let{projectName:n,serviceId:o}=r.interpolateProps({projectName:e,serviceId:t});return r.getResource(`slo-services/v3/projects/${n}/services/${o}/serviceLevelObjectives`)}))()}getProjects(){return this.getResource("projects")}migrateMetricTypeFilter(e,t){const r=["metric.type","=",e];return(null==t?void 0:t.length)?t.concat("AND",r):r}migrateQuery(e){const{hide:t,refId:r,datasource:n,key:o,queryType:i,maxLines:a,metric:u,intervalMs:c,type:l}=e,s=rn(e,["hide","refId","datasource","key","queryType","maxLines","metric","intervalMs","type"]);if(!(e.hasOwnProperty("metricQuery")||e.hasOwnProperty("sloQuery")||e.hasOwnProperty("timeSeriesQuery")||e.hasOwnProperty("timeSeriesList"))){let i=s.filters||[];return s.metricType&&(i=this.migrateMetricTypeFilter(s.metricType,i)),{datasource:n,key:o,refId:r,intervalMs:c,hide:t,queryType:"annotationQuery"===l?fe.ANNOTATION:fe.TIME_SERIES_LIST,timeSeriesList:tn(en({},s),{projectName:(0,h.get)(e,"projectName")||this.getDefaultProject(),filters:i,view:s.view||"FULL"})}}var p;if((0,h.has)(e,"metricQuery")&&["metrics",fe.ANNOTATION].includes(null!==(p=e.queryType)&&void 0!==p?p:"")){const t=(0,h.get)(e,"metricQuery");"mql"===t.editorMode?(e.timeSeriesQuery={projectName:t.projectName,query:t.query,graphPeriod:t.graphPeriod},e.queryType=fe.TIME_SERIES_QUERY):(e.timeSeriesList={projectName:t.projectName||this.getDefaultProject(),crossSeriesReducer:t.crossSeriesReducer,alignmentPeriod:t.alignmentPeriod,perSeriesAligner:t.perSeriesAligner,groupBys:t.groupBys,filters:t.filters,view:t.view,preprocessor:t.preprocessor},e.queryType=fe.TIME_SERIES_LIST,t.metricType&&(e.timeSeriesList.filters=this.migrateMetricTypeFilter(t.metricType,e.timeSeriesList.filters))),e.aliasBy=t.aliasBy,e=(0,h.omit)(e,"metricQuery")}if(e.queryType===fe.SLO&&(0,h.has)(e,"sloQuery.aliasBy")){const t=(0,h.get)(e,"sloQuery.aliasBy");"string"==typeof t&&(e.aliasBy=t),e=(0,h.omit)(e,"sloQuery.aliasBy")}return e}interpolatePromQLQuery(e,t){return(0,h.isArray)(e)?e.join("|"):e}interpolateProps(e,t={},r){return Object.entries(e).reduce(((e,[n,o])=>{let i=o;return o&&(0,h.isString)(o)&&(i=this.templateSrv.replace(o,t,r&&r[n])),tn(en({},e),{[n]:i})}),{})}filterQuery(e){if(e.hide)return!1;const t=this.migrateQuery(e);if(t.queryType===fe.SLO){if(!t.sloQuery)return!1;const{selectorName:e,serviceId:r,sloId:n,projectName:o,lookbackPeriod:i}=t.sloQuery;return!(!e||!r||!n||!o||e===Ie&&!i)}return t.queryType===fe.TIME_SERIES_QUERY?!!t.timeSeriesQuery&&!!t.timeSeriesQuery.projectName&&!!t.timeSeriesQuery.query:t.queryType&&[fe.TIME_SERIES_LIST,fe.ANNOTATION].includes(t.queryType)?!!t.timeSeriesList&&!!t.timeSeriesList.projectName&&!!Xe(t.timeSeriesList):t.queryType===fe.PROMQL&&!!(t.promQLQuery&&t.promQLQuery.projectName&&t.promQLQuery.expr&&t.promQLQuery.step)}interpolateVariablesInQueries(e,t){return e.map((e=>this.applyTemplateVariables(this.migrateQuery(e),t)))}interpolateFilters(e,t){const r=(0,h.chunk)(e,4).map((([e,t,r,n])=>en({key:e,operator:t,value:r},n&&{condition:n}))).filter((e=>e.value));return(0,h.flatten)(r.map((({key:e,operator:r,value:n,condition:o})=>[this.templateSrv.replace(e,t||{}),r,this.templateSrv.replace(n,t||{},(e=>(0,h.isArray)(e)&&e.length?`(${e.join("|")})`:e)),...o?[o]:[]])))||[]}interpolateGroupBys(e,t){let r=[];return(e||[]).forEach((e=>{const n=this.templateSrv.replace(e,t||{},"csv").split(",");Array.isArray(n)?r=r.concat(n):r.push(n)})),r}constructor(e,t=(0,g.getTemplateSrv)()){super(e),Xr(this,"instanceSettings",void 0),Xr(this,"templateSrv",void 0),Xr(this,"authenticationType",void 0),Xr(this,"intervalMs",void 0),Xr(this,"backendSrv",void 0),this.instanceSettings=e,this.templateSrv=t,this.authenticationType=e.jsonData.authenticationType||"jwt",this.variables=new Jr(this),this.intervalMs=0,this.annotations=Fr(this),this.backendSrv=(0,g.getBackendSrv)()}}const on="stackdriver",an=new v.DataSourcePlugin(nn).setQueryEditorHelp(j).setQueryEditor((e=>{var t,r;const{datasource:n,query:o,onRunQuery:i,onChange:a,range:u}=e,[c,l]=(0,O.useState)(!1);(0,O.useEffect)((()=>{const e=n.migrateQuery(o);ce()(e,o)||a(Er({},e))}),[o,n,a]);const[s,p]=(0,O.useState)(o),[f,d]=(0,O.useState)(!1),y=Er({},{projectName:n.getDefaultProject(),alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:ve.ALIGN_MEAN,aliasBy:"",selectorName:"select_slo_health",serviceId:"",serviceName:"",sloId:"",sloName:"",lookbackPeriod:""},o.sloQuery);const g=Er({},{projectName:n.getDefaultProject(),expr:"",step:"10s"},o.promQLQuery),b=(null===(t=e.data)||void 0===t?void 0:t.series.length)?null===(r=e.data)||void 0===r?void 0:r.series[0].meta:{};var j;const E=null!==(j=null==b?void 0:b.custom)&&void 0!==j?j:{},S={label:"Template Variables",expanded:!1,options:n.getVariables().map(v.toOption)};(0,O.useEffect)((()=>{o.queryType&&Object.values(fe).includes(o.queryType)||a(Sr(Er({},o),{queryType:fe.TIME_SERIES_LIST}))}));const T=o.queryType;return(0,m.jsx)("span",{"data-testid":pe.queryEditor.container,children:(0,m.jsxs)(se,{children:[(0,m.jsx)(_.ConfirmModal,{"data-testid":"switch-query-type-modal",title:"Warning",body:"By switching your query type, your current query will be lost.",isOpen:c,onConfirm:()=>{l(!1),a(s),d(!1)},confirmText:"Confirm",onDismiss:()=>{l(!1),p(o)}}),(0,m.jsx)(or,{query:o,onChange:e=>{!f||s.queryType!==fe.TIME_SERIES_LIST&&s.queryType!==fe.TIME_SERIES_QUERY?a(e):s.queryType!==e.queryType&&l(!0),p(e)},onRunQuery:i}),T===fe.PROMQL&&(0,m.jsx)(zt,{refId:o.refId,variableOptionGroup:S,onChange:e=>{a(Sr(Er({},o),{promQLQuery:e}))},onRunQuery:i,datasource:n,query:g}),T!==fe.SLO&&(0,m.jsx)(Vt,{refId:o.refId,variableOptionGroup:S,customMetaData:E,onChange:e=>{(e.queryType===fe.TIME_SERIES_LIST&&!(0,h.isEqual)(e.timeSeriesList,Bt(n))||e.queryType===fe.TIME_SERIES_QUERY&&!(0,h.isEqual)(e.timeSeriesQuery,qt(n)))&&d(!0),a(e)},onRunQuery:i,datasource:n,query:o,range:u||(0,v.getDefaultTimeRange)()}),T===fe.SLO&&(0,m.jsx)(jr,{refId:o.refId,variableOptionGroup:S,customMetaData:E,onChange:e=>{a(Sr(Er({},o),{sloQuery:e})),i()},onRunQuery:i,datasource:n,query:y,aliasBy:o.aliasBy,onChangeAliasBy:e=>a(Sr(Er({},o),{aliasBy:e}))})]})})})).setConfigEditor(ae).setVariableQueryEditor(Lr);return(0,g.getAppEvents)().subscribe(v.DashboardLoadedEvent,(({payload:{dashboardId:e,orgId:t,grafanaVersion:r,queries:n}})=>{const o=n[on];let i={[fe.TIME_SERIES_QUERY]:0,[fe.TIME_SERIES_LIST]:0,[fe.SLO]:0,[fe.ANNOTATION]:0,[fe.PROMQL]:0};var a;o.forEach((e=>{e.queryType===fe.TIME_SERIES_QUERY||e.queryType===fe.TIME_SERIES_LIST||e.queryType===fe.SLO||e.queryType===fe.ANNOTATION||e.queryType===fe.PROMQL?i[e.queryType]++:"metrics"===e.queryType&&(e.hasOwnProperty("type")&&"annotationQuery"===(0,h.get)(e,"type")&&i.annotation++,"mql"===(0,h.get)(e,"metricQuery.editorMode")?i.timeSeriesQuery++:i.timeSeriesList++)})),o&&o.length>0&&(a={grafana_version:r,dashboard_id:e,org_id:t,mql_queries:i[fe.TIME_SERIES_QUERY],time_series_filter_queries:i[fe.TIME_SERIES_LIST],slo_queries:i[fe.SLO],annotation_queries:i[fe.ANNOTATION],promQL_queries:i[fe.PROMQL]},(0,g.reportInteraction)("grafana_ds_cloudmonitoring_dashboard_loaded",a))})),f})()));
//# sourceMappingURL=module.js.map