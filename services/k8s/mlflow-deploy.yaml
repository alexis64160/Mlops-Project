apiVersion: apps/v1
kind: Deployment
metadata:
  name: mlflow
  namespace: mlops
spec:
  replicas: 1
  selector: { matchLabels: { app: mlflow } }
  template:
    metadata: { labels: { app: mlflow } }
    spec:
      containers:
        - name: mlflow
          image: YOUR_REGISTRY/mlflow:latest
          ports: [{ containerPort: 5000 }]
          env:
            - { name: BACKEND_URI, value: "postgresql://mlflow:mlflow_pass@postgres.mlops.svc.cluster.local:5432/mlflow_db" }
          command: ["/bin/sh","-c"]
          args:
            - mlflow server --backend-store-uri ${BACKEND_URI} --default-artifact-root file:/mlruns --host 0.0.0.0 --port 5000
          volumeMounts:
            - { name: mlruns, mountPath: /mlruns }
      volumes:
        - name: mlruns
          emptyDir: {}
